var ee=Object.defineProperty,se=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var Q=(t,r,n)=>r in t?ee(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,m=(t,r)=>{for(var n in r||(r={}))re.call(r,n)&&Q(t,n,r[n]);if(O)for(var n of O(r))ne.call(r,n)&&Q(t,n,r[n]);return t},M=(t,r)=>se(t,ae(r));var A=(t,r,n)=>new Promise((h,d)=>{var S=l=>{try{o(n.next(l))}catch(v){d(v)}},N=l=>{try{o(n.throw(l))}catch(v){d(v)}},o=l=>l.done?h(l.value):Promise.resolve(l.value).then(S,N);o((n=n.apply(t,r)).next())});import{r as T,y as te,j as e,aQ as le,b7 as ce,dq as ie,cD as X,bX as oe,a1 as de,bf as me,at as he,R as xe,U as pe}from"./vendor-C50ijZWh.js";import{u as Y,s as k,C as $,a as D,b as Z,d as x,c as U,I as _,B as V,R as ue,U as g,V as y,X as b,Y as f,Z as C,n as je}from"./index-Blbobipf.js";import{T as ge,a as ye,b as q,c as R}from"./tabs-CsM4ZGNr.js";import{A as be}from"./AdminLayout-BZL16QJ9.js";import{T as fe,a as Ce,b as B,c as L,d as we,e as w}from"./table-DWISvnW8.js";import{B as J}from"./BulkPlanCreation-DS0AGB-v.js";import{bI as _e,bG as Ne,bH as F,c4 as G,bL as ve}from"./libs-B3eAAgHd.js";import{S as Pe,a as Te,b as ke,c as Se,d as Ee}from"./select-Ba1tjTaP.js";import{A as Ae}from"./AdminPageTitle-BgXCcQq-.js";import"./supabase-D8k0GRjn.js";import"./textarea-B56zo4Tx.js";const Le=()=>{const[t,r]=T.useState([]),[n,h]=T.useState(!0),[d,S]=T.useState(""),N=te(),{toast:o}=Y();T.useEffect(()=>{l()},[]);const l=()=>A(void 0,null,function*(){try{h(!0);const{data:s,error:c}=yield k.from("plans").select("*").order("created_at",{ascending:!1});if(c)throw c;const E=(s||[]).map(j=>M(m({},j),{industry_type:j.industry_type||null}));r(E)}catch(s){console.error("Error fetching plans:",s.message),o({variant:"destructive",title:"Error fetching plans",description:s.message})}finally{h(!1)}}),v=()=>{N("/admin/plans/create")},a=s=>{N(`/admin/plans/${s}/edit`)},i=s=>{N(`/plan/${s}`)},p=s=>A(void 0,null,function*(){try{const{data:c,error:u}=yield k.from("plans").select("*").eq("id",s).single();if(u)throw u;if(!c)throw new Error("Plan not found");const E=new Date().getTime(),j=`${c.username}_copy_${E}`,P=c,{data:De,error:H}=yield k.from("plans").insert({username:j,company_name:P.company_name,app_name:P.app_name,status:"draft",branding:P.branding,features:P.features,estimated_cost:P.estimated_cost,estimated_days:P.estimated_days,industry_type:P.industry_type||null}).select();if(H)throw H;o({title:"Plan duplicated",description:`Created a copy with username: ${j}`}),l()}catch(c){console.error("Error duplicating plan:",c),o({variant:"destructive",title:"Error duplicating plan",description:c.message})}}),I=s=>A(void 0,null,function*(){if(window.confirm("Are you sure you want to delete this plan?"))try{const{error:c}=yield k.from("plans").delete().eq("id",s);if(c)throw c;r(t.filter(u=>u.id!==s)),o({title:"Plan deleted",description:"The plan has been permanently removed."})}catch(c){console.error("Error deleting plan:",c),o({variant:"destructive",title:"Error deleting plan",description:c.message})}}),K=s=>{const c=`${window.location.origin}/plan/${s}`;navigator.clipboard.writeText(c),o({title:"Link copied",description:"Plan URL has been copied to clipboard"})},z=t.filter(s=>{var u,E,j;const c=d.toLowerCase();return((u=s.username)==null?void 0:u.toLowerCase().includes(c))||((E=s.company_name)==null?void 0:E.toLowerCase().includes(c))||((j=s.app_name)==null?void 0:j.toLowerCase().includes(c))}),W=s=>{switch(s){case"approved":return e.jsx(V,{className:"bg-green-500/20 text-green-500 hover:bg-green-500/30",children:"Approved"});case"pending":return e.jsx(V,{className:"bg-amber-500/20 text-amber-500 hover:bg-amber-500/30",children:"Pending"});case"draft":default:return e.jsx(V,{className:"bg-blue-500/20 text-blue-400 hover:bg-blue-500/30",children:"Draft"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(J,{}),e.jsxs($,{className:"border-siso-text/10 bg-black/30",children:[e.jsxs(D,{className:"flex flex-row items-center justify-between",children:[e.jsx(Z,{children:"App Plans"}),e.jsxs(x,{onClick:v,className:"bg-gradient-to-r from-siso-red to-siso-orange",children:[e.jsx(le,{className:"h-4 w-4 mr-2"})," Create New Plan"]})]}),e.jsxs(U,{children:[e.jsx("div",{className:"mb-4",children:e.jsx(_,{placeholder:"Search plans...",value:d,onChange:s=>S(s.target.value),className:"bg-black/20 border-siso-text/20"})}),e.jsx("div",{className:"rounded-md border border-siso-text/10 overflow-hidden",children:e.jsxs(fe,{children:[e.jsx(Ce,{children:e.jsxs(B,{className:"bg-black/40 hover:bg-black/50",children:[e.jsx(L,{children:"Username"}),e.jsx(L,{children:"Company"}),e.jsx(L,{children:"App"}),e.jsx(L,{children:"Status"}),e.jsx(L,{children:"Created"}),e.jsx(L,{className:"text-right",children:"Actions"})]})}),e.jsx(we,{children:n?e.jsx(B,{children:e.jsx(w,{colSpan:6,className:"text-center py-10 text-siso-text",children:"Loading plans..."})}):z.length===0?e.jsx(B,{children:e.jsx(w,{colSpan:6,className:"text-center py-10 text-siso-text",children:"No plans found. Create your first app plan."})}):z.map(s=>e.jsxs(B,{className:"hover:bg-black/20",children:[e.jsx(w,{className:"font-medium",children:s.username}),e.jsx(w,{children:s.company_name||"-"}),e.jsx(w,{children:s.app_name||"-"}),e.jsx(w,{children:W(s.status)}),e.jsx(w,{children:new Date(s.created_at).toLocaleDateString()}),e.jsxs(w,{className:"text-right flex justify-end gap-2",children:[e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>i(s.username),className:"h-8 w-8 p-0",title:"View Plan",children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>a(s.id),className:"h-8 w-8 p-0",title:"Edit Plan",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>K(s.username),className:"h-8 w-8 p-0",title:"Copy Link",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>p(s.id),className:"h-8 w-8 p-0",title:"Duplicate",children:e.jsx(X,{className:"h-4 w-4 text-blue-400"})}),e.jsx(x,{size:"sm",variant:"ghost",onClick:()=>I(s.id),className:"h-8 w-8 p-0 hover:text-red-500",title:"Delete Plan",children:e.jsx(oe,{className:"h-4 w-4"})})]})]},s.id))})]})})]})]})]})},Fe=Ne({username:F().min(3,{message:"Username must be at least 3 characters"}),company_name:F().min(2,{message:"Company name is required"}),app_name:F().min(2,{message:"App name is required"}),industry_type:F(),estimated_cost:G.number().min(0),estimated_days:G.number().min(1),primary_color:F().regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,{message:"Must be a valid hex color code"}),secondary_color:F().regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,{message:"Must be a valid hex color code"})}),$e=({onSuccess:t,initialData:r,mode:n="create"})=>{const{toast:h}=Y(),[d,S]=T.useState(!1),[N,o]=T.useState([]),l=de({resolver:_e(Fe),defaultValues:r||{username:"",company_name:"",app_name:"",industry_type:"onlyfans-management",estimated_cost:4997,estimated_days:14,primary_color:"#3182CE",secondary_color:"#805AD5"}});T.useEffect(()=>{A(void 0,null,function*(){try{const{data:i,error:p}=yield k.from("agency_types").select("name, slug");if(p)throw p;i&&o(i)}catch(i){console.error("Error fetching industries:",i),o([{slug:"onlyfans-management",name:"OnlyFans Management"},{slug:"digital-marketing",name:"Digital Marketing"},{slug:"content-marketing",name:"Content Marketing"}])}})},[]);const v=a=>A(void 0,null,function*(){S(!0);try{const i={username:a.username,company_name:a.company_name,app_name:a.app_name,industry_type:a.industry_type,estimated_cost:a.estimated_cost,estimated_days:a.estimated_days,branding:{primary_color:a.primary_color,secondary_color:a.secondary_color},status:"draft"};let p;n==="create"?p=yield k.from("plans").insert([i]):r!=null&&r.id&&(p=yield k.from("plans").update(i).eq("id",r.id));const{error:I}=p||{};if(I)throw I;h({title:`Plan ${n==="create"?"Created":"Updated"} Successfully`,description:`The plan for ${a.company_name} has been ${n==="create"?"created":"updated"}.`}),t&&t()}catch(i){console.error(`Error ${n==="create"?"creating":"updating"} plan:`,i),h({variant:"destructive",title:`Error ${n==="create"?"Creating":"Updating"} Plan`,description:i.message||"Please try again later"})}finally{S(!1)}});return e.jsxs($,{children:[e.jsx(D,{children:e.jsx(Z,{children:n==="create"?"Create New Plan":"Edit Plan"})}),e.jsx(ue,M(m({},l),{children:e.jsxs("form",{onSubmit:l.handleSubmit(v),children:[e.jsx(U,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(g,{control:l.control,name:"username",render:({field:a})=>e.jsxs(y,{children:[e.jsx(b,{children:"Username (URL Identifier)"}),e.jsx(f,{children:e.jsx(_,m({placeholder:"decora"},a))}),e.jsx(C,{})]})}),e.jsx(g,{control:l.control,name:"industry_type",render:({field:a})=>e.jsxs(y,{children:[e.jsx(b,{children:"Industry Type"}),e.jsxs(Pe,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(f,{children:e.jsx(Te,{children:e.jsx(ke,{placeholder:"Select an industry"})})}),e.jsx(Se,{children:N.map(i=>e.jsx(Ee,{value:i.slug,children:i.name},i.slug))})]}),e.jsx(C,{})]})}),e.jsx(g,{control:l.control,name:"company_name",render:({field:a})=>e.jsxs(y,{children:[e.jsx(b,{children:"Company Name"}),e.jsx(f,{children:e.jsx(_,m({placeholder:"Decora Agency"},a))}),e.jsx(C,{})]})}),e.jsx(g,{control:l.control,name:"app_name",render:({field:a})=>e.jsxs(y,{children:[e.jsx(b,{children:"App Name"}),e.jsx(f,{children:e.jsx(_,m({placeholder:"OnlyFans Management Suite"},a))}),e.jsx(C,{})]})}),e.jsx(g,{control:l.control,name:"estimated_cost",render:({field:a})=>e.jsxs(y,{children:[e.jsx(b,{children:"Estimated Cost ($)"}),e.jsx(f,{children:e.jsx(_,m({type:"number"},a))}),e.jsx(C,{})]})}),e.jsx(g,{control:l.control,name:"estimated_days",render:({field:a})=>e.jsxs(y,{children:[e.jsx(b,{children:"Estimated Days"}),e.jsx(f,{children:e.jsx(_,m({type:"number"},a))}),e.jsx(C,{})]})}),e.jsx(g,{control:l.control,name:"primary_color",render:({field:a})=>e.jsxs(y,{className:"flex flex-col",children:[e.jsx(b,{children:"Primary Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded border",style:{backgroundColor:a.value}}),e.jsx(f,{children:e.jsx(_,m({},a))})]}),e.jsx(C,{})]})}),e.jsx(g,{control:l.control,name:"secondary_color",render:({field:a})=>e.jsxs(y,{className:"flex flex-col",children:[e.jsx(b,{children:"Secondary Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded border",style:{backgroundColor:a.value}}),e.jsx(f,{children:e.jsx(_,m({},a))})]}),e.jsx(C,{})]})})]})}),e.jsxs(je,{className:"flex justify-between",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>t&&t(),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),n==="create"?"Create Plan":"Save Changes"]})})]})]})}))]})},Ge=()=>{const[t,r]=xe.useState("plans-list"),n=d=>{r(d)},h=()=>{ve.success("Plan created successfully"),r("plans-list")};return e.jsx(be,{children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(Ae,{icon:pe,title:"Plans Management",subtitle:"Manage your plans, create or import new plan templates"}),e.jsxs(ge,{value:t,onValueChange:n,children:[e.jsxs(ye,{className:"mb-6",children:[e.jsx(q,{value:"plans-list",children:"Plans List"}),e.jsx(q,{value:"create-plan",children:"Create Plan"}),e.jsx(q,{value:"bulk-create",children:"Bulk Creation"})]}),e.jsx(R,{value:"plans-list",children:e.jsxs($,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Available Plans"}),e.jsx(x,{variant:"default",onClick:()=>r("create-plan"),children:"Add New Plan"})]})}),e.jsx(U,{children:e.jsx(Le,{})})]})}),e.jsx(R,{value:"create-plan",children:e.jsxs($,{children:[e.jsx(D,{children:e.jsx("h2",{className:"text-xl font-semibold",children:"Create New Plan"})}),e.jsx(U,{children:e.jsx($e,{onSuccess:h})})]})}),e.jsx(R,{value:"bulk-create",children:e.jsxs($,{children:[e.jsx(D,{children:e.jsx("h2",{className:"text-xl font-semibold",children:"Bulk Plan Creation"})}),e.jsx(U,{children:e.jsx(J,{})})]})})]})]})})};export{Ge as default};
