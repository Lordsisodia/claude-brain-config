var u=(e,n,t)=>new Promise((i,s)=>{var o=a=>{try{r(t.next(a))}catch(l){s(l)}},c=a=>{try{r(t.throw(a))}catch(l){s(l)}},r=a=>a.done?i(a.value):Promise.resolve(a.value).then(o,c);r((t=t.apply(e,n)).next())});import{s as p}from"./index-Blbobipf.js";function m(e){const n=e.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"-").substring(0,20),t=Date.now().toString(36);return`${n}-${t}`}function f(e){return u(this,null,function*(){console.log("üöÄ Launching multi-prompt comprehensive generation...");const n=`Create 8-12 revolutionary app features for ${e.company} in ${e.industry}. 
  
  Company: ${e.company}
  Industry: ${e.industry}  
  Description: ${e.description}
  
  Make each feature incredibly detailed with:
  - Specific implementation details
  - Business impact and ROI
  - User experience benefits
  - Technical requirements
  
  Focus on features that will transform their business operations and give massive competitive advantage.`,t=`Create comprehensive business research for ${e.company} in ${e.industry}.
  
  Company: ${e.company}
  Industry: ${e.industry}
  Description: ${e.description}
  
  Provide detailed analysis in 4 areas:
  1. Industry Analysis (market trends, competition, opportunities)
  2. Company Analysis (positioning, strengths, growth potential)  
  3. Technical Recommendations (technology stack, architecture, security)
  4. Market Opportunities (revenue potential, cost savings, expansion)
  
  Make it professional and actionable for business decision-making.`;try{const[i,s]=yield Promise.all([p.functions.invoke("generate-app-plan",{body:{prompt:n,company:e.company,industry:e.industry}}),p.functions.invoke("generate-app-plan",{body:{prompt:t,company:e.company,industry:e.industry}})]);let o=[];if(i.data&&!i.error){const r=i.data.content||i.data;o=v(r,e.company)}let c={industryAnalysis:[],companyAnalysis:[],techRecommendations:[],marketOpportunities:[]};if(s.data&&!s.error){const r=s.data.content||s.data;c=b(r,e)}return console.log(`üéâ Multi-prompt success! ${o.length} features + comprehensive research`),{features:o,researchResults:c}}catch(i){throw console.error("‚ùå Multi-prompt generation failed:",i),i}})}function v(e,n){var s;const t=[],i=e.split(/\n\s*\n/);for(let o=0;o<i.length&&t.length<10;o++){const c=i[o].trim();if(c.length>20){const r=c.split(`
`).filter(h=>h.trim()),a=((s=r[0])==null?void 0:s.replace(/^\d+\.|\*\*|\*|Feature:|App Feature:/gi,"").trim())||`Advanced Feature ${t.length+1}`,l=r.slice(1).join(" ").trim()||`Comprehensive ${a.toLowerCase()} solution for ${n}`;t.push({id:`advanced_${t.length}`,title:a.substring(0,80),description:l.substring(0,300),priority:t.length<4?"high":t.length<8?"medium":"low",category:"AI Enhanced"})}}return t}function b(e,n){const t={industryAnalysis:[`${n.industry} market analysis shows strong digital transformation trends`,`Competitive landscape analysis reveals key positioning opportunities for ${n.company}`,"Market growth projections indicate 20-30% annual expansion in digital solutions","Customer behavior research shows increasing demand for mobile-first experiences"],companyAnalysis:[`${n.company} positioned strategically for market expansion through technology`,"Business model analysis indicates high potential for operational efficiency gains","Customer engagement optimization could increase retention by 25-40%",`Digital transformation roadmap tailored to ${n.company}'s specific needs`],techRecommendations:["Modern React/TypeScript stack recommended for optimal performance and maintainability","Cloud-native architecture with microservices for scalability and reliability","Advanced security framework with enterprise-grade authentication and encryption","API-first design enabling seamless integrations and future extensibility"],marketOpportunities:[`${n.industry} digitization creating significant revenue expansion opportunities`,"Automation potential could reduce operational costs by 30-50%","New market segments accessible through comprehensive digital platform",`Strategic partnership opportunities with leading ${n.industry} technology providers`]},i=e.toLowerCase();if(i.includes("industry")||i.includes("market")){const s=d(e,/industry|market/i,/company|technical/i);s&&(t.industryAnalysis=g(s,n.industry))}if(i.includes("company")||i.includes(n.company.toLowerCase())){const s=d(e,new RegExp(`company|${n.company}`,"i"),/technical|market opportunity/i);s&&(t.companyAnalysis=g(s,n.company))}return t}function d(e,n,t){const i=e.search(n),s=e.search(t);if(i!==-1){const o=s!==-1?s:e.length;return e.substring(i,o)}return""}function g(e,n){return e.split(/[.!?]+/).filter(i=>i.trim().length>20).slice(0,5).map(i=>i.trim()).filter(i=>i.length>0)}function A(e){return u(this,null,function*(){try{console.log("üîç Starting generateAdvancedAppPlan for:",e.company),console.log("ü§ñ Launching advanced multi-prompt AI system...");try{const n=yield f(e);if(n.features.length>0)return console.log("üéâ Multi-prompt system successful! Generated",n.features.length,"detailed features"),console.log("üî¨ Comprehensive research results:",n.researchResults),n}catch(n){console.log("‚ö†Ô∏è Multi-prompt system failed, trying direct edge function...",n);const{data:t,error:i}=yield p.functions.invoke("generate-app-plan",{body:{companyName:e.company,industry:e.industry,description:e.description,businessGoals:`Create a comprehensive business application for ${e.company}`,targetAudience:"Business professionals and customers",constraints:"Mobile-first, user-friendly, scalable solution"}});if(!i&&t){console.log("‚úÖ Direct edge function response:",t);let s=[],o={industryAnalysis:[],companyAnalysis:[],techRecommendations:[],marketOpportunities:[]};if(t.features&&Array.isArray(t.features)&&(s=t.features.map((c,r)=>({id:`edge_${r}`,title:c.name||c.title||`Feature ${r+1}`,description:c.description||`${e.company} business feature`,priority:r<3?"high":r<5?"medium":"low",category:c.category||"Business Logic"}))),t.research&&(o={industryAnalysis:t.research.industryAnalysis||[`AI analysis of ${e.industry} industry for ${e.company}`,"Market trends and opportunities identified","Competitive landscape evaluated"],companyAnalysis:t.research.companyAnalysis||[`${e.company} business model analysis completed`,"Digital transformation opportunities identified","Strategic recommendations developed"],techRecommendations:t.research.techRecommendations||[`Modern web technologies recommended for ${e.company}`,"Scalable architecture planned","Security and performance optimized"],marketOpportunities:t.research.marketOpportunities||[`${e.industry} market opportunities identified`,"Customer engagement strategies developed","Revenue optimization potential assessed"]}),s.length===0&&typeof t.content=="string"&&(s=(t.content.match(/(?:Feature|App Feature|Key Feature)[:\s]+([^\n]+)/gi)||[]).slice(0,8).map((a,l)=>({id:`parsed_${l}`,title:a.replace(/(?:Feature|App Feature|Key Feature)[:\s]+/i,"").trim(),description:`Comprehensive ${a.replace(/(?:Feature|App Feature|Key Feature)[:\s]+/i,"").trim().toLowerCase()} solution for ${e.company}`,priority:l<3?"high":l<5?"medium":"low",category:"AI Generated"}))),s.length>0)return console.log("üéâ Successfully parsed",s.length,"features from edge function"),{features:s,researchResults:o}}}return console.log("üîÑ Using enhanced industry-specific fallback..."),k(e)}catch(n){return console.error("‚ùå Enhanced app plan generation failed:",n),console.log("üîÑ Falling back to basic feature generation..."),y(e)}})}function k(e){const n={Restaurant:[{title:"Online Menu Management",description:"Digital menu with real-time updates and pricing"},{title:"Order Processing System",description:"Streamlined order taking and kitchen communication"},{title:"Table Reservation System",description:"Customer booking and table management"},{title:"Inventory Tracking",description:"Real-time ingredient and supply monitoring"}],"E-commerce":[{title:"Product Catalog Management",description:"Comprehensive product listings with variants"},{title:"Shopping Cart & Checkout",description:"Secure payment processing and order management"},{title:"Customer Account Portal",description:"User profiles, order history, and preferences"},{title:"Inventory Management",description:"Stock tracking and automated reordering"}],Healthcare:[{title:"Patient Scheduling System",description:"Appointment booking and calendar management"},{title:"Electronic Health Records",description:"Secure patient data management"},{title:"Prescription Management",description:"Digital prescription handling and tracking"},{title:"Telemedicine Integration",description:"Remote consultation capabilities"}],Education:[{title:"Student Management System",description:"Enrollment, grades, and progress tracking"},{title:"Online Learning Platform",description:"Course delivery and interactive content"},{title:"Assessment & Testing",description:"Digital exams and automated grading"},{title:"Parent Communication Portal",description:"Progress updates and school communication"}]},t=[{title:"User Authentication & Security",description:"Secure login and user management system"},{title:"Dashboard & Analytics",description:"Business insights and performance tracking"},{title:"Mobile-Responsive Design",description:"Optimized experience across all devices"},{title:"Data Management System",description:"Efficient data storage and retrieval"},{title:"Notification System",description:"Real-time alerts and communications"}];return(n[e.industry]||t).map((s,o)=>({id:`industry_${o}`,title:s.title,description:s.description,priority:o<2?"high":o<4?"medium":"low",category:"Industry-Specific"}))}function y(e){const n=[{id:"auth",title:"User Authentication & Security",description:`Secure user registration, login, and profile management for ${e.company}`,priority:"high",category:"Security"},{id:"dashboard",title:"Core Dashboard",description:`Centralized dashboard for ${e.industry} business operations`,priority:"high",category:"Core Functionality"},{id:"mobile",title:"Mobile-Responsive Design",description:"Optimized mobile experience across all devices",priority:"high",category:"User Experience"},{id:"notifications",title:"Push Notifications",description:"Real-time notifications for important updates",priority:"medium",category:"Communication"},{id:"analytics",title:"Analytics & Reporting",description:"Business insights and performance tracking",priority:"medium",category:"Analytics"}],t={industryAnalysis:[`${e.industry} is a growing market with digital transformation opportunities`,"Mobile-first approach is essential for modern business applications","User experience and security are key competitive advantages"],companyAnalysis:[`${e.company} can benefit from digital process automation`,"Custom application will improve operational efficiency","Enhanced customer engagement through digital channels"],techRecommendations:["React/TypeScript for modern web application development","Responsive design for multi-device compatibility","Cloud-based hosting for scalability and reliability"],marketOpportunities:["Digital transformation in traditional industries","Mobile-first business applications demand","Integration opportunities with existing business tools"]};return{features:n,researchResults:t}}function R(e){return u(this,null,function*(){try{console.log("üîç Starting saveAppPlan with data:",e),console.log("üöÄ Calling generateAdvancedAppPlan...");const{features:n,researchResults:t}=yield A(e);console.log("‚úÖ Generated features:",n),console.log("üî¨ Research results:",t);const i=n.map(a=>a.title);console.log("üìù Feature names for database:",i),e.researchResults=t,e.features=n;const s=m(e.company),o=`${e.company} Business App`;console.log("üíæ Saving to database with features:",i);const{data:c,error:r}=yield p.from("plans").insert({app_name:o,company_name:e.company,description:e.description,features:i,research_results:t,username:s,status:"active"}).select().single();if(r)throw console.error("‚ùå Database error saving app plan:",r),new Error(`Failed to save app plan: ${r.message}`);return console.log("üéâ Successfully saved app plan:",c),c}catch(n){console.error("‚ùå Error in saveAppPlan:",n);try{console.log("üîÑ Attempting fallback plan generation...");const{features:t,researchResults:i}=y(e),s=t.map(l=>l.title),o=m(e.company),c=`${e.company} Business App`,{data:r,error:a}=yield p.from("plans").insert({app_name:c,company_name:e.company,description:e.description,features:s,research_results:i,username:o,status:"active"}).select().single();if(a)throw console.error("‚ùå Fallback also failed:",a),new Error(`Failed to save app plan: ${a.message}`);return console.log("‚úÖ Fallback plan saved successfully:",r),r}catch(t){throw console.error("‚ùå Both advanced and fallback systems failed:",t),t}}})}function C(e){return u(this,null,function*(){try{const{data:n,error:t}=yield p.from("plans").select("*").eq("username",e).eq("status","active").single();if(t){if(t.code==="PGRST116")return null;throw console.error("Error fetching app plan:",t),new Error(`Failed to fetch app plan: ${t.message}`)}return n}catch(n){throw console.error("Error in getAppPlanByUsername:",n),n}})}export{C as g,R as s};
