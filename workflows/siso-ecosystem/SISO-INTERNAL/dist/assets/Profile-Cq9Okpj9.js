var h=(t,n,a)=>new Promise((s,l)=>{var c=r=>{try{o(a.next(r))}catch(i){l(i)}},d=r=>{try{o(a.throw(r))}catch(i){l(i)}},o=r=>r.done?s(r.value):Promise.resolve(r.value).then(c,d);o((a=a.apply(t,n)).next())});import{j as e,bh as W,bi as B,r as p,bj as P,aQ as H,f as O,m as g,bk as C,a$ as A,af as N,K as E,at as U,bf as T,ae as q,bl as K,y as L,aE as Y}from"./vendor-C50ijZWh.js";import{B as v,d as f,C as z,a as R,b as I,c as $,e as G,S as Q,u as j,s as m,f as F,P as V}from"./index-Blbobipf.js";import{u as J,P as X}from"./useProfileData-CcGAPxlT.js";import{S as Z}from"./sidebar-DSZsRBzS.js";import{F as ee}from"./FloatingOrbs-BtBv6Li9.js";import{P as se}from"./ProfileSkeleton-Dgbx7v9e.js";import{u as te}from"./usePoints-CKR6GRdc.js";import"./libs-B3eAAgHd.js";import"./supabase-D8k0GRjn.js";import"./textarea-B56zo4Tx.js";import"./typeHelpers-CXqKcVsn.js";import"./separator-BNrJR0ZO.js";import"./sheet-EfhB7uWf.js";const ae=({fullName:t,email:n,points:a,rank:s,avatarUrl:l,bannerUrl:c,user:d,onUpdateProfile:o,onBackToHome:r})=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-48 w-full overflow-hidden relative",children:c?e.jsx("img",{src:c,alt:"Profile Banner",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-r from-siso-orange/20 to-siso-red/20"})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-end gap-4 -mt-12 relative",children:[e.jsx("div",{className:"w-24 h-24 rounded-full border-4 border-black/20 overflow-hidden bg-black/40",children:l?e.jsx("img",{src:l,alt:t||"Profile",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-siso-orange/20 to-siso-red/20"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-xl font-semibold text-siso-text-bold truncate",children:t||(n==null?void 0:n.split("@")[0])}),e.jsx("p",{className:"text-sm text-siso-text/70",children:n})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center mt-4 sm:mt-0",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(v,{variant:"outline",className:"bg-siso-orange/10 text-siso-orange border-none",children:[a," Points"]}),e.jsx(v,{variant:"outline",className:"bg-siso-orange/10 text-siso-orange border-none",children:s})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"ghost",size:"sm",className:"text-siso-text hover:text-siso-text-bold",onClick:r,children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Home"]}),e.jsxs(f,{variant:"ghost",size:"sm",className:"text-siso-text hover:text-siso-text-bold",onClick:o,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Edit"]})]})]})]})})]}),re=({userId:t})=>{const[n,a]=p.useState([]),[s,l]=p.useState(!0);p.useEffect(()=>{h(void 0,null,function*(){try{const{data:r,error:i}=yield G.from("points_log").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(10);if(i)throw i;if(r&&Array.isArray(r)){const u=r.map(x=>({id:x.id||"",action:x.action||"",points_earned:Number(x.points_earned)||0,created_at:x.created_at||new Date().toISOString()}));a(u)}else console.error("Received invalid data format:",r),a([])}catch(r){console.error("Error fetching points history:",r),a([])}finally{l(!1)}})},[t]);const c=o=>new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),d=o=>o.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ");return e.jsxs(z,{className:"bg-black/20 border-siso-text/10",children:[e.jsx(R,{children:e.jsxs(I,{className:"text-siso-text-bold flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-siso-orange"}),"Points History"]})}),e.jsx($,{children:s?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((o,r)=>e.jsxs("div",{className:"animate-pulse flex items-center justify-between p-3 rounded-lg bg-siso-text/5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 w-32 bg-siso-text/10 rounded"}),e.jsx("div",{className:"h-3 w-24 bg-siso-text/10 rounded"})]}),e.jsx("div",{className:"h-6 w-16 bg-siso-text/10 rounded"})]},r))}):n.length>0?e.jsx("div",{className:"space-y-3",children:n.map(o=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-siso-text/5 border border-siso-text/10",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-siso-text-bold",children:d(o.action)}),e.jsx("p",{className:"text-xs text-siso-text/70",children:c(o.created_at)})]}),e.jsxs("div",{className:"flex items-center gap-1 text-siso-red",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:o.points_earned})]})]},o.id))}):e.jsxs("div",{className:"text-center py-6 text-siso-text/70",children:[e.jsx(P,{className:"w-8 h-8 mx-auto mb-2 text-siso-text/40"}),e.jsx("p",{children:"No points history yet"})]})})]})},D=({children:t})=>e.jsx(Z,{children:e.jsxs("div",{className:"flex min-h-screen w-full bg-gradient-to-b from-siso-bg to-siso-bg/95",children:[e.jsx(Q,{}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ee,{}),e.jsx("div",{className:"container mx-auto px-4 py-8 relative z-10",children:e.jsx("div",{className:"space-y-8 max-w-7xl mx-auto",children:t})})]})]})}),oe=({userId:t})=>{const{toast:n}=j();return p.useEffect(()=>{t&&h(void 0,null,function*(){try{const{data:s,error:l}=yield m.from("login_streaks").select("*").eq("user_id",t).maybeSingle();if(l)throw l;const c=new Date,d=s!=null&&s.last_login?new Date(s.last_login):null;if(!d||c.getDate()!==d.getDate()||c.getMonth()!==d.getMonth()||c.getFullYear()!==d.getFullYear()){const r=d&&c.getTime()-d.getTime()<1296e5;if(s)if(r){const i=s.current_streak+1,u=Math.max(i,s.longest_streak),{error:x}=yield m.from("login_streaks").update({current_streak:i,longest_streak:u,last_login:c.toISOString()}).eq("user_id",t);if(x)throw x;const{error:b}=yield m.from("points_log").insert([{user_id:t,action:"daily_login",points_earned:5}]);if(b)throw b;if(i%7===0){const{error:w}=yield m.from("points_log").insert([{user_id:t,action:"login_streak",points_earned:50}]);if(w)throw w;n({title:"Streak Bonus!",description:"You earned 50 points for maintaining a 7-day login streak!"})}else n({title:"Daily Login!",description:`You earned 5 points! Current streak: ${i} days`})}else{const{error:i}=yield m.from("login_streaks").update({current_streak:1,last_login:c.toISOString()}).eq("user_id",t);if(i)throw i;const{error:u}=yield m.from("points_log").insert([{user_id:t,action:"daily_login",points_earned:5}]);if(u)throw u;n({title:"Welcome Back!",description:"You earned 5 points for logging in today!"})}else{const{error:i}=yield m.from("login_streaks").insert([{user_id:t}]);if(i)throw i;const{error:u}=yield m.from("points_log").insert([{user_id:t,action:"daily_login",points_earned:5}]);if(u)throw u;n({title:"Welcome!",description:"You earned 5 points for your first login!"})}}}catch(s){console.error("Error updating login streak:",s),n({variant:"destructive",title:"Error updating streak",description:s.message})}})},[t]),e.jsx(O,{children:e.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex flex-col gap-4 p-6 bg-black/20 rounded-xl backdrop-blur-sm border border-siso-text/10 hover:border-siso-orange/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g.div,{className:"flex items-center gap-2",initial:{x:-20},animate:{x:0},children:[e.jsx(C,{className:"w-5 h-5 text-siso-orange"}),e.jsx("h3",{className:"text-lg font-semibold text-siso-text-bold",children:"Login Streak"})]}),e.jsxs(g.div,{initial:{scale:.8},animate:{scale:1},className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-siso-text/70"}),e.jsx("span",{className:"text-sm text-siso-text/70",children:"Daily Check-in"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs(g.div,{whileHover:{scale:1.02},className:"flex flex-col items-center p-4 rounded-lg bg-siso-text/5 border border-siso-text/10",children:[e.jsx(g.div,{animate:{scale:[1,1.1,1],rotate:[0,-10,10,0]},transition:{duration:2,repeat:1/0,repeatType:"reverse"},children:e.jsx(C,{className:"w-8 h-8 text-siso-orange mb-2"})}),e.jsx("span",{className:"text-sm text-siso-text/70",children:"Current Streak"}),e.jsx(g.span,{className:"text-2xl font-bold text-siso-text-bold",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:"7 Days"})]}),e.jsxs(g.div,{whileHover:{scale:1.02},className:"flex flex-col items-center p-4 rounded-lg bg-siso-text/5 border border-siso-text/10",children:[e.jsx(g.div,{animate:{y:[0,-5,0],scale:[1,1.05,1]},transition:{duration:3,repeat:1/0,repeatType:"reverse"},children:e.jsx(N,{className:"w-8 h-8 text-yellow-500 mb-2"})}),e.jsx("span",{className:"text-sm text-siso-text/70",children:"Longest Streak"}),e.jsx(g.span,{className:"text-2xl font-bold text-siso-text-bold",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:"14 Days"})]}),e.jsxs(g.div,{whileHover:{scale:1.02},className:"flex flex-col items-center p-4 rounded-lg bg-siso-text/5 border border-siso-text/10",children:[e.jsx(g.div,{animate:{rotate:[0,360]},transition:{duration:20,repeat:1/0,ease:"linear"},className:"relative",children:e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-siso-orange border-t-transparent mb-2"})}),e.jsx("span",{className:"text-sm text-siso-text/70",children:"Next Bonus In"}),e.jsx(g.span,{className:"text-2xl font-bold text-siso-text-bold",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:"2 Days"})]})]})]})})},ne=({userId:t,variant:n="default"})=>{const{points:a,rank:s,isLoading:l}=te(t);return l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-16"}),e.jsx(F,{className:"h-4 w-16"})]}):n==="compact"?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-siso-text/90",children:[e.jsx(N,{className:"w-4 h-4 text-siso-orange"}),e.jsx("span",{children:a}),e.jsx(E,{className:"w-4 h-4 text-siso-orange ml-2"}),e.jsx("span",{children:s})]}):e.jsxs("div",{className:"flex flex-col gap-2 p-4 rounded-lg bg-siso-text/5 border border-siso-text/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-siso-orange"}),e.jsxs("span",{className:"text-lg font-semibold text-siso-text-bold",children:[a," Points"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-siso-orange"}),e.jsx("span",{className:"text-lg font-semibold text-siso-text-bold",children:s})]})]})},ie=()=>{const[t,n]=p.useState(!1),[a,s]=p.useState(null),{toast:l}=j();p.useEffect(()=>{h(void 0,null,function*(){const{data:{session:r}}=yield m.auth.getSession();if(r){const{data:i}=yield m.from("profiles").select("solana_wallet_address").eq("id",r.user.id).single();i!=null&&i.solana_wallet_address&&s(i.solana_wallet_address)}})},[]);const c=()=>Array.from(crypto.getRandomValues(new Uint8Array(32))).map(o=>o.toString(16).padStart(2,"0")).join(""),d=()=>h(void 0,null,function*(){try{n(!0),console.log("[Wallet] Attempting to connect to Phantom");const{solana:o}=window;if(!(o!=null&&o.isPhantom))throw window.open("https://phantom.app/","_blank"),new Error("Please install Phantom Wallet");const{data:{session:r},error:i}=yield m.auth.getSession();if(i)throw i;if(!r)throw new Error("Please sign in to connect your wallet");const x=(yield o.connect()).publicKey.toString();console.log("[Wallet] Connected to wallet:",x);const b=c(),{data:w,error:y}=yield m.from("wallet_nonces").insert({public_key:x,nonce:b}).select().single();if(y)throw y;console.log("[Wallet] Generated nonce:",w);const M=new TextEncoder().encode(b),_=yield o.signMessage(M,"utf8");console.log("[Wallet] Signed message:",_);const{error:k}=yield m.functions.invoke("verify-wallet-signature",{body:{publicKey:x,signature:_.signature,nonce:b,userId:r.user.id}});if(k)throw k;const{error:S}=yield m.from("profiles").update({solana_wallet_address:x}).eq("id",r.user.id);if(S)throw S;s(x),l({title:"Success!",description:"Wallet connected successfully"}),console.log("[Wallet] Connection process completed successfully")}catch(o){console.error("[Wallet] Error:",o),l({variant:"destructive",title:"Error",description:o.message||"Failed to connect wallet"})}finally{n(!1)}});return a?e.jsxs(f,{variant:"outline",className:"bg-green-500/10 text-green-500 hover:bg-green-500/20 border-green-500/20",disabled:!0,children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Connected: ",a.slice(0,4),"...",a.slice(-4)]}):e.jsx(f,{onClick:d,disabled:t,className:"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 transition-colors duration-300 hover:scale-105",children:t?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Connect Phantom Wallet"]})})},le=()=>{const[t,n]=p.useState(!1),{toast:a}=j(),s=()=>h(void 0,null,function*(){try{n(!0),console.log("[Mint] Starting NFT minting process");const{data:{session:l},error:c}=yield m.auth.getSession();if(c)throw c;if(!l)throw new Error("Please sign in to mint NFTs");const{solana:d}=window;if(!(d!=null&&d.isPhantom))throw new Error("Please connect Phantom Wallet first");const r=(yield d.connect()).publicKey.toString(),i={name:"SISO Member NFT",description:"Exclusive membership NFT for SISO Resource Hub",uri:"https://your-metadata-uri.json"};console.log("[Mint] Calling mint-nft function");const{data:u,error:x}=yield m.functions.invoke("mint-nft",{body:{userPublicKey:r,nftMetadata:i,userId:l.user.id}});if(x)throw x;console.log("[Mint] NFT minted successfully:",u),a({title:"Success!",description:"NFT minted successfully"})}catch(l){console.error("[Mint] Error:",l),a({variant:"destructive",title:"Error",description:l.message||"Failed to mint NFT"})}finally{n(!1)}});return e.jsx(f,{onClick:s,disabled:t,className:"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 transition-colors duration-300 hover:scale-105",children:t?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"mr-2 h-4 w-4 animate-spin"}),"Minting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Mint SISO NFT"]})})},ce=({userId:t,solanaWalletAddress:n})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:col-span-3",children:e.jsx(oe,{userId:t})}),e.jsxs("div",{className:"md:col-span-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-black/20 rounded-xl p-6 backdrop-blur-sm border border-siso-text/10 hover:border-siso-orange/50 transition-colors",children:e.jsx(ne,{userId:t})}),e.jsx("div",{className:"bg-black/20 rounded-xl p-6 backdrop-blur-sm border border-siso-text/10 hover:border-siso-orange/50 transition-colors",children:e.jsx(ie,{})}),n&&e.jsx("div",{className:"bg-black/20 rounded-xl p-6 backdrop-blur-sm border border-siso-text/10 hover:border-siso-orange/50 transition-colors",children:e.jsx(le,{})})]})]}),de=({profile:t,user:n})=>{const s=(()=>{if(!t||!n)return 0;const l=[t.full_name,t.bio,t.professional_role,t.business_name,t.linkedin_url,t.website_url,t.avatar_url],c=l.filter(d=>!!d).length;return Math.round(c/l.length*100)})();return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-siso-text/70",children:"Profile Completion"}),e.jsxs(v,{variant:"outline",className:"bg-siso-orange/10 text-siso-orange border-none",children:[s,"%"]})]}),e.jsx(V,{value:s,className:"h-2"}),s<100&&e.jsx("p",{className:"text-xs text-siso-text/60",children:"Complete your profile to unlock all features"})]})},me=()=>{const{toast:t}=j(),n=L(),a=()=>h(void 0,null,function*(){try{const{error:s}=yield m.auth.signOut();if(s)throw s;t({title:"Signed out successfully",description:"Come back soon!"}),n("/",{replace:!0})}catch(s){t({variant:"destructive",title:"Error signing out",description:s.message})}});return e.jsxs(f,{onClick:a,variant:"ghost",className:"text-red-500 hover:text-red-600 hover:bg-red-500/10",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Sign Out"]})},Se=()=>{const t=L(),{toast:n}=j(),{user:a,profile:s,loading:l,isEditing:c,formData:d,handleFormChange:o}=J();return l?e.jsx(se,{}):!a||!s?e.jsx(D,{children:e.jsxs("div",{className:"text-center text-siso-text",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Profile Not Found"}),e.jsx("p",{children:"Unable to load profile data. Please try again later."})]})}):e.jsx(D,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-black/20 rounded-xl p-6 backdrop-blur-sm border border-siso-text/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-siso-text-bold",children:"My Profile"}),e.jsx(me,{})]}),e.jsx(de,{profile:s,user:a})]}),e.jsx("div",{className:"bg-black/20 rounded-xl overflow-hidden border border-siso-text/10",children:e.jsx(ae,{fullName:s==null?void 0:s.full_name,email:a==null?void 0:a.email,points:(s==null?void 0:s.points)||0,rank:(s==null?void 0:s.rank)||"Bronze",avatarUrl:s==null?void 0:s.avatar_url,bannerUrl:s==null?void 0:s.banner_url,user:a,onUpdateProfile:()=>window.location.reload(),onLogout:()=>h(void 0,null,function*(){try{const{error:r}=yield m.auth.signOut();if(r)throw r;t("/")}catch(r){n({variant:"destructive",title:"Error signing out",description:r.message})}}),onBackToHome:()=>t("/")})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(ce,{userId:a.id,solanaWalletAddress:s==null?void 0:s.solana_wallet_address}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(X,{email:a==null?void 0:a.email,fullName:s==null?void 0:s.full_name,points:(s==null?void 0:s.points)||0,rank:(s==null?void 0:s.rank)||"Bronze",businessName:s==null?void 0:s.business_name,businessType:s==null?void 0:s.business_type,industry:s==null?void 0:s.industry,interests:s==null?void 0:s.interests,bio:s==null?void 0:s.bio,linkedinUrl:s==null?void 0:s.linkedin_url,websiteUrl:s==null?void 0:s.website_url,youtubeUrl:s==null?void 0:s.youtube_url,instagramUrl:s==null?void 0:s.instagram_url,twitterUrl:s==null?void 0:s.twitter_url,professionalRole:s==null?void 0:s.professional_role,isEditing:c,formData:d,onFormChange:o})}),e.jsx("div",{className:"md:col-span-1",children:a&&e.jsx(re,{userId:a.id})})]})]})})};export{Se as default};
