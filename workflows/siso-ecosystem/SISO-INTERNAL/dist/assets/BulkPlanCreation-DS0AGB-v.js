var v=(m,x,t)=>new Promise((f,i)=>{var j=a=>{try{o(t.next(a))}catch(d){i(d)}},l=a=>{try{o(t.throw(a))}catch(d){i(d)}},o=a=>a.done?f(a.value):Promise.resolve(a.value).then(j,l);o((t=t.apply(m,x)).next())});import{r as g,R as F,j as e,U as C,ah as P,aX as U,b0 as $,bn as S,bf as L}from"./vendor-C50ijZWh.js";import{u as R,s as u,C as I,a as A,b as O,B as w,c as V,N as k,d as q}from"./index-Blbobipf.js";import{S as z,a as H,b as M,c as X,d as E}from"./select-Ba1tjTaP.js";import{T as Z}from"./textarea-B56zo4Tx.js";const W=()=>{var y;const[m,x]=g.useState(!1),[t,f]=g.useState([]),[i,j]=g.useState(""),[l,o]=g.useState(""),{toast:a}=R();F.useEffect(()=>{d()},[]);const d=()=>v(void 0,null,function*(){try{const{data:s,error:c}=yield u.from("plan_templates").select("*").order("created_at",{ascending:!1});if(c)throw c;f(s||[])}catch(s){console.error("Error fetching templates:",s),a({variant:"destructive",title:"Error fetching templates",description:s.message})}}),T=()=>v(void 0,null,function*(){if(!i||!l.trim()){a({variant:"destructive",title:"Missing information",description:"Please select a template and enter usernames"});return}x(!0);try{const s=t.find(n=>n.id===i);if(!s)throw new Error("Template not found");const c=l.split(`
`).map(n=>n.trim()).filter(n=>n.length>0),{data:B,error:_}=yield u.from("bulk_plan_creations").insert({template_id:s.id,total_plans:c.length,status:"in_progress"}).select().single();if(_)throw _;let N=0,h=0;for(const n of c)try{const{error:b}=yield u.from("plans").insert({username:n,app_name:s.app_name,branding:s.branding,features:s.features,estimated_cost:s.estimated_cost,estimated_days:s.estimated_days,status:"draft"});b?(h++,console.error(`Failed to create plan for ${n}:`,b)):N++}catch(b){h++,console.error(`Failed to create plan for ${n}:`,b)}yield u.from("bulk_plan_creations").update({status:"completed",created_plans:N,failed_plans:h,completed_at:new Date().toISOString()}).eq("id",B.id),a({title:"Bulk creation completed",description:`Created ${N} plans, ${h} failed`}),o("")}catch(s){console.error("Error in bulk creation:",s),a({variant:"destructive",title:"Error creating plans",description:s.message})}finally{x(!1)}}),p=()=>l.split(`
`).filter(s=>s.trim().length>0).length,r=t.find(s=>s.id===i);return e.jsxs(I,{className:"border-siso-border bg-gradient-to-br from-siso-bg/90 via-siso-bg-alt/50 to-siso-bg/90 backdrop-blur-sm shadow-xl rounded-xl",children:[e.jsx(A,{className:"pb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(O,{className:"flex items-center text-siso-text-bold text-2xl font-bold",children:[e.jsx(C,{className:"mr-4 h-7 w-7 text-siso-orange"}),"Bulk Create Plans"]}),e.jsx("p",{className:"text-siso-text text-base max-w-2xl leading-relaxed",children:"Efficiently generate multiple user plans from existing templates. Perfect for onboarding multiple clients with consistent service offerings."})]}),t.length>0&&e.jsxs(w,{variant:"outline",className:"text-siso-orange border-siso-orange/50 bg-siso-orange/10 px-4 py-2",children:[t.length," template",t.length!==1?"s":""," available"]})]})}),e.jsxs(V,{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(k,{className:"text-siso-text-bold font-semibold text-lg flex items-center",children:[e.jsx(P,{className:"w-5 h-5 mr-3 text-siso-orange"}),"Select Template"]}),r&&e.jsxs("div",{className:"flex items-center space-x-3 text-sm",children:[e.jsxs("span",{className:"text-siso-text font-medium",children:["$",r.estimated_cost]}),e.jsx("span",{className:"text-siso-text-muted",children:"â€¢"}),e.jsxs("span",{className:"text-siso-text font-medium",children:[r.estimated_days," days"]})]})]}),e.jsxs(z,{value:i,onValueChange:j,children:[e.jsx(H,{className:"bg-siso-bg-alt/60 border-siso-border text-siso-text hover:bg-siso-bg/60 transition-all duration-300 h-12 rounded-lg shadow-lg",children:e.jsx(M,{placeholder:"Choose a template to bulk create from..."})}),e.jsx(X,{className:"bg-siso-bg-alt/95 border-siso-border backdrop-blur-md rounded-lg",children:t.length===0?e.jsx(E,{value:"none",disabled:!0,className:"text-siso-text-muted",children:"No templates available"}):t.map(s=>e.jsx(E,{value:s.id,className:"text-siso-text hover:bg-siso-bg/60 transition-colors duration-200",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.name}),e.jsx(w,{variant:"secondary",className:"ml-3 text-xs bg-siso-bg text-siso-text",children:s.industry_type})]})},s.id))})]}),r&&e.jsx("div",{className:"bg-siso-bg-alt/40 rounded-xl p-6 border border-siso-border shadow-lg backdrop-blur-sm transition-all duration-300 hover:bg-siso-bg-alt/60",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 text-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-siso-text-muted font-medium",children:"App Name:"}),e.jsx("p",{className:"text-siso-text-bold font-semibold text-base",children:r.app_name||"Not specified"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-siso-text-muted font-medium",children:"Industry:"}),e.jsx("p",{className:"text-siso-text-bold font-semibold text-base",children:r.industry_type})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-siso-text-muted font-medium",children:"Features:"}),e.jsxs("p",{className:"text-siso-text-bold font-semibold text-base",children:[((y=r.features)==null?void 0:y.length)||0," included"]})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(k,{className:"text-siso-text-bold font-semibold text-lg flex items-center",children:[e.jsx(C,{className:"w-5 h-5 mr-3 text-siso-orange"}),"Enter Usernames"]}),l.trim()&&e.jsxs(w,{className:"bg-siso-orange/20 text-siso-orange border-siso-orange/40 px-4 py-2",children:[p()," user",p()!==1?"s":""]})]}),e.jsx(Z,{value:l,onChange:s=>o(s.target.value),placeholder:`Enter usernames, one per line:

john_doe
jane_smith
client_company
...`,className:"h-40 bg-siso-bg-alt/60 border-siso-border text-siso-text placeholder:text-siso-text-muted resize-none hover:bg-siso-bg/60 focus:bg-siso-bg/60 transition-all duration-300 rounded-lg shadow-lg"}),e.jsxs("div",{className:"flex items-center text-sm text-siso-text space-x-6",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(U,{className:"w-4 h-4 mr-2 text-green-400"}),"One username per line"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx($,{className:"w-4 h-4 mr-2 text-amber-400"}),"Empty lines will be ignored"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-siso-border",children:[e.jsx("div",{className:"text-base text-siso-text",children:i&&l.trim()?e.jsxs("span",{className:"flex items-center",children:[e.jsx(S,{className:"w-5 h-5 mr-2 text-siso-orange"}),"Ready to create ",p()," plan",p()!==1?"s":"",' from "',r==null?void 0:r.name,'"']}):e.jsx("span",{className:"text-siso-text-muted",children:"Select a template and add usernames to continue"})}),e.jsx(q,{onClick:T,disabled:m||!i||!l.trim(),className:"bg-gradient-to-r from-siso-red to-siso-orange hover:from-siso-red/90 hover:to-siso-orange/90 text-white shadow-lg hover:shadow-siso-orange/25 transition-all duration-300 min-w-[160px] h-12 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-3 h-5 w-5 animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-3 h-5 w-5"}),"Create Plans"]})})]})]})]})};export{W as B};
