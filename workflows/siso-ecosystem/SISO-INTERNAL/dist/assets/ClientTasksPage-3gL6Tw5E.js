var F=Object.defineProperty,U=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var _=(s,t,a)=>t in s?F(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,v=(s,t)=>{for(var a in t||(t={}))P.call(t,a)&&_(s,a,t[a]);if(T)for(var a of T(t))q.call(t,a)&&_(s,a,t[a]);return s},w=(s,t)=>U(s,Y(t));var y=(s,t,a)=>new Promise((j,o)=>{var u=d=>{try{c(a.next(d))}catch(p){o(p)}},N=d=>{try{c(a.throw(d))}catch(p){o(p)}},c=d=>d.done?j(d.value):Promise.resolve(d.value).then(u,N);c((a=a.apply(s,t)).next())});import{r as h,j as e,aX as E,aY as J,av as O}from"./vendor-C50ijZWh.js";import{u as V,f as x,C as g,s as f}from"./index-Blbobipf.js";import{T as B}from"./TodoList-DWE6QkqC.js";import{S as G,a as M,b as R,c as X,e as $,f as z,d as S}from"./select-Ba1tjTaP.js";import{C as A}from"./ClientDashboardLayout-D1WKB6Kc.js";import"./libs-B3eAAgHd.js";import"./supabase-D8k0GRjn.js";import"./sidebar-DSZsRBzS.js";import"./separator-BNrJR0ZO.js";import"./sheet-EfhB7uWf.js";function de(){const[s,t]=h.useState(null),[a,j]=h.useState(!0),{toast:o}=V(),[u,N]=h.useState("all");h.useEffect(()=>{y(this,null,function*(){try{const{data:{user:r}}=yield f.auth.getUser();if(!r)return;const{data:i,error:D}=yield f.rpc("get_client_by_user_id",{user_uuid:r.id});if(D||!i||i.length===0)return;const I=i[0].client_id,{data:m,error:k}=yield f.from("client_onboarding").select("*").eq("id",I).maybeSingle();if(k)throw k;if(m){let C=[];m.todos&&Array.isArray(m.todos)&&(C=m.todos.map(n=>({id:n.id||`temp-${Math.random().toString(36).substr(2,9)}`,text:n.text||"",completed:!!n.completed,priority:n.priority||"medium",due_date:n.due_date,related_to:n.related_to,assigned_to:n.assigned_to})));const L=w(v({},m),{todos:C});t(L)}}catch(r){console.error("Error fetching client data:",r),o({variant:"destructive",title:"Error",description:"Failed to load tasks"})}finally{j(!1)}})},[o]);const c=l=>y(this,null,function*(){if(s)try{const{error:r}=yield f.from("client_onboarding").update({todos:JSON.parse(JSON.stringify(l))}).eq("id",s.id);r?o({variant:"destructive",title:"Error updating todos",description:r.message}):(t(i=>i?w(v({},i),{todos:l}):null),o({title:"Tasks updated",description:"Your tasks have been successfully updated."}))}catch(r){console.error("Unexpected error updating todos:",r),o({variant:"destructive",title:"Error",description:"An unexpected error occurred while updating tasks."})}}),d=()=>{if(!(s!=null&&s.todos))return[];switch(u){case"completed":return s.todos.filter(l=>l.completed);case"pending":return s.todos.filter(l=>!l.completed);default:return s.todos}},b=(()=>{if(!(s!=null&&s.todos))return{total:0,completed:0,pending:0};const l=s.todos.length,r=s.todos.filter(i=>i.completed).length;return{total:l,completed:r,pending:l-r}})();return a?e.jsx(A,{children:e.jsxs("div",{children:[e.jsx(x,{className:"h-10 w-48 mb-6"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(x,{className:"h-24 w-full rounded-lg"}),e.jsx(x,{className:"h-24 w-full rounded-lg"}),e.jsx(x,{className:"h-24 w-full rounded-lg"})]}),e.jsx(x,{className:"h-64 w-full rounded-lg"})]})}):e.jsx(A,{children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-slate-900",children:"Your Tasks"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsx(g,{className:"p-5 border border-slate-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(E,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Total Tasks"}),e.jsx("p",{className:"text-2xl font-semibold",children:b.total})]})]})}),e.jsx(g,{className:"p-5 border border-slate-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full",children:e.jsx(E,{className:"h-5 w-5 text-green-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Completed"}),e.jsx("p",{className:"text-2xl font-semibold",children:b.completed})]})]})}),e.jsx(g,{className:"p-5 border border-slate-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-full",children:e.jsx(J,{className:"h-5 w-5 text-yellow-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500",children:"Pending"}),e.jsx("p",{className:"text-2xl font-semibold",children:b.pending})]})]})})]}),e.jsxs(g,{className:"p-6 border border-slate-200",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Task List"}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(G,{value:u,onValueChange:l=>N(l),children:[e.jsx(M,{className:"w-[180px]",children:e.jsx(R,{placeholder:"Filter by status"})}),e.jsx(X,{children:e.jsxs($,{children:[e.jsx(z,{children:"Filter"}),e.jsx(S,{value:"all",children:"All Tasks"}),e.jsx(S,{value:"completed",children:"Completed"}),e.jsx(S,{value:"pending",children:"Pending"})]})})]})})]}),s!=null&&s.todos&&s.todos.length>0?e.jsx(B,{todos:d(),onUpdate:c,clientId:s.id}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"h-12 w-12 mx-auto text-slate-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium mb-1",children:"No Tasks Available"}),e.jsx("p",{className:"text-slate-500",children:"You don't have any tasks assigned currently."})]})]})]})})}export{de as default};
