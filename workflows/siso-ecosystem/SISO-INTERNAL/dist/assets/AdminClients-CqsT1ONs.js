var Ye=Object.defineProperty,Je=Object.defineProperties;var es=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var ge=(s,a,r)=>a in s?Ye(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,f=(s,a)=>{for(var r in a||(a={}))xe.call(a,r)&&ge(s,r,a[r]);if(O)for(var r of O(a))he.call(a,r)&&ge(s,r,a[r]);return s},L=(s,a)=>Je(s,es(a));var A=(s,a)=>{var r={};for(var t in s)xe.call(s,t)&&a.indexOf(t)<0&&(r[t]=s[t]);if(s!=null&&O)for(var t of O(s))a.indexOf(t)<0&&he.call(s,t)&&(r[t]=s[t]);return r};var E=(s,a,r)=>new Promise((t,l)=>{var o=n=>{try{x(r.next(n))}catch(i){l(i)}},c=n=>{try{x(r.throw(n))}catch(i){l(i)}},x=n=>n.done?t(n.value):Promise.resolve(n.value).then(o,c);x((r=r.apply(s,a)).next())});import{r as m,j as e,a7 as ss,N as ee,cP as as,cQ as ts,cR as rs,cS as je,cT as fe,cU as ve,cV as Ne,cW as ye,cX as we,cY as ls,bg as ns,c9 as Ce,cZ as is,c_ as ke,b0 as os,c$ as X,aC as cs,bV as ds,d0 as ms,cB as us,am as gs,d1 as xs,d2 as hs,aQ as se,cM as ps,bm as Se,aX as bs,H as js,at as _e,X as Pe,d3 as fs,bi as vs,bf as De,a$ as ae,cN as Ns,y as ys,d4 as ws,M as Cs,aa as ks,ac as Ss,U as Ae,aL as _s,aW as Ps,bT as Ds,b5 as As,d5 as zs}from"./vendor-C50ijZWh.js";import{A as Ls}from"./AdminLayout-BZL16QJ9.js";import{L as ze,h as v,M as Le,u as Z,I as F,d as p,K as G,N as pe,D as Ve,t as Fe,v as Te,w as Re,O as Vs,B as R,P as te,Q as Fs,s as K,f as B,A as Ts,p as Rs,q as Ms,C as Me,c as Ie,a as Is,n as Es}from"./index-Blbobipf.js";import{T as Bs,a as Us,b as H,c as Ws,d as $s,e as _}from"./table-DWISvnW8.js";import{s as be,u as qs}from"./useClientDetails-DIBTW9oN.js";import{S as re,a as le,b as ne,c as ie,d as M}from"./select-Ba1tjTaP.js";import{P as Hs,a as Os,b as Ks}from"./popover-BCE2rLYx.js";import{bX as Gs,bY as Zs,bZ as Qs,b_ as Xs,b$ as Ys,c0 as Ee}from"./libs-B3eAAgHd.js";import{D as Js,a as ea,b as sa,c as aa,d as ta}from"./dialog-CB9qAGL5.js";import{S as ra,b as la,c as na,d as ia,e as oa}from"./sheet-EfhB7uWf.js";import{T as ca,a as da,b as Y,c as J}from"./tabs-CsM4ZGNr.js";import{S as ma}from"./separator-BNrJR0ZO.js";import{T as ua}from"./TodoList-DWE6QkqC.js";import{A as ga}from"./AdminPageTitle-BgXCcQq-.js";import"./supabase-D8k0GRjn.js";function Q(s={}){const{isAdmin:a,isLoading:r}=ze(),[t,l]=m.useState([]),[o,c]=m.useState(0),[x,n]=m.useState(!0),{searchQuery:i="",statusFilter:b="",sortColumn:u="updated_at",sortDirection:j="desc",page:h=1,pageSize:k=10}=s,w=()=>E(this,null,function*(){if(!a){l([]),c(0),n(!1);return}try{n(!0),console.log("FORCE LOADING SAMPLE DATA FOR PIPELINE TESTING");const C=S(be,{searchQuery:i,statusFilter:b});console.log("Sample clients loaded:",C.length),console.log("Sample clients with prices:",C.map(N=>({name:N.business_name,price:N.estimated_price}))),l(C),c(C.length),n(!1);return}catch(C){console.error("Unexpected error fetching clients:",C),console.log("Error occurred, using sample client data as fallback");const N=S(be,{searchQuery:i,statusFilter:b});l(N),c(N.length)}finally{n(!1)}}),S=(C,N)=>{let z=[...C];if(N.searchQuery){const y=N.searchQuery.toLowerCase();z=z.filter(P=>{var V,T,W;return((V=P.business_name)==null?void 0:V.toLowerCase().includes(y))||((T=P.full_name)==null?void 0:T.toLowerCase().includes(y))||((W=P.project_name)==null?void 0:W.toLowerCase().includes(y))})}return N.statusFilter&&N.statusFilter!=="all"&&(z=z.filter(y=>y.status===N.statusFilter)),z.sort((y,P)=>{const V=y[u]||"",T=P[u]||"";return j==="asc"?V>T?1:-1:V<T?1:-1}),z};return m.useEffect(()=>{r||w()},[a,r,i,b,u,j,h,k]),{clients:t,totalCount:o,isLoading:x||r,refetch:w}}function xa({clientId:s}){return e.jsxs(ss,{to:`/admin/clients/${s}`,className:v("group block w-full max-w-[140px] rounded-full px-4 py-1.5 border border-emerald-500/30","bg-emerald-50/90 text-emerald-700 shadow-emerald-500/10","hover:bg-emerald-100/90 hover:text-emerald-800 hover:shadow-lg transition-all duration-150","flex items-center gap-2 justify-between text-xs font-semibold"),"aria-label":"Go to client detail page",children:[e.jsx("span",{children:"View client"}),e.jsx(ee,{size:16,strokeWidth:2,className:"ml-1 transition-transform group-hover:translate-x-1"})]})}const Be=r=>{var t=r,{className:s}=t,a=A(t,["className"]);return e.jsx("nav",f({role:"navigation","aria-label":"pagination",className:v("mx-auto flex w-full justify-center",s)},a))};Be.displayName="Pagination";const Ue=m.forwardRef((t,r)=>{var l=t,{className:s}=l,a=A(l,["className"]);return e.jsx("ul",f({ref:r,className:v("flex flex-row items-center gap-1",s)},a))});Ue.displayName="PaginationContent";const q=m.forwardRef((t,r)=>{var l=t,{className:s}=l,a=A(l,["className"]);return e.jsx("li",f({ref:r,className:v("",s)},a))});q.displayName="PaginationItem";const ha=as,pa=ts,ba=rs,We=m.forwardRef((t,r)=>{var l=t,{className:s}=l,a=A(l,["className"]);return e.jsx(we,L(f({className:v("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s)},a),{ref:r}))});We.displayName=we.displayName;const $e=m.forwardRef((t,r)=>{var l=t,{className:s}=l,a=A(l,["className"]);return e.jsxs(ba,{children:[e.jsx(We,{}),e.jsx(je,f({ref:r,className:v("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s)},a))]})});$e.displayName=je.displayName;const qe=r=>{var t=r,{className:s}=t,a=A(t,["className"]);return e.jsx("div",f({className:v("flex flex-col space-y-2 text-center sm:text-left",s)},a))};qe.displayName="AlertDialogHeader";const He=r=>{var t=r,{className:s}=t,a=A(t,["className"]);return e.jsx("div",f({className:v("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s)},a))};He.displayName="AlertDialogFooter";const Oe=m.forwardRef((t,r)=>{var l=t,{className:s}=l,a=A(l,["className"]);return e.jsx(fe,f({ref:r,className:v("text-lg font-semibold",s)},a))});Oe.displayName=fe.displayName;const Ke=m.forwardRef((t,r)=>{var l=t,{className:s}=l,a=A(l,["className"]);return e.jsx(ve,f({ref:r,className:v("text-sm text-muted-foreground",s)},a))});Ke.displayName=ve.displayName;const Ge=m.forwardRef((t,r)=>{var l=t,{className:s}=l,a=A(l,["className"]);return e.jsx(ye,f({ref:r,className:v(Le(),s)},a))});Ge.displayName=ye.displayName;const Ze=m.forwardRef((t,r)=>{var l=t,{className:s}=l,a=A(l,["className"]);return e.jsx(Ne,f({ref:r,className:v(Le({variant:"outline"}),"mt-2 sm:mt-0",s)},a))});Ze.displayName=Ne.displayName;function ja({table:s,columns:a,searchQuery:r,statusFilter:t,onSearchChange:l,onStatusFilterChange:o,renderRowActions:c,statusBadge:x,addButton:n,deleteSelectedTitle:i,addNewRow:b}){var z,y,P,V,T,W,ce,de;const u=m.useId(),j=m.useRef(null),{toast:h}=Z(),k=m.useMemo(()=>{const d=s.getColumn("status");return d?Array.from(d.getFacetedUniqueValues().keys()).sort():[]},[(z=s.getColumn("status"))==null?void 0:z.getFacetedUniqueValues()]),w=m.useMemo(()=>{const d=s.getColumn("status");return d?d.getFacetedUniqueValues():new Map},[(y=s.getColumn("status"))==null?void 0:y.getFacetedUniqueValues()]),S=m.useMemo(()=>{var g;const d=(g=s.getColumn("status"))==null?void 0:g.getFilterValue();return d!=null?d:[]},[(P=s.getColumn("status"))==null?void 0:P.getFilterValue()]),C=(d,g)=>{var $,me;const I=($=s.getColumn("status"))==null?void 0:$.getFilterValue(),D=I?[...I]:[];if(d)D.push(g);else{const ue=D.indexOf(g);ue>-1&&D.splice(ue,1)}(me=s.getColumn("status"))==null||me.setFilterValue(D.length?D:void 0),o==null||o(D.length?D[0]:"all")},N=()=>{h({title:i||"Delete",description:"Bulk delete not yet implemented."})};return e.jsxs("div",{className:"w-full px-0 sm:px-2 lg:px-4 xl:px-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(F,{id:`${u}-input`,ref:j,className:v("peer min-w-60 ps-9 bg-gray-800 border-gray-600 text-white placeholder:text-gray-400",!!((V=s.getColumn("full_name"))!=null&&V.getFilterValue())&&"pe-9"),value:(W=(T=s.getColumn("full_name"))==null?void 0:T.getFilterValue())!=null?W:r,onChange:d=>{var g;(g=s.getColumn("full_name"))==null||g.setFilterValue(d.target.value),l==null||l(d.target.value)},placeholder:"Filter by name or email...",type:"text","aria-label":"Filter by name or email"}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 start-0 flex items-center justify-center ps-3 text-gray-400 peer-disabled:opacity-50",children:e.jsx(ls,{size:16,strokeWidth:2,"aria-hidden":"true"})}),!!((ce=s.getColumn("full_name"))!=null&&ce.getFilterValue())&&e.jsx("button",{className:"absolute inset-y-0 end-0 flex h-full w-9 items-center justify-center rounded-e-lg text-gray-400 outline-offset-2 transition-colors hover:text-gray-200 focus:z-10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-ring/70 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Clear filter",onClick:()=>{var d;(d=s.getColumn("full_name"))==null||d.setFilterValue(""),j.current&&j.current.focus(),l==null||l("")},children:e.jsx(ns,{size:16,strokeWidth:2,"aria-hidden":"true"})})]}),k.length>0&&e.jsxs(Hs,{children:[e.jsx(Os,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"bg-gray-800 border-gray-600 text-gray-200 hover:bg-gray-700",children:[e.jsx(Ce,{className:"-ms-1 me-2 opacity-60",size:16,strokeWidth:2,"aria-hidden":"true"}),"Status",S.length>0&&e.jsx("span",{className:"-me-1 ms-3 inline-flex h-5 max-h-full items-center rounded border border-gray-600 bg-gray-900 px-1 font-[inherit] text-[0.625rem] font-medium text-gray-400",children:S.length})]})}),e.jsx(Ks,{className:"min-w-36 p-3 bg-gray-800 border-gray-600",align:"start",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-400",children:"Filters"}),e.jsx("div",{className:"space-y-3",children:k.map((d,g)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{id:`${u}-${g}`,checked:S.includes(d),onCheckedChange:I=>C(I,d),className:"border-gray-600 data-[state=checked]:bg-orange-600"}),e.jsxs(pe,{htmlFor:`${u}-${g}`,className:"flex grow justify-between gap-2 font-normal text-gray-200",children:[d,e.jsx("span",{className:"ms-2 text-xs text-gray-400",children:w.get(d)})]})]},d))})]})})]}),e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"bg-gray-800 border-gray-600 text-gray-200 hover:bg-gray-700",children:[e.jsx(is,{className:"-ms-1 me-2 opacity-60",size:16,strokeWidth:2,"aria-hidden":"true"}),"View"]})}),e.jsxs(Te,{align:"end",className:"bg-gray-800 border-gray-600",children:[e.jsx(Re,{className:"text-gray-200",children:"Toggle columns"}),s.getAllColumns().filter(d=>d.getCanHide()).map(d=>e.jsx(Vs,{className:"capitalize text-gray-200",checked:d.getIsVisible(),onCheckedChange:g=>d.toggleVisibility(!!g),onSelect:g=>g.preventDefault(),children:d.id},d.id))]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s.getSelectedRowModel().rows.length>0&&e.jsxs(ha,{children:[e.jsx(pa,{asChild:!0,children:e.jsxs(p,{className:"ml-auto bg-gray-800 border-gray-600 text-gray-200 hover:bg-gray-700",variant:"outline",children:[e.jsx(ke,{className:"-ms-1 me-2 opacity-60",size:16,strokeWidth:2,"aria-hidden":"true"}),"Delete",e.jsx("span",{className:"-me-1 ms-3 inline-flex h-5 max-h-full items-center rounded border border-gray-600 bg-gray-900 px-1 font-[inherit] text-[0.625rem] font-medium text-gray-400",children:s.getSelectedRowModel().rows.length})]})}),e.jsxs($e,{className:"bg-gray-800 border-gray-600 text-white",children:[e.jsxs("div",{className:"flex flex-col gap-2 max-sm:items-center sm:flex-row sm:gap-4",children:[e.jsx("div",{className:"flex size-9 shrink-0 items-center justify-center rounded-full border border-gray-600","aria-hidden":"true",children:e.jsx(os,{className:"text-orange-500",size:16,strokeWidth:2})}),e.jsxs(qe,{children:[e.jsx(Oe,{className:"text-gray-100",children:"Are you absolutely sure?"}),e.jsxs(Ke,{className:"text-gray-300",children:["This action cannot be undone. This will permanently delete ",s.getSelectedRowModel().rows.length," selected ",s.getSelectedRowModel().rows.length===1?"row":"rows","."]})]})]}),e.jsxs(He,{children:[e.jsx(Ze,{className:"bg-gray-700 text-gray-200 hover:bg-gray-600 hover:text-white border-gray-600",children:"Cancel"}),e.jsx(Ge,{onClick:N,className:"bg-red-600 hover:bg-red-700 text-white",children:"Delete"})]})]})]}),n]})]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-700 bg-gray-900 w-full",children:e.jsxs(Bs,{className:"table-fixed w-full text-white",children:[e.jsx(Us,{children:s.getHeaderGroups().map(d=>e.jsx(H,{className:"hover:bg-transparent border-gray-700",children:d.headers.map(g=>{var I;return e.jsx(Ws,{style:{width:`${g.getSize()}px`},className:"h-11 bg-gray-800 text-gray-100 border-gray-700",children:g.isPlaceholder?null:g.column.getCanSort()?e.jsxs("div",{className:v(g.column.getCanSort()&&"flex h-full cursor-pointer select-none items-center justify-between gap-2"),onClick:g.column.getToggleSortingHandler(),onKeyDown:D=>{var $;g.column.getCanSort()&&(D.key==="Enter"||D.key===" ")&&(D.preventDefault(),($=g.column.getToggleSortingHandler())==null||$(D))},tabIndex:g.column.getCanSort()?0:void 0,children:[X(g.column.columnDef.header,g.getContext()),(I={asc:e.jsx(ds,{className:"shrink-0 opacity-60",size:16,strokeWidth:2,"aria-hidden":"true"}),desc:e.jsx(cs,{className:"shrink-0 opacity-60",size:16,strokeWidth:2,"aria-hidden":"true"})}[g.column.getIsSorted()])!=null?I:null]}):X(g.column.columnDef.header,g.getContext())},g.id)})},d.id))}),e.jsx($s,{children:(de=s.getRowModel().rows)!=null&&de.length?e.jsxs(e.Fragment,{children:[s.getRowModel().rows.map(d=>e.jsx(H,{"data-state":d.getIsSelected()&&"selected",className:"border-gray-700 hover:bg-gray-800/50",children:d.getVisibleCells().map(g=>e.jsx(_,{className:"last:py-0 border-gray-700 text-gray-100",children:g.column.id==="actions"&&c?c(d):X(g.column.columnDef.cell,g.getContext())},g.id))},d.id)),b]}):e.jsx(H,{className:"border-gray-700",children:e.jsx(_,{colSpan:a.length,className:"h-24 text-center text-gray-400 border-gray-700",children:"No results."})})})]})}),e.jsxs("div",{className:"flex items-center justify-between gap-8 mt-4 text-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{htmlFor:u,className:"max-sm:sr-only text-gray-300",children:"Rows per page"}),e.jsx("select",{className:"border rounded px-2 py-1 text-sm bg-gray-800 border-gray-600 text-white",value:s.getState().pagination.pageSize,onChange:d=>s.setPageSize(Number(d.target.value)),children:[5,10,25,50].map(d=>e.jsx("option",{value:d,children:d},d))})]}),e.jsx("div",{className:"flex grow justify-end whitespace-nowrap text-sm text-gray-400",children:e.jsxs("p",{className:"whitespace-nowrap text-sm text-gray-400","aria-live":"polite",children:[e.jsxs("span",{className:"text-gray-200",children:[s.getState().pagination.pageIndex*s.getState().pagination.pageSize+1,"-",Math.min(Math.max(s.getState().pagination.pageIndex*s.getState().pagination.pageSize+s.getState().pagination.pageSize,0),s.getRowCount())]})," ","of ",e.jsx("span",{className:"text-gray-200",children:s.getRowCount().toString()})]})}),e.jsx("div",{children:e.jsx(Be,{children:e.jsxs(Ue,{children:[e.jsx(q,{children:e.jsx(p,{size:"icon",variant:"outline",className:"disabled:pointer-events-none disabled:opacity-50 bg-gray-800 border-gray-600 text-gray-200 hover:bg-gray-700",onClick:()=>s.firstPage(),disabled:!s.getCanPreviousPage(),"aria-label":"Go to first page",children:e.jsx(ms,{size:16,strokeWidth:2,"aria-hidden":"true"})})}),e.jsx(q,{children:e.jsx(p,{size:"icon",variant:"outline",className:"disabled:pointer-events-none disabled:opacity-50 bg-gray-800 border-gray-600 text-gray-200 hover:bg-gray-700",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),"aria-label":"Go to previous page",children:e.jsx(us,{size:16,strokeWidth:2,"aria-hidden":"true"})})}),e.jsx(q,{children:e.jsx(p,{size:"icon",variant:"outline",className:"disabled:pointer-events-none disabled:opacity-50 bg-gray-800 border-gray-600 text-gray-200 hover:bg-gray-700",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),"aria-label":"Go to next page",children:e.jsx(gs,{size:16,strokeWidth:2,"aria-hidden":"true"})})}),e.jsx(q,{children:e.jsx(p,{size:"icon",variant:"outline",className:"disabled:pointer-events-none disabled:opacity-50 bg-gray-800 border-gray-600 text-gray-200 hover:bg-gray-700",onClick:()=>s.lastPage(),disabled:!s.getCanNextPage(),"aria-label":"Go to last page",children:e.jsx(xs,{size:16,strokeWidth:2,"aria-hidden":"true"})})})]})})})]})]})}function fa({client:s}){const a=()=>s.status==="completed"||s.status==="converted"?100:s.status==="delivery"?90:s.status==="in_progress"?70:s.status==="qualifying"?40:s.status==="contacted"?20:10;return e.jsxs("div",{className:"flex items-center gap-2 min-w-[120px]",children:[e.jsx(te,{value:a(),className:"h-2 flex-1",style:{backgroundColor:"rgba(255, 255, 255, 0.1)"}}),e.jsxs("span",{className:"text-xs text-gray-400 min-w-[30px]",children:[a(),"%"]})]})}function Qe({lastActivity:s}){const a=Math.floor(Math.random()*14),r=()=>a<=1?"text-green-400":a<=3?"text-orange-400":a<=7?"text-yellow-400":"text-gray-400",t=()=>a===0?"Today":a===1?"Yesterday":`${a}d ago`;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:`h-3 w-3 ${r()}`}),e.jsx("span",{className:`text-xs ${r()}`,children:t()})]})}function U({value:s,onSave:a,type:r="text",options:t,className:l}){const[o,c]=m.useState(!1),[x,n]=m.useState(String(s||"")),i=m.useRef(null),b=()=>{a(x),c(!1)},u=()=>{n(String(s||"")),c(!1)},j=h=>{h.key==="Enter"?b():h.key==="Escape"&&u()};return m.useEffect(()=>{o&&i.current&&(i.current.focus(),i.current.select())},[o]),o?e.jsxs("div",{className:"flex items-center gap-1",children:[r==="select"&&t?e.jsxs(re,{value:x,onValueChange:n,children:[e.jsx(le,{className:"h-8 bg-black/60 border-orange-500/30 text-white focus:border-orange-500",children:e.jsx(ne,{})}),e.jsx(ie,{className:"bg-black/90 border-orange-500/30 backdrop-blur-xl",children:t.map(h=>e.jsx(M,{value:h.value,className:"text-white hover:bg-orange-500/10 focus:bg-orange-500/20",children:h.label},h.value))})]}):e.jsx(F,{ref:i,value:x,onChange:h=>n(h.target.value),onKeyDown:j,onBlur:b,type:r==="number"?"number":"text",className:"h-8 bg-black/60 border-orange-500/30 text-white focus:border-orange-500"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{size:"sm",variant:"ghost",onClick:b,className:"h-6 w-6 p-0 text-green-400 hover:bg-green-400/20",children:e.jsx(_e,{size:12})}),e.jsx(p,{size:"sm",variant:"ghost",onClick:u,className:"h-6 w-6 p-0 text-red-400 hover:bg-red-400/20",children:e.jsx(Pe,{size:12})})]})]}):e.jsxs("div",{onClick:()=>c(!0),className:v("cursor-pointer px-2 py-1 rounded hover:bg-orange-500/10 min-h-[32px] flex items-center group transition-colors",l),children:[e.jsx("span",{className:"flex-1",children:s||"-"}),e.jsx(vs,{size:12,className:"opacity-0 group-hover:opacity-70 text-orange-400 ml-2 transition-opacity"})]})}function va(s){const a=oe.find(t=>t.value===s),r=(a==null?void 0:a.label)||s.charAt(0).toUpperCase()+s.slice(1);switch(s){case"completed":case"converted":return e.jsx(R,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:r});case"contacted":case"in_progress":return e.jsx(R,{className:"bg-orange-500/20 text-orange-400 border-orange-500/30",children:r});case"qualifying":return e.jsx(R,{className:"bg-blue-500/20 text-blue-400 border-blue-500/30",children:r});case"delivery":return e.jsx(R,{className:"bg-purple-500/20 text-purple-400 border-purple-500/30",children:r});case"churned":return e.jsx(R,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:r});case"pending":case"new":default:return e.jsx(R,{className:"bg-amber-500/20 text-amber-400 border-amber-500/30",children:r})}}const oe=[{value:"new",label:"New Lead",color:"amber"},{value:"contacted",label:"Contacted",color:"orange"},{value:"qualifying",label:"Qualifying",color:"blue"},{value:"in_progress",label:"In Progress",color:"orange"},{value:"delivery",label:"In Delivery",color:"purple"},{value:"completed",label:"Completed",color:"green"},{value:"converted",label:"Converted",color:"green"},{value:"pending",label:"Pending",color:"amber"},{value:"churned",label:"Churned",color:"red"}],Na=s=>[{id:"select",header:({table:a})=>e.jsx(G,{checked:a.getIsAllPageRowsSelected()?!0:a.getIsSomePageRowsSelected()?"indeterminate":!1,onCheckedChange:r=>a.toggleAllPageRowsSelected(!!r),"aria-label":"Select all",className:"border-orange-500/30 data-[state=checked]:bg-orange-600 data-[state=checked]:border-orange-600"}),cell:({row:a})=>e.jsx(G,{checked:a.getIsSelected(),onCheckedChange:r=>a.toggleSelected(!!r),"aria-label":"Select row",className:"border-orange-500/30 data-[state=checked]:bg-orange-600 data-[state=checked]:border-orange-600"}),size:28,enableSorting:!1,enableHiding:!1},{header:"Name",accessorKey:"full_name",cell:({row:a})=>e.jsx(U,{value:a.getValue("full_name"),onSave:r=>s(a.original.id,"full_name",r),className:"font-medium"}),size:180,enableHiding:!1,filterFn:(a,r,t)=>[a.original.full_name,a.original.email||""].join(" ").toLowerCase().includes((t!=null?t:"").toLowerCase())},{header:"Email",accessorKey:"email",size:210,cell:({row:a})=>e.jsx(U,{value:a.getValue("email"),onSave:r=>s(a.original.id,"email",r)})},{header:"Business Name",accessorKey:"business_name",size:170,cell:({row:a})=>e.jsx(U,{value:a.getValue("business_name"),onSave:r=>s(a.original.id,"business_name",r)})},{header:"Status",accessorKey:"status",cell:({row:a})=>e.jsx(U,{value:a.getValue("status"),onSave:r=>s(a.original.id,"status",r),type:"select",options:oe}),size:120,filterFn:(a,r,t)=>{if(!(t!=null&&t.length))return!0;const l=a.getValue(r);return t.includes(l)}},{header:"Project",accessorKey:"project_name",size:190,cell:({row:a})=>e.jsx(U,{value:a.getValue("project_name"),onSave:r=>s(a.original.id,"project_name",r)})},{header:"Balance",accessorKey:"estimated_price",cell:({row:a})=>e.jsx(U,{value:a.getValue("estimated_price"),onSave:r=>s(a.original.id,"estimated_price",r),type:"number"}),size:120},{header:"Progress",accessorKey:"progress",cell:({row:a})=>e.jsx(fa,{client:a.original}),size:140,enableSorting:!1},{header:"Last Activity",accessorKey:"last_activity",cell:({row:a})=>e.jsx(Qe,{lastActivity:a.getValue("last_activity")}),size:110,enableSorting:!1},{id:"viewClient",header:"Client Page",cell:({row:a})=>e.jsx(xa,{clientId:a.original.id}),size:130,enableSorting:!1,enableHiding:!1},{id:"actions",header:()=>e.jsx("span",{className:"sr-only",children:"Actions"}),cell:({row:a})=>e.jsx(Xe,{row:a,onUpdateField:s}),size:60,enableHiding:!1}];function Xe({row:s,onUpdateField:a}){const r=()=>{console.log("Delete client:",s.original.id)};return e.jsxs(Ve,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx("div",{className:"flex justify-end",children:e.jsx(p,{size:"icon",variant:"ghost",className:"shadow-none text-orange-400 hover:text-orange-300 hover:bg-orange-500/10","aria-label":"Edit client",children:e.jsx(fs,{size:16,strokeWidth:2,"aria-hidden":"true"})})})}),e.jsxs(Te,{align:"end",className:"bg-black/90 border-orange-500/30 backdrop-blur-xl",children:[e.jsx(Re,{className:"text-orange-300",children:"Client Actions"}),e.jsxs(Fs,{onClick:r,className:"text-red-400 hover:text-red-300 hover:bg-red-500/20",children:[e.jsx(ke,{size:14,className:"mr-2"}),"Delete Client"]})]})]})}function ya({onAddClient:s,columnsCount:a}){const[r,t]=m.useState(!1),[l,o]=m.useState({full_name:"",email:"",business_name:"",status:"new",project_name:"",estimated_price:0}),c=()=>{(l.full_name||l.business_name)&&(s(l),o({full_name:"",email:"",business_name:"",status:"new",project_name:"",estimated_price:0}),t(!1))},x=()=>{o({full_name:"",email:"",business_name:"",status:"new",project_name:"",estimated_price:0}),t(!1)};return r?e.jsxs(H,{className:"border-orange-500/30 bg-black/40 backdrop-blur-sm",children:[e.jsx(_,{children:e.jsx(G,{disabled:!0,className:"border-orange-500/30"})}),e.jsx(_,{children:e.jsx(F,{value:l.full_name||"",onChange:n=>o(i=>L(f({},i),{full_name:n.target.value})),placeholder:"Full Name",className:"h-8 bg-black/60 border-orange-500/30 text-white focus:border-orange-500 placeholder:text-gray-400"})}),e.jsx(_,{children:e.jsx(F,{value:l.email||"",onChange:n=>o(i=>L(f({},i),{email:n.target.value})),placeholder:"Email",type:"email",className:"h-8 bg-black/60 border-orange-500/30 text-white focus:border-orange-500 placeholder:text-gray-400"})}),e.jsx(_,{children:e.jsx(F,{value:l.business_name||"",onChange:n=>o(i=>L(f({},i),{business_name:n.target.value})),placeholder:"Business Name",className:"h-8 bg-black/60 border-orange-500/30 text-white focus:border-orange-500 placeholder:text-gray-400"})}),e.jsx(_,{children:e.jsxs(re,{value:l.status||"new",onValueChange:n=>o(i=>L(f({},i),{status:n})),children:[e.jsx(le,{className:"h-8 bg-black/60 border-orange-500/30 text-white focus:border-orange-500",children:e.jsx(ne,{})}),e.jsx(ie,{className:"bg-black/90 border-orange-500/30 backdrop-blur-xl",children:oe.map(n=>e.jsx(M,{value:n.value,className:"text-white hover:bg-orange-500/10 focus:bg-orange-500/20",children:n.label},n.value))})]})}),e.jsx(_,{children:e.jsx(F,{value:l.project_name||"",onChange:n=>o(i=>L(f({},i),{project_name:n.target.value})),placeholder:"Project Name",className:"h-8 bg-black/60 border-orange-500/30 text-white focus:border-orange-500 placeholder:text-gray-400"})}),e.jsx(_,{children:e.jsx(F,{value:l.estimated_price||"",onChange:n=>o(i=>L(f({},i),{estimated_price:parseFloat(n.target.value)||0})),placeholder:"0.00",type:"number",className:"h-8 bg-black/60 border-orange-500/30 text-white focus:border-orange-500 placeholder:text-gray-400"})}),e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{value:10,className:"h-2 flex-1"}),e.jsx("span",{className:"text-xs text-gray-400",children:"10%"})]})}),e.jsx(_,{children:e.jsx(Qe,{})}),e.jsx(_,{children:"-"}),e.jsx(_,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{size:"sm",onClick:c,className:"h-6 w-6 p-0 bg-green-600 hover:bg-green-700 border-green-500",children:e.jsx(_e,{size:12})}),e.jsx(p,{size:"sm",variant:"ghost",onClick:x,className:"h-6 w-6 p-0 text-red-400 hover:bg-red-400/20",children:e.jsx(Pe,{size:12})})]})})]}):e.jsx(H,{className:"border-dashed border-orange-500/30 hover:bg-orange-500/5 cursor-pointer transition-colors",onClick:()=>t(!0),children:e.jsx(_,{colSpan:a,className:"text-center py-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-orange-400 hover:text-orange-300 transition-colors",children:[e.jsx(se,{size:16}),e.jsx("span",{children:"Add new client"})]})})})}function wa({clients:s}){const a=m.useMemo(()=>{console.log("ClientMetrics calculating from real data:",s.length,"clients"),console.log("Sample client data:",s.map(u=>({name:u.business_name,status:u.status,price:u.estimated_price})));const r=s.length,t=["In Progress","Contacted","in_progress","contacted","qualifying"],l=s.filter(u=>{const j=u.status||"",h=u.progress||"";return t.includes(j)||t.includes(h)}).length,o=["Completed","completed","converted","Delivered"],c=s.filter(u=>{const j=u.status||"",h=u.progress||"";return o.includes(j)||o.includes(h)}).length,x=s.reduce((u,j)=>{const h=typeof j.estimated_price=="number"?j.estimated_price:0;return u+h},0),n=r>0?x/r:0,i=["Not contacted","new","pending"],b=s.filter(u=>{const j=u.status||"";return i.includes(j)}).length;return{total:r,active:l,completed:c,revenue:x,avgValue:n,pending:b,conversionRate:r>0?Math.round(c/r*100):0}},[s]);return e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Client Overview"}),e.jsxs("span",{className:"text-xs text-gray-500 bg-black/40 px-2 py-1 rounded border border-orange-500/20",children:["Real Data • ",new Date().toLocaleDateString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-black/40 backdrop-blur-sm border border-orange-500/20 rounded-lg p-4 hover:bg-black/60 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ps,{className:"h-4 w-4 text-orange-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Total Clients"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:a.total}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a.pending," new leads"]})]}),e.jsxs("div",{className:"bg-black/40 backdrop-blur-sm border border-orange-500/20 rounded-lg p-4 hover:bg-black/60 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Se,{className:"h-4 w-4 text-orange-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Active Projects"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:a.active}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"In progress"})]}),e.jsxs("div",{className:"bg-black/40 backdrop-blur-sm border border-orange-500/20 rounded-lg p-4 hover:bg-black/60 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(bs,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Completed"})]}),e.jsx("p",{className:"text-2xl font-bold text-white",children:a.completed}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a.conversionRate,"% conversion"]})]}),e.jsxs("div",{className:"bg-black/40 backdrop-blur-sm border border-orange-500/20 rounded-lg p-4 hover:bg-black/60 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(js,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Total Value"})]}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:["£",a.revenue.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["£",Math.round(a.avgValue)," avg"]})]})]})]})}function Ca({searchQuery:s="",statusFilter:a="all",onSearchChange:r,onStatusFilterChange:t}){m.useId();const{toast:l}=Z(),{clients:o,refetch:c}=Q({searchQuery:s,statusFilter:a,sortColumn:"updated_at",sortDirection:"desc"}),[x,n]=m.useState([]),[i,b]=m.useState({}),[u,j]=m.useState({pageIndex:0,pageSize:10}),[h,k]=m.useState([{id:"full_name",desc:!1}]),w=(y,P,V)=>E(this,null,function*(){try{console.log("Updating client:",{id:y,field:P,value:V}),l({title:"Client Updated",description:`${P} has been updated successfully.`}),yield c()}catch(T){l({title:"Update Failed",description:"Failed to update client. Please try again.",variant:"destructive"})}}),S=y=>E(this,null,function*(){try{console.log("Adding new client:",y),l({title:"Client Added",description:"New client has been added successfully."}),yield c()}catch(P){l({title:"Add Failed",description:"Failed to add new client. Please try again.",variant:"destructive"})}}),C=m.useMemo(()=>Na(w),[]),N=m.useMemo(()=>o.map(y=>L(f({},y),{id:y.id})),[o]),z=hs({data:N,columns:C,getCoreRowModel:Ys(),getSortedRowModel:Xs(),getPaginationRowModel:Qs(),getFilteredRowModel:Zs(),getFacetedUniqueValues:Gs(),onSortingChange:k,onPaginationChange:j,onColumnFiltersChange:n,onColumnVisibilityChange:b,state:{sorting:h,pagination:u,columnFilters:x,columnVisibility:i},enableSortingRemoval:!1,manualPagination:!1});return e.jsxs("div",{className:"w-full px-0 sm:px-2 lg:px-4 xl:px-0",children:[e.jsx(wa,{clients:N}),e.jsx(ja,{table:z,columns:C,searchQuery:s,statusFilter:a,onSearchChange:r,onStatusFilterChange:t,renderRowActions:y=>e.jsx(Xe,{row:y,onUpdateField:w}),statusBadge:va,addButton:e.jsxs(p,{className:"ml-auto bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white shadow-lg shadow-orange-500/25",variant:"default",children:[e.jsx(se,{className:"-ms-1 me-2 opacity-90",size:16,strokeWidth:2,"aria-hidden":"true"}),"Add client"]}),deleteSelectedTitle:"Delete client(s)",addNewRow:e.jsx(ya,{onAddClient:S,columnsCount:C.length})})]})}function ka(t){return E(this,arguments,function*({email:s,password:a,clientId:r}){try{const{data:l,error:o}=yield K.auth.admin.listUsers();if(o)return{success:!1,message:"Could not check if email already exists."};let c=null;if(l!=null&&l.users){const i=l.users.find(b=>b.email===s);i&&(c=i.id)}if(!c){const{data:n,error:i}=yield K.auth.admin.createUser({email:s,password:a,email_confirm:!0});if(i||!(n!=null&&n.user))return{success:!1,message:(i==null?void 0:i.message)||"Failed to create user."};c=n.user.id}const{error:x}=yield K.from("client_user_auth").upsert([{client_id:r,auth_user_id:c}],{onConflict:"client_id,auth_user_id"});return x?{success:!1,message:"Failed to link user to client. "+x.message}:(yield K.from("client_onboarding").update({email:s}).eq("id",r),{success:!0,message:"Client user created and linked successfully!"})}catch(l){return{success:!1,message:(l==null?void 0:l.message)||"Something went wrong."}}})}function Sa({open:s,onOpenChange:a,clientId:r,clientEmail:t,onSuccess:l}){const{toast:o}=Z(),[c,x]=m.useState(t||""),[n,i]=m.useState(""),[b,u]=m.useState(!1),j=h=>E(this,null,function*(){h.preventDefault(),u(!0);const k=yield ka({email:c,password:n,clientId:r});u(!1),o({title:k.success?"Client Login Created":"Error",description:k.message,variant:k.success?"default":"destructive"}),k.success&&(a(!1),l&&l())});return m.useEffect(()=>{s&&(x(t||""),i(""))},[s,t]),e.jsx(Js,{open:s,onOpenChange:a,children:e.jsxs(ea,{children:[e.jsx(sa,{children:e.jsx(aa,{children:"Create Client Login"})}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 text-siso-text",children:"Email"}),e.jsx(F,{required:!0,type:"email",placeholder:"client@email.com",value:c,onChange:h=>x(h.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 text-siso-text",children:"Password"}),e.jsx(F,{required:!0,type:"password",minLength:6,value:n,onChange:h=>i(h.target.value),placeholder:"Temporary password"})]}),e.jsxs(ta,{children:[e.jsx(p,{variant:"outline",type:"button",onClick:()=>a(!1),disabled:b,children:"Cancel"}),e.jsx(p,{type:"submit",disabled:b||!c||!n,children:b?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"h-4 w-4 animate-spin mr-2"}),"Creating..."]}):"Create Login"})]})]})]})})}function _a({client:s,onClick:a}){const[r,t]=m.useState(!1),l=!s.email;return e.jsxs("div",{className:"bg-background border rounded-lg shadow-sm p-4 hover:shadow-lg transition group cursor-pointer",onClick:a,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-white",children:s.business_name||s.full_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.project_name||"-"})]}),l&&e.jsx(p,{size:"sm",variant:"secondary",className:"text-xs",onClick:o=>{o.stopPropagation(),t(!0)},children:"Create Login"})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(R,{variant:s.status==="completed"?"success":s.status==="in_progress"?"default":"secondary",children:s.status==="completed"?"Completed":s.status==="in_progress"?"In Progress":"Pending"}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[e.jsx(ae,{className:"h-3 w-3 mr-1"}),Ee(new Date(s.updated_at),{addSuffix:!0})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[s.current_step,"/",s.total_steps]})]}),e.jsx(te,{value:s.current_step/s.total_steps*100})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.full_name,className:"h-6 w-6 rounded-full mr-2"}):e.jsx(Ns,{className:"h-5 w-5 mr-2 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:s.full_name})]}),e.jsxs(p,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:["Details ",e.jsx(ee,{className:"ml-1 h-3 w-3"})]})]}),e.jsx(Sa,{open:r,onOpenChange:t,clientId:s.id,clientEmail:s.email,onSuccess:()=>{}})]})}function Pa({status:s,className:a}){const r=()=>{switch(s.toLowerCase()){case"active":return"bg-emerald-500/15 text-emerald-500 border-emerald-500/30 shadow-emerald-500/10";case"pending":return"bg-amber-500/15 text-amber-500 border-amber-500/30 shadow-amber-500/10";case"completed":return"bg-blue-500/15 text-blue-500 border-blue-500/30 shadow-blue-500/10";case"cancelled":return"bg-rose-500/15 text-rose-500 border-rose-500/30 shadow-rose-500/10";case"on hold":return"bg-violet-500/15 text-violet-500 border-violet-500/30 shadow-violet-500/10";case"proposal":return"bg-cyan-500/15 text-cyan-500 border-cyan-500/30 shadow-cyan-500/10";case"negotiation":return"bg-fuchsia-500/15 text-fuchsia-500 border-fuchsia-500/30 shadow-fuchsia-500/10";default:return"bg-muted/50 text-muted-foreground border-muted/50 shadow-muted/10"}};return e.jsx("div",{className:v("inline-flex items-center justify-center rounded-full px-2.5 py-0.5","text-xs font-medium border shadow-sm transition-all duration-200","backdrop-blur-sm",r(),a),children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:v("h-1.5 w-1.5 rounded-full",s.toLowerCase()==="active"&&"animate-pulse")}),e.jsx("span",{children:s})]})})}function Da({clientId:s,isOpen:a,onClose:r}){var i;const{clientData:t,loading:l,updateTodos:o,isUpdating:c}=qs(s),x=ys(),n=()=>{t&&(x(`/admin/clients/${t.id}`),r())};return e.jsx(ra,{open:a,onOpenChange:r,children:e.jsx(la,{className:"sm:max-w-xl overflow-y-auto",children:l||!t?e.jsxs("div",{className:"space-y-6 pt-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(B,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"h-4 w-[200px]"}),e.jsx(B,{className:"h-3 w-[150px]"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{className:"h-4 w-full"}),e.jsx(B,{className:"h-4 w-full"}),e.jsx(B,{className:"h-4 w-2/3"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(na,{className:"pb-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(ia,{className:"text-2xl",children:t.full_name||"Unnamed Client"}),e.jsxs(p,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:n,children:[e.jsx(ws,{className:"h-4 w-4"}),"View Full Details"]})]}),e.jsx(oa,{children:t.business_name||"No business name provided"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(Ts,{className:"h-16 w-16 border-2 border-muted",children:[e.jsx(Rs,{src:t.avatar_url||void 0,alt:t.full_name||"Client"}),e.jsx(Ms,{className:"text-lg bg-primary/10",children:((i=t.full_name)==null?void 0:i.substring(0,2).toUpperCase())||"CL"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(Pa,{status:t.status}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.email&&e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Cs,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ks,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Ss,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[t.project_name&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Project:"})," ",e.jsx("span",{className:"text-sm",children:t.project_name})]}),t.company_niche&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Industry:"})," ",e.jsx("span",{className:"text-sm",children:t.company_niche})]}),t.website_url&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Website:"})," ",e.jsx("a",{href:t.website_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:underline",children:t.website_url})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Client Since:"})," ",e.jsx("span",{className:"text-sm",children:new Date(t.created_at).toLocaleDateString()})]})]}),e.jsx(ma,{className:"my-4"}),e.jsxs(ca,{defaultValue:"overview",children:[e.jsxs(da,{className:"mb-4 grid w-full grid-cols-3",children:[e.jsx(Y,{value:"overview",children:"Overview"}),e.jsx(Y,{value:"tasks",children:"Tasks"}),e.jsx(Y,{value:"documents",children:"Documents"})]}),e.jsxs(J,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Project Status"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Onboarding"}),e.jsxs("div",{className:"text-2xl font-semibold mt-1",children:[t.current_step||0,"/",t.total_steps||5]})]}),e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Completion"}),e.jsxs("div",{className:"text-2xl font-semibold mt-1",children:[Math.round(t.current_step/(t.total_steps||5)*100),"%"]})]})]})]}),t.notion_plan_url&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Project Plan"}),e.jsxs("a",{href:t.notion_plan_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 border rounded hover:bg-muted/50",children:[e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 120 126",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M20.6927 21.9927C24.5927 25.4927 25.7927 24.9927 35.4927 23.9927L96.1927 17.3927C97.3927 17.3927 96.4927 16.2927 95.9927 16.0927L85.4927 8.59271C83.3927 6.89271 80.5927 4.79271 74.7927 5.49271L17.6927 12.8927C15.9927 13.1927 15.4927 14.2927 16.1927 14.9927L20.6927 21.9927Z",fill:"black"}),e.jsx("path",{d:"M22.1927 37.1927V105.793C22.1927 109.793 24.1927 111.093 28.9927 110.793L96.6927 103.593C101.493 103.293 102.993 100.793 102.993 97.1927V29.2927C102.993 25.6927 101.193 23.7927 97.1927 24.0927L27.9927 31.4927C23.8927 31.9927 22.1927 33.5927 22.1927 37.1927Z",fill:"white"}),e.jsx("path",{d:"M60.1927 40.4928C60.1927 41.9928 58.8927 43.4928 56.7927 43.5928L32.5927 45.8928V81.3928C32.5927 83.7928 31.1927 85.1928 28.9927 85.3928C26.7927 85.5928 25.0927 84.4928 25.0927 81.9928V33.8928C25.0927 31.3928 26.3927 29.7928 28.9927 29.3928L56.9927 26.2928C58.8927 25.9928 60.1927 27.7928 60.1927 29.6928V40.4928Z",fill:"black"}),e.jsx("path",{d:"M63.1927 56.9928V97.1928C63.1927 99.9928 64.9928 100.893 67.3928 98.6928L99.7928 69.6928C101.393 68.1928 101.093 66.7928 99.0928 66.4928L67.9928 62.0928C64.9928 61.4928 63.1927 62.9928 63.1927 65.7928V80.9928L63.1927 56.9928Z",fill:"#F2F2F2"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Notion Project Plan"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"View detailed project plan in Notion"})]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(p,{onClick:n,className:"w-full",children:"View Complete Project Details"})})]}),e.jsxs(J,{value:"tasks",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Tasks & To-Do Items"}),e.jsx(ua,{todos:t.todos||[],clientId:t.id,onUpdate:b=>o(b),disabled:c})]}),e.jsxs(J,{value:"documents",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Documents & Links"}),e.jsxs("div",{className:"space-y-2",children:[t.notion_plan_url&&e.jsxs("a",{href:t.notion_plan_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 border rounded hover:bg-muted/50",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 120 126",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M20.6927 21.9927C24.5927 25.4927 25.7927 24.9927 35.4927 23.9927L96.1927 17.3927C97.3927 17.3927 96.4927 16.2927 95.9927 16.0927L85.4927 8.59271C83.3927 6.89271 80.5927 4.79271 74.7927 5.49271L17.6927 12.8927C15.9927 13.1927 15.4927 14.2927 16.1927 14.9927L20.6927 21.9927Z",fill:"black"}),e.jsx("path",{d:"M22.1927 37.1927V105.793C22.1927 109.793 24.1927 111.093 28.9927 110.793L96.6927 103.593C101.493 103.293 102.993 100.793 102.993 97.1927V29.2927C102.993 25.6927 101.193 23.7927 97.1927 24.0927L27.9927 31.4927C23.8927 31.9927 22.1927 33.5927 22.1927 37.1927Z",fill:"white"}),e.jsx("path",{d:"M60.1927 40.4928C60.1927 41.9928 58.8927 43.4928 56.7927 43.5928L32.5927 45.8928V81.3928C32.5927 83.7928 31.1927 85.1928 28.9927 85.3928C26.7927 85.5928 25.0927 84.4928 25.0927 81.9928V33.8928C25.0927 31.3928 26.3927 29.7928 28.9927 29.3928L56.9927 26.2928C58.8927 25.9928 60.1927 27.7928 60.1927 29.6928V40.4928Z",fill:"black"}),e.jsx("path",{d:"M63.1927 56.9928V97.1928C63.1927 99.9928 64.9928 100.893 67.3928 98.6928L99.7928 69.6928C101.393 68.1928 101.093 66.7928 99.0928 66.4928L67.9928 62.0928C64.9928 61.4928 63.1927 62.9928 63.1927 65.7928V80.9928L63.1927 56.9928Z",fill:"#F2F2F2"})]}),e.jsx("span",{children:"Notion Project Plan"})]}),t.website_url&&e.jsxs("a",{href:t.website_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 border rounded hover:bg-muted/50",children:[e.jsx(Aa,{className:"h-5 w-5"}),e.jsx("span",{children:"Client Website"})]}),t.development_url&&e.jsxs("a",{href:t.development_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-3 border rounded hover:bg-muted/50",children:[e.jsx(za,{className:"h-5 w-5"}),e.jsx("span",{children:"Development Site"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(p,{onClick:n,className:"w-full",children:"View All Documents"})})]})]})]})]})})})}function Aa(s){return e.jsxs("svg",L(f({},s),{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"2",x2:"22",y1:"12",y2:"12"}),e.jsx("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"})]}))}function za(s){return e.jsxs("svg",L(f({},s),{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"16 18 22 12 16 6"}),e.jsx("polyline",{points:"8 6 2 12 8 18"})]}))}function La({searchQuery:s="",statusFilter:a="all",sortColumn:r="updated_at",sortDirection:t="desc",viewMode:l,setViewMode:o}){const[c,x]=m.useState(null),{clients:n,isLoading:i,refetch:b}=Q({searchQuery:s,statusFilter:a,sortColumn:r,sortDirection:t,pageSize:100});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:i?Array.from({length:8}).map((u,j)=>e.jsxs("div",{className:"bg-background border rounded-lg shadow-sm p-4 animate-pulse h-52",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"h-10 w-10 bg-muted rounded-full mr-3"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-4 bg-muted rounded w-32 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-24"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-muted rounded w-full"}),e.jsx("div",{className:"h-3 bg-muted rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-muted rounded w-1/2"})]}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-6 bg-muted rounded w-20"}),e.jsx("div",{className:"h-8 bg-muted rounded w-8"})]})]},`skeleton-${j}`)):n.length===0?e.jsxs("div",{className:"col-span-full p-8 text-center",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No clients found"}),e.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your search or filters to find what you're looking for."})]}):n.map(u=>e.jsx(_a,{client:u,onClick:()=>x(u.id)},u.id))}),e.jsx(Da,{clientId:c,isOpen:c!==null,onClose:()=>{x(null),b().catch(console.error)}})]})}function Va(s,a){const[r,t]=m.useState(()=>{try{const o=window.localStorage.getItem(s);return o?JSON.parse(o):a}catch(o){return console.warn(`Error reading localStorage key "${s}":`,o),a}});return[r,o=>{try{const c=o instanceof Function?o(r):o;t(c),window.localStorage.setItem(s,JSON.stringify(c))}catch(c){console.warn(`Error setting localStorage key "${s}":`,c)}}]}function Fa({totalClients:s,totalProjectValue:a}){console.log("DashboardStats received:",{totalClients:s,totalProjectValue:a});const r=[{label:"Total Clients",value:s,icon:Ae,iconColor:"text-blue-400",bgColor:"bg-blue-500/20",borderColor:"border-blue-500/30"},{label:"Total Project Value",value:a>0?a.toLocaleString("en-GB",{style:"currency",currency:"GBP"}):"£0.00",icon:_s,iconColor:"text-green-400",bgColor:"bg-green-500/20",borderColor:"border-green-500/30"}];return e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:r.map(t=>e.jsx(Me,{className:v("bg-gray-900/50 backdrop-blur-sm border border-gray-800 hover:border-gray-700 transition-all duration-200",t.borderColor),children:e.jsx(Ie,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-400 mb-1",children:t.label}),e.jsx("p",{className:"text-2xl font-semibold text-white",children:t.value})]}),e.jsx("div",{className:v("p-3 rounded-lg border",t.bgColor,t.borderColor),children:e.jsx(t.icon,{className:v("w-6 h-6",t.iconColor)})})]})})},t.label))})}function Ta({client:s,onClick:a}){return e.jsxs(Me,{className:"bg-gray-900/50 border border-orange-500/30 hover:border-orange-500/50 transition-all duration-200 cursor-pointer group backdrop-blur-sm",onClick:a,children:[e.jsx(Is,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-white group-hover:text-orange-300 transition-colors",children:s.business_name||s.full_name}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:s.project_name||"No project name"})]}),e.jsx(R,{variant:"outline",className:"bg-orange-500/20 text-orange-300 border-orange-500/30 hover:bg-orange-500/30",children:"Priority"})]})}),e.jsx(Ie,{className:"py-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm",children:["Updated ",Ee(new Date(s.updated_at),{addSuffix:!0})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ps,{className:"h-4 w-4 text-orange-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white",children:"Requires immediate attention"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:s.todos&&s.todos.length>0?`${s.todos.length} pending tasks`:"No pending tasks"})]})]})]})}),e.jsx(Es,{className:"pt-0 pb-4",children:e.jsxs(p,{variant:"ghost",size:"sm",className:"ml-auto text-orange-300 hover:text-orange-200 hover:bg-orange-500/20 transition-colors",onClick:r=>{r.stopPropagation(),a==null||a()},children:["View Details ",e.jsx(ee,{className:"ml-1 h-3 w-3"})]})})]})}function Ra({limit:s=3}){const{clients:a,isLoading:r}=Q({pageSize:10,sortColumn:"priority",sortDirection:"desc"}),t=a.filter(l=>l.priority==="high").slice(0,s);return r?e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Priority Clients"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Array.from({length:s}).map((l,o)=>e.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-lg p-6 animate-pulse",children:[e.jsx("div",{className:"h-6 w-1/2 bg-gray-700 rounded mb-3"}),e.jsx("div",{className:"h-4 w-3/4 bg-gray-800 rounded mb-2"}),e.jsx("div",{className:"h-4 w-1/3 bg-gray-800 rounded"})]},o))})]}):t.length===0?null:e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Priority Clients"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(l=>e.jsx(Ta,{client:l},l.id))})]})}function Ma({viewMode:s,setViewMode:a}){return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{size:"sm",variant:s==="table"?"default":"outline",className:"rounded-md px-3 text-sm",onClick:()=>a("table"),children:"Table"}),e.jsx(p,{size:"sm",variant:s==="cards"?"default":"outline",className:"rounded-md px-3 text-sm",onClick:()=>a("cards"),children:"Cards"})]})}function Ia({searchQuery:s,onSearchChange:a,statusFilter:r,onStatusFilterChange:t,viewPreference:l,onViewPreferenceChange:o,onAddClient:c,totalClients:x,clients:n,onRefetch:i,viewMode:b,setViewMode:u}){const j=w=>{a(w.target.value)},h=w=>{t(w)},k=()=>{i&&i()};return e.jsx("div",{className:"flex flex-col gap-6 mb-3",children:e.jsxs("div",{className:"flex flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ds,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx(F,{placeholder:"Search clients...",value:s,onChange:j,className:"pl-9 border-gray-700/50 bg-gray-900/60 shadow-sm text-gray-100 placeholder:text-gray-400 focus:border-gray-600 focus:bg-gray-900/80"})]}),e.jsxs(re,{value:r,onValueChange:h,children:[e.jsxs(le,{className:"w-40 border-gray-700/50 bg-gray-900/60 shadow-sm text-gray-100 focus:border-gray-600",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2 text-gray-400"}),e.jsx(ne,{placeholder:"Status"})]}),e.jsxs(ie,{className:"bg-gray-900/95 text-gray-100 shadow-xl border-gray-700/50 z-50",children:[e.jsx(M,{value:"all",children:"All Statuses"}),e.jsx(M,{value:"active",children:"Active"}),e.jsx(M,{value:"pending",children:"Pending"}),e.jsx(M,{value:"in_progress",children:"In Progress"}),e.jsx(M,{value:"completed",children:"Completed"}),e.jsx(M,{value:"proposal",children:"Proposal"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[b&&u&&e.jsx(Ma,{viewMode:b,setViewMode:u}),e.jsx(p,{variant:"outline",size:"icon",className:"ml-1",onClick:k,title:"Refresh",children:e.jsx(As,{className:"h-4 w-4"})}),l&&o&&e.jsx(p,{variant:"outline",size:"icon",className:"ml-1",onClick:()=>{console.log("Open column customization")},title:"Columns",children:e.jsx(zs,{className:"h-4 w-4"})}),e.jsx(p,{variant:"outline",size:"icon",className:"ml-1",onClick:c,title:"Add Client",children:e.jsx(se,{className:"h-4 w-4"})})]})]})})}const Ea={columns:[{key:"business_name",label:"Business Name",visible:!0,width:200,pinned:!0},{key:"progress",label:"Progress",visible:!0,width:150},{key:"status",label:"Status",visible:!0,width:120,pinned:!0},{key:"project_name",label:"Project",visible:!0,width:180},{key:"estimated_price",label:"Balance",visible:!0,width:120},{key:"development_url",label:"Website",visible:!1,width:150},{key:"next_steps",label:"Next Steps",visible:!1,width:200},{key:"key_research",label:"Key Research",visible:!1,width:180},{key:"updated_at",label:"Updated",visible:!0,width:150},{key:"start_date",label:"Start Date",visible:!1,width:150},{key:"estimated_completion_date",label:"Est. Completion",visible:!1,width:150}],sortColumn:"updated_at",sortDirection:"desc",pageSize:20,showAllColumns:!1};function Ba({isAdmin:s}){const[a,r]=m.useState("all"),[t,l]=Va("client_view_preference_v2",Ea),[o,c]=m.useState("table"),[x,n]=m.useState(""),{clients:i=[],refetch:b}=Q({searchQuery:x,statusFilter:a,sortColumn:t.sortColumn,sortDirection:t.sortDirection,pageSize:1e3}),u=i.length,j=m.useMemo(()=>{const w=i.reduce((S,C)=>{const N=C.estimated_price||0;return console.log(`Client: ${C.business_name}, Price: ${N}`),S+N},0);return console.log("Total calculated project value:",w),console.log("All clients data:",i.map(S=>({name:S.business_name,price:S.estimated_price}))),w},[i]),h=w=>{l(S=>f(f({},S),w))},k=()=>E(this,null,function*(){try{yield b()}catch(w){console.error(w)}});return e.jsx("div",{className:"min-h-screen bg-black",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Fa,{totalClients:u,totalProjectValue:j}),e.jsx(Ra,{limit:3}),e.jsx(Ia,{searchQuery:x,onSearchChange:n,statusFilter:a,onStatusFilterChange:r,viewPreference:t,onViewPreferenceChange:h,onAddClient:()=>{},onRefetch:k,viewMode:o,setViewMode:c}),e.jsx("div",{className:"bg-gray-900 rounded-lg border border-gray-800 h-[calc(100vh-16rem)] flex flex-col",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:o==="table"?e.jsx(Ca,{searchQuery:x,statusFilter:a,onSearchChange:n,onStatusFilterChange:r}):e.jsx(La,{searchQuery:x,statusFilter:a,sortColumn:t.sortColumn,sortDirection:t.sortDirection,viewMode:o,setViewMode:c})})})]})})})}function tt(){const{isAdmin:s,isLoading:a}=ze(),{toast:r}=Z();return m.useEffect(()=>{!a&&!s&&r({variant:"destructive",title:"Access Denied",description:"You must be an admin to view this page."})},[s,a,r]),a?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[e.jsx(De,{className:"w-8 h-8 animate-spin text-siso-orange mb-4"}),e.jsx("p",{className:"text-siso-text",children:"Verifying admin access..."})]}):s?e.jsx(Ls,{children:e.jsx("div",{className:"min-h-screen pb-12",style:{background:"linear-gradient(90deg, #000000 0%, #221F26 100%)"},children:e.jsxs("div",{className:"container mx-auto px-2 py-6",children:[e.jsx(ga,{icon:Ae,title:"Clients Dashboard",subtitle:"Manage your organization's clients and view details"}),e.jsx(Ba,{isAdmin:s})]})})}):null}export{tt as default};
