var h=(t,a,s)=>new Promise((l,i)=>{var r=c=>{try{d(s.next(c))}catch(u){i(u)}},x=c=>{try{d(s.throw(c))}catch(u){i(u)}},d=c=>c.done?l(c.value):Promise.resolve(c.value).then(r,x);d((s=s.apply(t,a)).next())});import{r as m,j as e,bf as v,bg as w,aX as P}from"./vendor-C50ijZWh.js";import{s as g,C as j,a as b,b as y,c as N}from"./index-Blbobipf.js";import"./libs-B3eAAgHd.js";import"./supabase-D8k0GRjn.js";function S(){return h(this,null,function*(){try{const{count:t}=yield g.from("partners").select("*",{count:"exact",head:!0}).eq("status","active"),{data:a}=yield g.from("commissions").select("commission_amount").eq("status","paid"),s=(a==null?void 0:a.reduce((d,c)=>d+Number(c.commission_amount),0))||0,{count:l}=yield g.from("client_leads").select("*",{count:"exact",head:!0}).eq("status","completed"),{count:i}=yield g.from("partner_applications").select("*",{count:"exact",head:!0}),{count:r}=yield g.from("partner_applications").select("*",{count:"exact",head:!0}).eq("status","approved");return{success:!0,data:{activePartners:t||0,totalCommissionsPaid:s,successfulProjects:l||0,averageCommission:a!=null&&a.length?s/a.length:0,totalApplications:i||0,approvalRate:i?(r||0)/i*100:0},message:"Statistics retrieved successfully"}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error",message:"Failed to get statistics"}}})}function E(t="monthly",a=10){return h(this,null,function*(){try{const{data:s,error:l}=yield g.from("partners").select(`
        id,
        name,
        tier,
        total_earnings,
        total_deals
      `).eq("status","active").order("total_earnings",{ascending:!1}).limit(a);return l?{success:!1,error:l.message,message:"Failed to get leaderboard data"}:{success:!0,data:s.map((r,x)=>({partnerId:r.id,partnerName:r.name,tier:r.tier,totalEarnings:Number(r.total_earnings),totalDeals:r.total_deals,rank:x+1})),message:"Leaderboard retrieved successfully"}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error",message:"Failed to get leaderboard data"}}})}function I(){const[t,a]=m.useState(null),[s,l]=m.useState([]),[i,r]=m.useState(!0),[x,d]=m.useState(!1),[c,u]=m.useState(null),p=()=>h(this,null,function*(){r(!0),u(null);try{const n=yield S();if(n.success&&n.data)a(n.data);else throw new Error(n.error||"Failed to fetch statistics")}catch(n){const o=n instanceof Error?n.message:"Failed to load statistics";u(o),console.error("Error fetching partnership stats:",n)}finally{r(!1)}}),f=(n="monthly")=>h(this,null,function*(){d(!0);try{const o=yield E(n,10);if(o.success&&o.data)l(o.data);else throw new Error(o.error||"Failed to fetch leaderboard")}catch(o){o instanceof Error&&o.message,console.error("Error fetching leaderboard:",o)}finally{d(!1)}});return m.useEffect(()=>{p(),f()},[]),m.useEffect(()=>{const n=setInterval(()=>{p(),f()},3e5);return()=>clearInterval(n)},[]),{stats:t,leaderboard:s,isLoading:i,isLeaderboardLoading:x,error:c,refreshStats:p,refreshLeaderboard:f}}const C=()=>{const{stats:t,isLoading:a,error:s}=I();return a?e.jsx(j,{className:"bg-gray-800 border-gray-700 m-4",children:e.jsx(b,{children:e.jsxs(y,{className:"text-white flex items-center",children:[e.jsx(v,{className:"w-5 h-5 mr-2 animate-spin text-orange-500"}),"Testing Partnership Integration..."]})})}):s?e.jsxs(j,{className:"bg-gray-800 border-red-500 m-4",children:[e.jsx(b,{children:e.jsxs(y,{className:"text-red-400 flex items-center",children:[e.jsx(w,{className:"w-5 h-5 mr-2"}),"Integration Test Failed"]})}),e.jsx(N,{children:e.jsxs("p",{className:"text-red-300",children:["Error: ",s]})})]}):e.jsxs(j,{className:"bg-gray-800 border-green-500 m-4",children:[e.jsx(b,{children:e.jsxs(y,{className:"text-green-400 flex items-center",children:[e.jsx(P,{className:"w-5 h-5 mr-2"}),"Partnership Integration Test: SUCCESS"]})}),e.jsxs(N,{className:"text-white",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Partners"}),e.jsx("p",{className:"text-2xl font-bold text-orange-500",children:(t==null?void 0:t.activePartners)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Paid"}),e.jsxs("p",{className:"text-2xl font-bold text-green-500",children:["£",(t==null?void 0:t.totalCommissionsPaid.toFixed(2))||"0.00"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-300 text-sm",children:"Successful Projects"}),e.jsx("p",{className:"text-2xl font-bold text-blue-500",children:(t==null?void 0:t.successfulProjects)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-300 text-sm",children:"Approval Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-500",children:[(t==null?void 0:t.approvalRate.toFixed(1))||"0.0","%"]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-gray-700 rounded",children:e.jsxs("p",{className:"text-sm text-gray-300",children:["✅ Backend API connected",e.jsx("br",{}),"✅ Real-time data loaded",e.jsx("br",{}),"✅ Statistics updating correctly",e.jsx("br",{}),"✅ Ready for production deployment"]})})]})]})};function k(){return e.jsx("div",{className:"min-h-screen bg-gray-900 text-white",children:e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4 text-orange-500",children:"SISO Agency - System Tests"}),e.jsx("p",{className:"text-gray-300",children:"Validating app functionality and integrations"})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"p-8 bg-gray-800 rounded-lg shadow-lg max-w-md mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Basic App Test"}),e.jsx("p",{className:"mb-4",children:"If you can see this page, the basic app rendering is working correctly."}),e.jsx("div",{className:"p-4 bg-green-900/30 border border-green-500/20 rounded",children:e.jsx("p",{className:"text-green-400",children:"✅ This indicates that the routing system can render components properly."})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-4 text-orange-500",children:"Partnership Program Integration Test"}),e.jsx(C,{})]})]})})}export{k as default};
