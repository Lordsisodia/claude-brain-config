var ms=Object.defineProperty,us=Object.defineProperties;var hs=Object.getOwnPropertyDescriptors;var je=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var ze=(s,t,a)=>t in s?ms(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,_=(s,t)=>{for(var a in t||(t={}))$e.call(t,a)&&ze(s,a,t[a]);if(je)for(var a of je(t))Re.call(t,a)&&ze(s,a,t[a]);return s},I=(s,t)=>us(s,hs(t));var Ue=(s,t)=>{var a={};for(var r in s)$e.call(s,r)&&t.indexOf(r)<0&&(a[r]=s[r]);if(s!=null&&je)for(var r of je(s))t.indexOf(r)<0&&Re.call(s,r)&&(a[r]=s[r]);return a};var F=(s,t,a)=>new Promise((r,i)=>{var c=x=>{try{j(a.next(x))}catch(n){i(n)}},u=x=>{try{j(a.throw(x))}catch(n){i(n)}},j=x=>x.done?r(x.value):Promise.resolve(x.value).then(c,u);j((a=a.apply(s,t)).next())});import{dg as Ve,W as Ie,dr as ue,r as h,j as e,ds as xs,dt as ps,aC as Be,a$ as js,ah as he,aX as de,bg as ke,cq as fs,at as gs,bX as vs,du as Ns,av as bs,dv as ws,cz as ys,aQ as qe,b0 as Cs,c9 as Ss,bT as ks,X as _s,dw as Ls,cA as As,b5 as Is,aD as Fs,aa as le,cM as Ae,dx as Ts,I as Fe,dy as Ds,bN as fe,bj as Ps,N as Es,U as Ms,bw as Os,a2 as zs,dz as $s,by as Rs,L as He,bi as Ke,R as Us,dA as Vs,K as Bs}from"./vendor-C50ijZWh.js";import{A as qs}from"./AdminLayout-BZL16QJ9.js";import{A as Hs}from"./AdminPageTitle-BgXCcQq-.js";import{s as H,h as me,B as M,H as ge,u as Ks,d as g,N as f,I as z,D as Qe,t as We,v as Ge,w as Qs,x as _e,Q as W,_ as Ws,P as Gs,C as O,c as q,f as Le,T as Xs,i as Ys,j as Zs,k as Js,a as ee,b as se,g as te}from"./index-Blbobipf.js";import{T as Xe,a as Ye,b as G,c as X}from"./tabs-CsM4ZGNr.js";import{bL as A,bQ as et,bU as st,bV as tt,c5 as at,bS as rt,bW as lt,c6 as nt}from"./libs-B3eAAgHd.js";import{T as Te,a as De,b as U,c as $,d as Pe,e as T}from"./table-DWISvnW8.js";import{D as Ee,a as Me,b as Ze,c as Je,e as it,d as ct,f as ot}from"./dialog-CB9qAGL5.js";import{R as es,a as Y}from"./radio-group-BsuxOhY4.js";import{S as dt}from"./scroll-area-D4x0YgaW.js";import{T as Q}from"./textarea-B56zo4Tx.js";import{S as mt,b as ut,c as ht,d as xt,e as pt,f as jt}from"./sheet-EfhB7uWf.js";import{S as ve,a as Ne,b as be,c as we,d as D}from"./select-Ba1tjTaP.js";import"./supabase-D8k0GRjn.js";const ss=(s=10)=>{const t=Ve(),{data:a=[],isLoading:r,error:i,refetch:c}=Ie({queryKey:["instagram-leads",s],queryFn:()=>F(void 0,null,function*(){const{data:x,error:n}=yield H.from("instagram_leads").select("*").order("created_at",{ascending:!1}).limit(s);if(n)throw n;return x})}),u=ue({mutationFn:x=>F(void 0,null,function*(){const{data:n,error:d}=yield H.from("instagram_leads").insert([{username:x.username,status:"new"}]).select("*").single();if(d)throw d;return n}),onSuccess:()=>{t.invalidateQueries({queryKey:["instagram-leads"]})}}),j=ue({mutationFn:d=>F(void 0,[d],function*({id:x,data:n}){const{data:p,error:v}=yield H.from("instagram_leads").update(n).eq("id",x).select("*").single();if(v)throw v;return p}),onSuccess:()=>{t.invalidateQueries({queryKey:["instagram-leads"]})}});return{leads:a,isLoading:r,error:i,refetch:c,addLead:u,updateLead:j}},ft=s=>{const[t,a]=h.useState(s),[r,i]=h.useState("created_at"),[c,u]=h.useState("desc"),[j,x]=h.useState(!1),n=h.useCallback(()=>{x(!j)},[j]),d=h.useCallback((v,o)=>{const l=[...t],N=l[v];l.splice(v,1),l.splice(o,0,N),a(l)},[t]),p=h.useCallback(v=>{a(v)},[]);return{columns:t,setColumns:p,sortColumn:r,setSortColumn:i,sortDirection:c,setSortDirection:u,showAllColumns:j,toggleShowAllColumns:n,moveColumn:d}},gt=()=>{const s=Ve(),{data:t=[],isLoading:a}=Ie({queryKey:["outreach-accounts"],queryFn:()=>F(void 0,null,function*(){const{data:c,error:u}=yield H.from("outreach_accounts").select("*").order("created_at",{ascending:!1});if(u)throw u;return c})}),r=ue({mutationFn:c=>F(void 0,null,function*(){const{data:u,error:j}=yield H.from("outreach_accounts").insert([c]).select().single();if(j)throw j;return u}),onSuccess:()=>{s.invalidateQueries({queryKey:["outreach-accounts"]}),A.success("Account added successfully")},onError:c=>{A.error("Failed to add account"),console.error("Error adding account:",c)}}),i=ue({mutationFn:j=>F(void 0,null,function*(){var x=j,{id:c}=x,u=Ue(x,["id"]);const{data:n,error:d}=yield H.from("outreach_accounts").update(u).eq("id",c).select().single();if(d)throw d;return n}),onSuccess:()=>{s.invalidateQueries({queryKey:["outreach-accounts"]}),A.success("Account updated successfully")},onError:c=>{A.error("Failed to update account"),console.error("Error updating account:",c)}});return{accounts:t,isLoading:a,addAccount:r,updateAccount:i}},vt=[{key:"username",label:"Username",visible:!0,width:150,pinned:!0},{key:"full_name",label:"Name",visible:!0,width:180},{key:"followers_count",label:"Followers",visible:!0,width:120},{key:"following_count",label:"Following",visible:!0,width:120},{key:"posts_count",label:"Posts",visible:!0,width:100},{key:"bio",label:"Bio",visible:!0,width:200},{key:"profile_url",label:"Profile URL",visible:!0,width:150},{key:"status",label:"Status",visible:!0,width:120},{key:"source",label:"Source",visible:!0,width:120},{key:"outreach_account",label:"Outreach Account",visible:!0,width:150},{key:"followed",label:"Followed",visible:!0,width:100},{key:"commented",label:"Commented",visible:!0,width:120},{key:"messaged",label:"DMed",visible:!0,width:100},{key:"app_plan_status",label:"Plan Status",visible:!0,width:130},{key:"app_plan_url",label:"Plan URL",visible:!1,width:150},{key:"last_interaction",label:"Last Interaction",visible:!1,width:180},{key:"created_at",label:"Added Date",visible:!0,width:120},{key:"assigned_to",label:"Assigned To",visible:!1,width:150},{key:"notes",label:"Notes",visible:!1,width:200}];function Nt({children:s,pinnedColumns:t,className:a}){const r=h.useRef(null),[i,c]=h.useState(!1),[u,j]=h.useState(!0),[x,n]=h.useState(!1),[d,p]=h.useState(0);h.useEffect(()=>{if(r.current){const o=r.current.querySelector("thead");o&&(p(o.offsetHeight),document.documentElement.style.setProperty("--header-height",`${o.offsetHeight}px`))}},[]),h.useEffect(()=>{const o=()=>{if(r.current){const{scrollLeft:N,scrollTop:b,scrollWidth:w,clientWidth:S}=r.current;c(N>10),j(N<w-S-10),n(b>0)}},l=r.current;return l&&(l.addEventListener("scroll",o),o()),()=>{l&&l.removeEventListener("scroll",o)}},[]);const v=t.reduce((o,l)=>o+(l.width||150),0);return e.jsxs("div",{className:"relative rounded-md border overflow-hidden border-gray-800/30 bg-gray-900/50 shadow-lg backdrop-blur-sm",children:[i&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-8 bg-gradient-to-r from-gray-900/90 to-transparent z-10 pointer-events-none",style:{transform:"translate3d(0,0,0)",willChange:"opacity"}}),u&&e.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-8 bg-gradient-to-l from-gray-900/90 to-transparent z-10 pointer-events-none",style:{transform:"translate3d(0,0,0)",willChange:"opacity"}}),e.jsx("div",{ref:r,className:me("overflow-auto hide-scrollbar relative","transition-[background-color,border-color] duration-150","overscroll-x-none scroll-smooth",a),style:{maxWidth:"100%",maxHeight:"calc(100vh - 300px)",willChange:"transform, scroll-position",backfaceVisibility:"hidden",perspective:"1000px",transform:"translate3d(0,0,0)",contain:"content",WebkitOverflowScrolling:"touch"},children:e.jsxs("div",{style:{position:"relative",minWidth:"100%",contain:"layout style paint"},children:[t.length>0&&e.jsx("div",{className:me("absolute top-0 left-0 bottom-0 border-r border-gray-700/30 shadow-[4px_0_8px_rgba(0,0,0,0.3)]","transition-all duration-150",x&&"top-[var(--header-height)]"),style:{width:`${v}px`,transform:"translate3d(0,0,0)",willChange:"transform"}}),x&&e.jsx("div",{className:"sticky top-0 left-0 right-0 z-30 bg-gray-900/95 border-b border-gray-700/30 shadow-lg backdrop-blur-md",style:{height:`${d}px`,transform:"translate3d(0,0,0)",willChange:"transform"}}),s]})})]})}const bt=({visibleColumns:s,pinnedColumns:t,filteredLeads:a,selectedLeads:r,sortColumn:i,sortDirection:c,onSort:u,onSelectAll:j,onSelectLead:x,onRowClick:n,isLoading:d})=>{const p=(o,l)=>{switch(l){case"username":return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-7 h-7 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white mr-2",children:o.username.charAt(0).toUpperCase()}),e.jsxs("span",{children:["@",o.username]})]});case"followers_count":return o.followers_count?ge(o.followers_count):"N/A";case"status":return v(o.status);case"created_at":return new Date(o.created_at).toLocaleDateString();case"source":return e.jsx(M,{variant:"outline",children:"Instagram"});case"followed":return o.followed?e.jsx("div",{className:"bg-green-500/10 text-green-500 w-5 h-5 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-3 w-3"})}):e.jsx("div",{className:"bg-muted w-5 h-5 rounded-full flex items-center justify-center",children:e.jsx(ke,{className:"h-3 w-3 text-muted-foreground/50"})});case"commented":return o.commented?e.jsx("div",{className:"bg-green-500/10 text-green-500 w-5 h-5 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-3 w-3"})}):e.jsx("div",{className:"bg-muted w-5 h-5 rounded-full flex items-center justify-center",children:e.jsx(ke,{className:"h-3 w-3 text-muted-foreground/50"})});case"messaged":return o.messaged?e.jsx("div",{className:"bg-green-500/10 text-green-500 w-5 h-5 rounded-full flex items-center justify-center",children:e.jsx(de,{className:"h-3 w-3"})}):e.jsx("div",{className:"bg-muted w-5 h-5 rounded-full flex items-center justify-center",children:e.jsx(ke,{className:"h-3 w-3 text-muted-foreground/50"})});case"outreach_account":return o.outreach_account||e.jsx("span",{className:"text-muted-foreground",children:"Not assigned"});case"app_plan_status":return o.app_plan_status==="completed"?e.jsx(M,{className:"bg-green-500/20 text-green-400",children:"Completed"}):o.app_plan_status==="in_progress"?e.jsx(M,{className:"bg-blue-500/20 text-blue-400",children:"In Progress"}):e.jsx(M,{variant:"outline",children:"Not Started"});case"app_plan_url":return o.app_plan_url?e.jsxs("a",{href:o.app_plan_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline flex items-center",onClick:N=>N.stopPropagation(),children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"View Plan"]}):"-";case"last_interaction":return o.last_interaction_at?e.jsxs("div",{className:"flex items-center",children:[e.jsx(js,{className:"h-4 w-4 mr-1 text-muted-foreground"}),new Date(o.last_interaction_at).toLocaleDateString()]}):"-";case"assigned_to":return o.assigned_to||"-";case"notes":return o.notes||"-";default:return o[l]||"-"}},v=o=>{switch(o){case"contacted":return e.jsx(M,{className:"bg-blue-500/20 text-blue-400",children:"Contacted"});case"converted":return e.jsx(M,{className:"bg-green-500/20 text-green-400",children:"Converted"});case"new":default:return e.jsx(M,{className:"bg-amber-500/20 text-amber-400",children:"New"})}};return e.jsx(xs,{backend:ps,children:e.jsx(Nt,{pinnedColumns:t,className:"max-h-[calc(100vh-300px)]",children:e.jsxs(Te,{children:[e.jsx(De,{children:e.jsxs(U,{children:[e.jsx($,{className:"w-12 sticky left-0 bg-background z-20",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:r.length===a.length&&a.length>0,onChange:j,className:"rounded border-muted"})})}),s.map((o,l)=>{const N=!!o.pinned,b=i===o.key;let w=40;if(N)for(let S=0;S<l;S++)s[S].pinned&&(w+=s[S].width||150);return e.jsx($,{className:me("font-medium",N?"sticky bg-background z-20":""),style:{minWidth:`${o.width||150}px`,width:`${o.width||150}px`,left:N?`${w}px`:void 0},onClick:()=>u(o.key),children:e.jsxs("div",{className:"flex items-center cursor-pointer",children:[o.label,b&&e.jsx(Be,{className:me("ml-1 h-4 w-4 transition-transform",c==="desc"?"transform rotate-180":"")})]})},o.key)})]})}),e.jsx(Pe,{children:d?e.jsx(U,{children:e.jsx(T,{colSpan:s.length+1,className:"text-center py-10",children:"Loading leads..."})}):a.length===0?e.jsx(U,{children:e.jsx(T,{colSpan:s.length+1,className:"text-center py-10",children:"No leads found. Add your first lead."})}):a.map(o=>e.jsxs(U,{className:"cursor-pointer hover:bg-muted/30",onClick:()=>n(o.id),children:[e.jsx(T,{className:"sticky left-0 bg-background z-10",onClick:l=>{l.stopPropagation(),x(o.id)},children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:r.includes(o.id),onChange:()=>{},className:"rounded border-muted"})})}),s.map((l,N)=>{const b=!!l.pinned;let w=40;if(b)for(let S=0;S<N;S++)s[S].pinned&&(w+=s[S].width||150);return e.jsx(T,{className:me(b?"sticky bg-background z-10":""),style:{left:b?`${w}px`:void 0,maxWidth:`${l.width||150}px`},children:p(o,l.key)},`${o.id}-${l.key}`)})]},o.id))})]})})})};function wt({open:s,onOpenChange:t,columns:a,onColumnsChange:r}){const[i,c]=h.useState(""),[u,j]=h.useState(""),[x,n]=h.useState("text"),{toast:d}=Ks(),p=()=>{if(!i.trim()||!u.trim()){d({variant:"destructive",title:"Invalid column",description:"Please provide both a name and a key for the new column."});return}if(a.some(N=>N.key===u.trim())){d({variant:"destructive",title:"Duplicate column key",description:`A column with the key "${u}" already exists.`});return}const l={key:u.trim(),label:i.trim(),visible:!0};r([...a,l]),d({title:"Column added",description:`"${i}" column has been added to the table.`}),c(""),j(""),n("text")},v=l=>{const N=a.filter(b=>b.key!==l);r(N),d({title:"Column deleted",description:"The column has been removed from the table."})},o=l=>{const N=a.map(b=>b.key===l?I(_({},b),{visible:!b.visible}):b);r(N)};return e.jsx(Ee,{open:s,onOpenChange:t,children:e.jsxs(Me,{className:"max-w-4xl",children:[e.jsxs(Ze,{children:[e.jsx(Je,{children:"Customize Columns"}),e.jsx(it,{children:"Add, rename, or remove columns to customize your client table view."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 py-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Current Columns"}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(Te,{children:[e.jsx(De,{children:e.jsxs(U,{children:[e.jsx($,{className:"w-[50px]"}),e.jsx($,{children:"Name"}),e.jsx($,{className:"w-[100px]",children:"Visible"}),e.jsx($,{className:"w-[80px]",children:"Actions"})]})}),e.jsx(Pe,{children:a.map(l=>e.jsxs(U,{children:[e.jsx(T,{children:e.jsx(fs,{className:"h-4 w-4 text-muted-foreground cursor-move"})}),e.jsxs(T,{children:[e.jsx("div",{className:"font-medium",children:l.label||l.key.replace(/_/g," ")}),e.jsx("div",{className:"text-sm text-muted-foreground",children:l.key})]}),e.jsx(T,{children:e.jsxs(g,{variant:l.visible?"default":"outline",size:"sm",className:"h-7 w-16",onClick:()=>o(l.key),children:[l.visible?e.jsx(gs,{className:"h-4 w-4 mr-1"}):null,l.visible?"Yes":"No"]})}),e.jsx(T,{children:e.jsx(g,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>v(l.key),children:e.jsx(vs,{className:"h-4 w-4 text-destructive"})})})]},l.key))})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Add New Column"}),e.jsxs("div",{className:"space-y-3 border rounded-md p-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"column-name",children:"Column Name (Display Label)"}),e.jsx(z,{id:"column-name",placeholder:"e.g., Project Budget",value:i,onChange:l=>c(l.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{htmlFor:"column-key",children:"Column Key (Database Field)"}),e.jsx(z,{id:"column-key",placeholder:"e.g., project_budget",value:u,onChange:l=>j(l.target.value.replace(/\s+/g,"_").toLowerCase())}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"The key should be unique and use snake_case format (lowercase with underscores)."})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(f,{children:"Column Type"}),e.jsxs(es,{value:x,onValueChange:n,className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"text",id:"type-text"}),e.jsx(f,{htmlFor:"type-text",children:"Text"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"number",id:"type-number"}),e.jsx(f,{htmlFor:"type-number",children:"Number"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"date",id:"type-date"}),e.jsx(f,{htmlFor:"type-date",children:"Date"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"checkbox",id:"type-checkbox"}),e.jsx(f,{htmlFor:"type-checkbox",children:"Checkbox"})]})]})]}),e.jsx(g,{className:"mt-4 w-full",onClick:p,children:"Add Column"})]})]})]}),e.jsx(ct,{children:e.jsx(g,{variant:"outline",onClick:()=>t(!1),children:"Close"})})]})})}function yt({columns:s,onColumnsChange:t,showAllColumns:a,onToggleShowAll:r}){const[i,c]=h.useState(!1),u=n=>{const d=s.map(p=>p.key===n?I(_({},p),{visible:!p.visible}):p);t(d)},j=n=>{const d=s.map(p=>p.key===n?I(_({},p),{pinned:!p.pinned}):p);t(d)},x=()=>{const n=s.map(d=>{const p=["business_name","progress","status","project_name","updated_at"].includes(d.key),v=["business_name","status"].includes(d.key);return I(_({},d),{visible:p,pinned:v&&p})});t(n)};return e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{children:[e.jsx(We,{asChild:!0,children:e.jsxs(g,{variant:"outline",size:"sm",className:"h-9",children:[e.jsx(Ns,{className:"h-4 w-4 mr-1"}),"Columns"]})}),e.jsxs(Ge,{className:"w-64",children:[e.jsx(Qs,{children:"Table Columns"}),e.jsx(_e,{}),r&&e.jsxs(e.Fragment,{children:[e.jsxs(W,{onClick:n=>{n.preventDefault(),r()},className:"flex items-center justify-between cursor-pointer font-medium",children:[e.jsx("span",{children:a?"Show only selected columns":"Show all columns"}),a&&e.jsx(de,{className:"h-4 w-4 text-primary"})]}),e.jsx(_e,{})]}),e.jsx(Ws,{className:"max-h-[300px] overflow-y-auto",children:s.map(n=>e.jsxs(W,{className:"flex items-center justify-between cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{onClick:d=>{d.stopPropagation(),u(n.key)},children:n.visible?e.jsx(de,{className:"h-4 w-4 text-primary"}):e.jsx(bs,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx("span",{children:n.label||n.key.replace(/_/g," ")})]}),n.visible&&e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-60 hover:opacity-100",onClick:d=>{d.stopPropagation(),j(n.key)},title:n.pinned?"Unpin column":"Pin column",children:n.pinned?e.jsx(ws,{className:"h-3 w-3"}):e.jsx(ys,{className:"h-3 w-3"})})]},n.key))}),e.jsx(_e,{}),e.jsxs(W,{onClick:n=>{n.preventDefault(),c(!0)},className:"text-center justify-center font-medium",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Customize Columns"]}),e.jsx(W,{onClick:n=>{n.preventDefault(),x()},className:"text-center justify-center font-medium",children:"Reset to Default"})]})]}),e.jsx(wt,{open:i,onOpenChange:c,columns:s,onColumnsChange:t})]})}const Ct=()=>{const s=ue({mutationFn:r=>F(void 0,[r],function*({leads:t,mode:a}){const i=t.filter(p=>p.username);if(i.length===0)throw new Error("No valid leads to import");const c={inserted:0,updated:0,skipped:0,errors:[],updatedUsernames:[]},u=i.map(p=>p.username.toLowerCase()),{data:j}=yield H.from("instagram_leads").select("username").in("username",u),x=new Set((j==null?void 0:j.map(p=>p.username.toLowerCase()))||[]),n=i.filter(p=>{const v=p.username.toLowerCase();return x.has(v)?a==="skip"?(c.skipped++,!1):a==="fail"?(c.errors.push(`Username "${p.username}" already exists`),!1):!0:!0});if(a==="fail"&&c.errors.length>0)throw new Error("Duplicate usernames found");if(n.length===0)return c;const d=50;for(let p=0;p<n.length;p+=d){const o=n.slice(p,p+d).map(b=>I(_({},b),{username:b.username.toLowerCase(),status:b.status||"new",created_at:new Date().toISOString(),last_updated:new Date().toISOString()})),{data:l,error:N}=yield H.from("instagram_leads").upsert(o,{onConflict:"username",ignoreDuplicates:a==="skip"}).select();if(N){console.error("Batch import error:",N),c.errors.push(`Error importing batch: ${N.message}`);continue}l&&l.forEach(b=>{const w=b.username.toLowerCase();x.has(w)?(c.updated++,c.updatedUsernames.push(w)):c.inserted++})}return c}),onSuccess:t=>{const a=[t.inserted>0?`${t.inserted} leads added`:"",t.updated>0?`${t.updated} leads updated`:"",t.skipped>0?`${t.skipped} leads skipped`:""].filter(Boolean).join(", ");A.success(`Import complete: ${a}`)},onError:t=>{A.error(`Import failed: ${t.message}`),console.error("Lead import error:",t)}});return{importLeads:s,isImporting:s.isPending}},St=()=>{const[s,t]=h.useState(!1),[a,r]=h.useState(0),[i,c]=h.useState([]),{importLeads:u}=Ct();return{isProcessing:s,importProgress:a,validationErrors:i,processImport:(x,n="skip")=>F(void 0,null,function*(){try{t(!0),c([]),r(0);const d=yield u.mutateAsync({leads:x,mode:n});return d.errors&&d.errors.length>0?(c(d.errors),!1):(r(100),!0)}catch(d){return console.error("Import error:",d),c([d instanceof Error?d.message:"Import failed"]),!1}finally{t(!1)}})}},kt=({isProcessing:s,importProgress:t})=>s?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Importing leads..."}),e.jsxs("span",{children:[Math.round(t),"%"]})]}),e.jsx(Gs,{value:t,className:"h-2"})]}):null,_t=({errors:s})=>s.length?e.jsxs("div",{className:"bg-destructive/10 p-4 rounded-md space-y-2",children:[e.jsxs("div",{className:"font-medium text-destructive flex items-center gap-2",children:[e.jsx(Cs,{className:"h-4 w-4"}),"Validation Errors"]}),e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:s.map((t,a)=>e.jsx("li",{className:"text-sm text-destructive",children:t},a))})]}):null,Lt=()=>{const[s,t]=h.useState(""),[a,r]=h.useState(""),[i,c]=h.useState(""),[u,j]=h.useState(""),[x,n]=h.useState(""),[d,p]=h.useState(""),[v,o]=h.useState(""),[l,N]=h.useState("skip"),{isProcessing:b,importProgress:w,validationErrors:S,processImport:R}=St(),ye=h.useCallback(()=>F(void 0,null,function*(){const y=L=>L.split(`
`).map(k=>k.trim()).filter(Boolean),V=y(s);if(!V.length){A.error("Please add at least one username");return}const Z=new Map,J=new Set;if(V.forEach(L=>{const k=L.toLowerCase();Z.set(k,(Z.get(k)||0)+1),Z.get(k)>1&&J.add(L)}),J.size>0){if(l==="fail"){A.error(`Found duplicate usernames: ${Array.from(J).join(", ")}`);return}if(l!=="skip"&&l!=="update"){const L=new Set;V.forEach((k,Se)=>{const pe=k.toLowerCase();L.has(pe)?V[Se]="":L.add(pe)})}}const ne=y(a),xe=y(i),ie=y(u),Ce=y(x),ce=y(d),ae=y(v),oe=L=>{const k=Number(L);return isNaN(k)?null:k},re=V.filter(Boolean).map((L,k)=>({username:L,followers_count:ne[k]?oe(ne[k]):null,following_count:xe[k]?oe(xe[k]):null,posts_count:ie[k]?oe(ie[k]):null,full_name:Ce[k]||null,bio:ce[k]||null,profile_url:ae[k]||null}));(yield R(re,l))&&(t(""),r(""),c(""),j(""),n(""),p(""),o(""),J.size>0?A.success(`Import completed. ${J.size} duplicate(s) were ${l==="skip"?"skipped":l==="update"?"updated":"merged"}`):A.success("Import completed successfully"))}),[s,a,i,u,x,d,v,R,l]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(f,{children:"Import Mode"}),e.jsxs(es,{defaultValue:l,onValueChange:y=>N(y),className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"skip",id:"skip"}),e.jsx(f,{htmlFor:"skip",children:"Skip duplicates (default)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"update",id:"update"}),e.jsx(f,{htmlFor:"update",children:"Update existing leads"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"merge",id:"merge"}),e.jsx(f,{htmlFor:"merge",children:"Merge duplicates (combine data)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{value:"fail",id:"fail"}),e.jsx(f,{htmlFor:"fail",children:"Fail if duplicates found"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"usernames",className:"font-medium",children:"Usernames (required)"}),e.jsx(Q,{id:"usernames",placeholder:"Enter usernames, one per line",value:s,onChange:y=>t(y.target.value),className:"font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"followers",className:"font-medium",children:"Followers Count"}),e.jsx(Q,{id:"followers",placeholder:"Enter follower counts, one per line",value:a,onChange:y=>r(y.target.value),className:"font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"following",className:"font-medium",children:"Following Count"}),e.jsx(Q,{id:"following",placeholder:"Enter following counts, one per line",value:i,onChange:y=>c(y.target.value),className:"font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"posts",className:"font-medium",children:"Posts Count"}),e.jsx(Q,{id:"posts",placeholder:"Enter post counts, one per line",value:u,onChange:y=>j(y.target.value),className:"font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"fullNames",className:"font-medium",children:"Full Names"}),e.jsx(Q,{id:"fullNames",placeholder:"Enter full names, one per line",value:x,onChange:y=>n(y.target.value),className:"font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"bios",className:"font-medium",children:"Bios"}),e.jsx(Q,{id:"bios",placeholder:"Enter bios, one per line",value:d,onChange:y=>p(y.target.value),className:"font-mono"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"profileUrls",className:"font-medium",children:"Profile URLs"}),e.jsx(Q,{id:"profileUrls",placeholder:"Enter profile URLs, one per line",value:v,onChange:y=>o(y.target.value),className:"font-mono"})]})]}),e.jsx(_t,{errors:S}),e.jsx(kt,{isProcessing:b,importProgress:w}),e.jsx(g,{onClick:ye,disabled:b||!s.trim(),className:"w-full",children:"Import Leads"})]})};function At(){return e.jsxs(O,{className:"max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Bulk Import Leads"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Paste your data into each column, with one value per line. The number of lines should match across all columns."})]}),e.jsx(dt,{className:"flex-1 p-4",children:e.jsx(Lt,{})})]})}const It=({searchQuery:s,onSearchChange:t,onAddLead:a,statusFilter:r,onStatusFilterChange:i,selectedLeads:c,onClearSelection:u,columns:j,onColumnsChange:x,showAllColumns:n,onToggleShowAll:d,onExport:p,onRefresh:v,isAddingLead:o})=>{const[l,N]=h.useState(!1);return e.jsxs("div",{className:"px-4 py-2 border-b flex flex-wrap gap-2 items-center",children:[e.jsxs(Qe,{children:[e.jsx(We,{asChild:!0,children:e.jsxs(g,{variant:"outline",size:"sm",className:"h-8",children:[e.jsx(Ss,{className:"h-4 w-4 mr-1"}),"Status: ",r==="all"?"All":r,e.jsx(Be,{className:"h-4 w-4 ml-1"})]})}),e.jsxs(Ge,{children:[e.jsx(W,{onClick:()=>i("all"),children:"All"}),e.jsx(W,{onClick:()=>i("new"),children:"New"}),e.jsx(W,{onClick:()=>i("contacted"),children:"Contacted"}),e.jsx(W,{onClick:()=>i("converted"),children:"Converted"})]})]}),e.jsx("div",{className:"flex-grow",children:e.jsxs("form",{onSubmit:a,className:"flex gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ks,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:"Search leads or add new...",value:s,onChange:b=>t(b.target.value),className:"pl-8 w-[240px]"})]}),e.jsx(g,{type:"submit",disabled:o||!s.trim(),children:o?"Adding...":"Add Lead"})]})}),c.length>0&&e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsxs("span",{children:[c.length," leads selected"]}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:u,className:"h-8 ml-2",children:[e.jsx(_s,{className:"h-3 w-3 mr-1"}),"Clear"]})]}),e.jsxs(Ee,{open:l,onOpenChange:N,children:[e.jsx(ot,{asChild:!0,children:e.jsxs(g,{variant:"outline",size:"sm",className:"h-8",children:[e.jsx(Ls,{className:"h-4 w-4 mr-1"}),"Import"]})}),e.jsx(Me,{className:"max-w-xl",children:e.jsx(At,{})})]}),e.jsx(yt,{columns:j,onColumnsChange:x,showAllColumns:n,onToggleShowAll:d}),e.jsxs(g,{variant:"outline",size:"sm",className:"h-8",onClick:p,children:[e.jsx(As,{className:"h-4 w-4 mr-1"}),"Export"]}),e.jsxs(g,{variant:"outline",size:"sm",className:"h-8",onClick:v,children:[e.jsx(Is,{className:"h-4 w-4 mr-1"}),"Refresh"]})]})};function Ft({leadId:s,isOpen:t,onClose:a,onUpdate:r}){const[i,c]=h.useState("overview"),{leads:u,updateLead:j}=ss(),[x,n]=h.useState(!1),[d,p]=h.useState(""),[v,o]=h.useState(null),l=u.find(w=>w.id===s);h.useEffect(()=>{l&&(p(l.notes||""),o(l.status))},[l]);const N=()=>F(this,null,function*(){if(l){n(!0);try{yield j.mutateAsync({id:l.id,data:{notes:d}}),A.success("Notes saved successfully"),r&&r()}catch(w){A.error("Failed to save notes")}finally{n(!1)}}}),b=w=>F(this,null,function*(){if(!(!l||w===v)){n(!0);try{yield j.mutateAsync({id:l.id,data:{status:w}}),o(w),A.success(`Lead status updated to ${w}`),r&&r()}catch(S){A.error("Failed to update status")}finally{n(!1)}}});return l?e.jsx(mt,{open:t,onOpenChange:a,children:e.jsxs(ut,{className:"w-full md:max-w-[550px]",children:[e.jsx(ht,{className:"pb-4 space-y-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white mr-3",children:l.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs(xt,{className:"text-xl",children:["@",l.username]}),e.jsx(pt,{children:l.full_name||"Instagram Lead"})]})]}),e.jsx(M,{className:l.status==="converted"?"bg-green-500/10 text-green-500":l.status==="contacted"?"bg-blue-500/10 text-blue-500":"bg-amber-500/10 text-amber-500",children:l.status||"New"})]})}),e.jsxs(Xe,{value:i,onValueChange:c,className:"mt-6",children:[e.jsxs(Ye,{className:"grid grid-cols-4 mb-4",children:[e.jsxs(G,{value:"overview",children:[e.jsx(Fs,{className:"h-4 w-4 mr-1 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Overview"})]}),e.jsxs(G,{value:"outreach",children:[e.jsx(le,{className:"h-4 w-4 mr-1 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Outreach"})]}),e.jsxs(G,{value:"analytics",children:[e.jsx(Ae,{className:"h-4 w-4 mr-1 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Analytics"})]}),e.jsxs(G,{value:"notes",children:[e.jsx(Ts,{className:"h-4 w-4 mr-1 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Notes"})]})]}),e.jsxs(X,{value:"overview",className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-5",children:[e.jsxs("div",{className:"p-4 border rounded-md text-center",children:[e.jsx("div",{className:"text-2xl font-bold mb-1",children:ge(l.followers_count||0)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Followers"})]}),e.jsxs("div",{className:"p-4 border rounded-md text-center",children:[e.jsx("div",{className:"text-2xl font-bold mb-1",children:ge(l.following_count||0)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Following"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Lead Details"}),e.jsxs("div",{children:[e.jsx(f,{children:"Status"}),e.jsxs(ve,{value:v||void 0,onValueChange:b,children:[e.jsx(Ne,{children:e.jsx(be,{placeholder:"Select status"})}),e.jsxs(we,{children:[e.jsx(D,{value:"new",children:"New"}),e.jsx(D,{value:"contacted",children:"Contacted"}),e.jsx(D,{value:"converted",children:"Converted"}),e.jsx(D,{value:"not_interested",children:"Not Interested"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(f,{children:"Added Date"}),e.jsx(z,{value:new Date(l.created_at).toLocaleDateString(),readOnly:!0,className:"bg-muted/30"})]}),e.jsxs("div",{children:[e.jsx(f,{children:"Last Updated"}),e.jsx(z,{value:new Date(l.last_updated||l.created_at).toLocaleDateString(),readOnly:!0,className:"bg-muted/30"})]})]}),e.jsxs("div",{children:[e.jsx(f,{children:"Instagram Profile"}),e.jsx("div",{className:"flex mt-1",children:e.jsxs("a",{href:`https://instagram.com/${l.username}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline flex items-center",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"View Profile on Instagram"]})})]}),l.bio&&e.jsxs("div",{children:[e.jsx(f,{children:"Bio"}),e.jsx("div",{className:"p-3 rounded-md bg-muted/30 mt-1 text-sm",children:l.bio})]})]}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs(g,{variant:"outline",disabled:x,children:[e.jsx(Ds,{className:"h-4 w-4 mr-2"}),"Convert to Client"]})})]}),e.jsxs(X,{value:"outreach",className:"space-y-5",children:[e.jsxs("div",{className:"space-y-3 mb-5",children:[e.jsx("h3",{className:"font-medium",children:"Outreach Actions"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs(g,{variant:"outline",className:"h-auto py-2 flex flex-col items-center justify-center",children:[e.jsx(fe,{className:"h-4 w-4 mb-1"}),e.jsx("span",{className:"text-xs",children:"Follow"})]}),e.jsxs(g,{variant:"outline",className:"h-auto py-2 flex flex-col items-center justify-center",children:[e.jsx(le,{className:"h-4 w-4 mb-1"}),e.jsx("span",{className:"text-xs",children:"Send DM"})]}),e.jsxs(g,{variant:"outline",className:"h-auto py-2 flex flex-col items-center justify-center",children:[e.jsx(he,{className:"h-4 w-4 mb-1"}),e.jsx("span",{className:"text-xs",children:"App Plan"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:"Outreach History"}),e.jsxs("div",{className:"border rounded-md divide-y",children:[e.jsxs("div",{className:"p-3 flex items-center",children:[e.jsx("div",{className:"p-1.5 bg-muted rounded-full mr-3",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Follow"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Not followed yet"})]}),e.jsx(g,{size:"sm",variant:"ghost",className:"ml-auto",children:"Follow"})]}),e.jsxs("div",{className:"p-3 flex items-center",children:[e.jsx("div",{className:"p-1.5 bg-muted rounded-full mr-3",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"Direct Message"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"No messages sent"})]}),e.jsx(g,{size:"sm",variant:"ghost",className:"ml-auto",children:"Send"})]}),e.jsxs("div",{className:"p-3 flex items-center",children:[e.jsx("div",{className:"p-1.5 bg-muted rounded-full mr-3",children:e.jsx(he,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"App Plan"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"No plan generated"})]}),e.jsx(g,{size:"sm",variant:"ghost",className:"ml-auto",children:"Create"})]})]})]})]}),e.jsxs(X,{value:"analytics",className:"space-y-5",children:[e.jsx("div",{className:"h-[200px] flex items-center justify-center border rounded-md p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ae,{className:"h-10 w-10 text-muted-foreground/30 mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Analytics coming soon..."})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:"Engagement Data"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 border rounded-md text-center",children:[e.jsx("div",{className:"text-xl font-bold mb-1",children:"-"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Likes"})]}),e.jsxs("div",{className:"p-3 border rounded-md text-center",children:[e.jsx("div",{className:"text-xl font-bold mb-1",children:"-"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Comments"})]}),e.jsxs("div",{className:"p-3 border rounded-md text-center",children:[e.jsx("div",{className:"text-xl font-bold mb-1",children:"-"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Rate"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium",children:"Posts Analysis"}),e.jsx("div",{className:"text-center p-6 border rounded-md text-muted-foreground",children:"Post data analysis will be available soon"})]})]}),e.jsxs(X,{value:"notes",className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx(f,{htmlFor:"notes",children:"Notes about this lead"}),e.jsx(Q,{id:"notes",value:d,onChange:w=>p(w.target.value),placeholder:"Add notes about this lead...",className:"min-h-[200px] mt-2"})]}),e.jsx("div",{className:"text-right",children:e.jsx(g,{onClick:N,disabled:x,children:"Save Notes"})}),e.jsxs("div",{className:"space-y-3 mt-6",children:[e.jsxs("h3",{className:"font-medium flex items-center",children:[e.jsx(Ps,{className:"h-4 w-4 mr-2"}),"Activity History"]}),e.jsx("div",{className:"text-sm text-muted-foreground p-4 text-center border rounded-md",children:"No activity history available"})]})]})]}),e.jsx(jt,{className:"mt-6",children:e.jsx(g,{variant:"outline",onClick:a,children:"Close"})})]})}):null}function Tt({stats:s}){const t=[{name:"New Leads",value:s.pending,color:"#f59e0b"},{name:"Contacted",value:s.contacted,color:"#3b82f6"},{name:"Converted",value:s.converted,color:"#10b981"}];return e.jsxs("div",{className:"h-[240px]",children:[e.jsx(et,{width:"100%",height:"100%",children:e.jsxs(st,{width:500,height:240,data:t,margin:{top:10,right:30,left:0,bottom:20},layout:"vertical",children:[e.jsx(tt,{type:"number",domain:[0,"dataMax + 5"]}),e.jsx(at,{type:"category",dataKey:"name",tick:{fontSize:14},axisLine:!1,tickLine:!1,width:100}),e.jsx(rt,{formatter:a=>[`${a} Leads`,""],labelStyle:{color:"#111827"},contentStyle:{backgroundColor:"white",border:"1px solid #e5e7eb",borderRadius:"0.375rem",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}}),e.jsx(lt,{dataKey:"value",minPointSize:2,barSize:30,radius:[0,4,4,0],children:t.map((a,r)=>e.jsx(nt,{fill:a.color},`cell-${r}`))})]})}),e.jsxs("div",{className:"flex items-center justify-center mt-2 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Conversion Rate:"}),e.jsxs("span",{className:"ml-1 text-green-500 font-bold",children:[s.conversionRate,"%"]}),e.jsx(Es,{className:"mx-2 h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Funnel Efficiency:"}),e.jsxs("span",{className:"ml-1 font-medium",children:[s.converted,"/",s.total," Leads"]})]})]})}const Dt=()=>Ie({queryKey:["lead-stats"],queryFn:()=>F(void 0,null,function*(){const{data:s,error:t}=yield H.from("instagram_leads").select("*");if(t)throw t;const a=s.filter(u=>u.followed||u.commented||u.messaged),r=s.filter(u=>u.status==="contacted"),i=s.filter(u=>u.app_plan_status!==null),c=s.filter(u=>u.status==="converted");return{total:s.length,engaged:a.length,outreached:r.length,plansViewed:i.length,converted:c.length}})}),Pt=({title:s,value:t,icon:a,description:r,percentage:i,loading:c})=>c?e.jsx(O,{className:"bg-gradient-to-br from-blue-900/10 to-blue-900/5",children:e.jsx(q,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Le,{className:"h-4 w-24"}),e.jsx(Le,{className:"h-7 w-16"})]}),e.jsx(Le,{className:"h-8 w-8 rounded-full"})]})})}):e.jsx(Xs,{children:e.jsxs(Ys,{children:[e.jsx(Zs,{asChild:!0,children:e.jsx(O,{className:"bg-gradient-to-br from-blue-900/10 to-blue-900/5 overflow-hidden relative hover:border-blue-500/30 transition-colors",children:e.jsx(q,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:t}),i&&e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsxs("span",{className:`text-xs ${i>0?"text-green-500":"text-red-500"}`,children:[i>0?"↑":"↓"," ",Math.abs(i),"%"]}),e.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:"vs last month"})]})]}),e.jsx("div",{className:"h-8 w-8 flex items-center justify-center rounded-full bg-gradient-to-br from-blue-500/20 to-purple-500/20",children:a})]})})})}),e.jsx(Js,{children:e.jsx("p",{children:r})})]})});function Et(){const{data:s,isLoading:t}=Dt(),a=[{title:"Total Leads",value:(s==null?void 0:s.total)||0,icon:e.jsx(Ms,{className:"h-4 w-4 text-blue-500"}),description:"Total number of leads in your database",percentage:12},{title:"Engaged Leads",value:(s==null?void 0:s.engaged)||0,icon:e.jsx(le,{className:"h-4 w-4 text-green-500"}),description:"Leads that have interacted with your outreach",percentage:8},{title:"Outreached",value:(s==null?void 0:s.outreached)||0,icon:e.jsx(Os,{className:"h-4 w-4 text-purple-500"}),description:"Leads you have contacted",percentage:5},{title:"Plans Viewed",value:(s==null?void 0:s.plansViewed)||0,icon:e.jsx(he,{className:"h-4 w-4 text-amber-500"}),description:"Leads who have viewed app plans",percentage:15},{title:"Clients",value:(s==null?void 0:s.converted)||0,icon:e.jsx(zs,{className:"h-4 w-4 text-rose-500"}),description:"Leads converted to clients",percentage:3}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:a.map(r=>e.jsx(Pt,_({loading:t},r),r.title))})}function Mt(){const s=[{id:1,type:"message",username:"fitness_coach1",time:"10 minutes ago",message:"Sent DM about app plan"},{id:2,type:"follow",username:"design_agency",time:"25 minutes ago"},{id:3,type:"like",username:"tech_startup",time:"1 hour ago",postInfo:"Latest product launch post"},{id:4,type:"plan",username:"saas_founder",time:"3 hours ago",planName:"SaaS Dashboard MVP"},{id:5,type:"qualified",username:"ecommerce_guru",time:"5 hours ago"}],t=r=>{switch(r){case"message":return e.jsx(le,{className:"h-4 w-4 text-blue-500"});case"follow":return e.jsx(fe,{className:"h-4 w-4 text-purple-500"});case"like":return e.jsx(Rs,{className:"h-4 w-4 text-red-500"});case"plan":return e.jsx(he,{className:"h-4 w-4 text-amber-500"});case"qualified":return e.jsx($s,{className:"h-4 w-4 text-green-500"});default:return e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})}},a=r=>{switch(r.type){case"message":return e.jsxs("span",{children:["Sent a DM to ",e.jsxs("strong",{children:["@",r.username]}),r.message&&e.jsx("span",{className:"text-xs text-muted-foreground block mt-0.5",children:r.message})]});case"follow":return e.jsxs("span",{children:["Followed ",e.jsxs("strong",{children:["@",r.username]})]});case"like":return e.jsxs("span",{children:["Liked a post from ",e.jsxs("strong",{children:["@",r.username]}),r.postInfo&&e.jsx("span",{className:"text-xs text-muted-foreground block mt-0.5",children:r.postInfo})]});case"plan":return e.jsxs("span",{children:["Created app plan for ",e.jsxs("strong",{children:["@",r.username]}),r.planName&&e.jsx("span",{className:"text-xs text-muted-foreground block mt-0.5",children:r.planName})]});case"qualified":return e.jsxs("span",{children:["Qualified lead ",e.jsxs("strong",{children:["@",r.username]})," as potential client"]});default:return e.jsxs("span",{children:["Interacted with ",e.jsxs("strong",{children:["@",r.username]})]})}};return e.jsx("div",{className:"space-y-4 max-h-[220px] overflow-y-auto pr-1",children:s.length===0?e.jsx("div",{className:"text-center py-6 text-muted-foreground",children:"No recent activities"}):s.map(r=>e.jsxs("div",{className:"flex items-start gap-3 pb-3 border-b border-muted last:border-0",children:[e.jsx("div",{className:"mt-1",children:e.jsx("div",{className:"p-1.5 bg-muted rounded-full",children:t(r.type)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm",children:a(r)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.time})]})]},r.id))})}const Ot=({account:s,onEditClick:t})=>{const r=s.platform==="instagram"?Fe:He;return e.jsxs(O,{className:"overflow-hidden",children:[e.jsx("div",{className:`h-3 ${s.platform==="instagram"?"bg-gradient-to-r from-purple-500 to-pink-500":"bg-gradient-to-r from-blue-600 to-blue-800"}`}),e.jsxs(q,{className:"pt-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full ${s.platform==="instagram"?"bg-purple-100":"bg-blue-100"} flex items-center justify-center`,children:e.jsx(r,{className:`h-5 w-5 ${s.platform==="instagram"?"text-purple-600":"text-blue-600"}`})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold",children:["@",s.username]}),e.jsxs("p",{className:"text-xs text-muted-foreground capitalize",children:[s.account_type," Account"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["15/",s.daily_dm_limit]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"DMs Today"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["20/",s.daily_follow_limit]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Follows"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:["10/",s.daily_comment_limit]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Comments"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(M,{variant:s.status==="active"?"default":"outline",className:"text-xs",children:s.status==="active"?"Active":"Paused"}),e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>t(s),children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Manage"]})]})]})]})},zt=({accounts:s,onEditAccount:t,platform:a,industryFilter:r})=>{const i=s.filter(c=>!(a&&c.platform!==a||r&&r!=="all"&&c.industry_focus!==r));return i.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx("p",{children:"No accounts found matching your criteria."}),e.jsx("p",{className:"text-sm",children:"Try changing your filters or add a new account."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(c=>e.jsx(Ot,{account:c,onEditClick:t},c.id))})},$t=({account:s,isOpen:t,onClose:a,onSave:r})=>{var j,x;const[i,c]=Us.useState(s||{platform:"instagram",account_type:"business",status:"active",daily_dm_limit:30,daily_follow_limit:50,daily_comment_limit:40,credentials:{},proxy_settings:{},platform_specific_settings:{}}),u=n=>{n.preventDefault(),r(i)};return e.jsx(Ee,{open:t,onOpenChange:a,children:e.jsxs(Me,{className:"max-w-2xl",children:[e.jsx(Ze,{children:e.jsx(Je,{children:s?"Edit Account":"Add New Account"})}),e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"platform",children:"Platform"}),e.jsxs(ve,{value:i.platform,onValueChange:n=>c(I(_({},i),{platform:n})),children:[e.jsx(Ne,{children:e.jsx(be,{placeholder:"Select platform"})}),e.jsxs(we,{children:[e.jsx(D,{value:"instagram",children:"Instagram"}),e.jsx(D,{value:"linkedin",children:"LinkedIn"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"industry_focus",children:"Industry Focus"}),e.jsxs(ve,{value:i.industry_focus,onValueChange:n=>c(I(_({},i),{industry_focus:n})),children:[e.jsx(Ne,{children:e.jsx(be,{placeholder:"Select industry"})}),e.jsxs(we,{children:[e.jsx(D,{value:"onlyfans",children:"OnlyFans Management"}),e.jsx(D,{value:"ecommerce",children:"E-commerce"}),e.jsx(D,{value:"saas",children:"SaaS"}),e.jsx(D,{value:"agency",children:"Agency"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"username",children:"Username"}),e.jsx(z,{id:"username",value:i.username||"",onChange:n=>c(I(_({},i),{username:n.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Account Credentials"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{type:"password",placeholder:"Password",value:((j=i.credentials)==null?void 0:j.password)||"",onChange:n=>c(I(_({},i),{credentials:I(_({},i.credentials),{password:n.target.value})}))}),e.jsx(z,{type:"email",placeholder:"Recovery Email",value:((x=i.credentials)==null?void 0:x.recovery_email)||"",onChange:n=>c(I(_({},i),{credentials:I(_({},i.credentials),{recovery_email:n.target.value})}))})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Daily DM Limit"}),e.jsx(z,{type:"number",value:i.daily_dm_limit||30,onChange:n=>c(I(_({},i),{daily_dm_limit:parseInt(n.target.value)}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Daily Follow Limit"}),e.jsx(z,{type:"number",value:i.daily_follow_limit||50,onChange:n=>c(I(_({},i),{daily_follow_limit:parseInt(n.target.value)}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Daily Comment Limit"}),e.jsx(z,{type:"number",value:i.daily_comment_limit||40,onChange:n=>c(I(_({},i),{daily_comment_limit:parseInt(n.target.value)}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{variant:"outline",type:"button",onClick:a,children:"Cancel"}),e.jsx(g,{type:"submit",children:"Save Account"})]})]})]})})},Rt=({activePlatform:s,onPlatformChange:t})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:s?"outline":"default",onClick:()=>t(void 0),children:"All Platforms"}),e.jsxs(g,{variant:s==="instagram"?"default":"outline",onClick:()=>t("instagram"),children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Instagram"]}),e.jsxs(g,{variant:s==="linkedin"?"default":"outline",onClick:()=>t("linkedin"),children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"LinkedIn"]})]}),Ut=({selectedIndustry:s,onIndustryChange:t})=>e.jsxs(ve,{value:s,onValueChange:t,children:[e.jsx(Ne,{className:"w-[200px] mt-4",children:e.jsx(be,{placeholder:"Filter by industry"})}),e.jsxs(we,{children:[e.jsx(D,{value:"all",children:"All Industries"}),e.jsx(D,{value:"onlyfans",children:"OnlyFans Management"}),e.jsx(D,{value:"ecommerce",children:"E-commerce"}),e.jsx(D,{value:"saas",children:"SaaS"}),e.jsx(D,{value:"agency",children:"Agency"})]})]}),aa=()=>{const[s,t]=h.useState("leads-overview"),[a,r]=h.useState(""),[i,c]=h.useState([]),[u,j]=h.useState(null),[x,n]=h.useState("all"),{leads:d,isLoading:p,refetch:v,addLead:o}=ss(100),{accounts:l,addAccount:N,updateAccount:b}=gt(),{columns:w,sortColumn:S,sortDirection:R,setColumns:ye,setSortColumn:y,setSortDirection:V,showAllColumns:Z,toggleShowAllColumns:J}=ft(vt),[ne,xe]=h.useState(),[ie,Ce]=h.useState(),[ce,ae]=h.useState(),[oe,re]=h.useState(!1),Oe=h.useMemo(()=>{const m=d.length,C=d.filter(B=>B.status==="contacted").length,K=d.filter(B=>B.status==="converted").length,P=d.filter(B=>B.status==="new").length,E=m>0?Math.round(K/m*100):0;return{total:m,contacted:C,converted:K,pending:P,conversionRate:E}},[d]),L=h.useMemo(()=>{let m=[...d];return a&&(m=m.filter(C=>C.username.toLowerCase().includes(a.toLowerCase())||C.full_name&&C.full_name.toLowerCase().includes(a.toLowerCase()))),x!=="all"&&(m=m.filter(C=>C.status===x)),S&&m.sort((C,K)=>{let P=C[S]||"",E=K[S]||"";return typeof P=="number"&&typeof E=="number"?R==="asc"?P-E:E-P:(P=String(P).toLowerCase(),E=String(E).toLowerCase(),P<E?R==="asc"?-1:1:P>E?R==="asc"?1:-1:0)}),m},[d,a,x,S,R]),k=h.useMemo(()=>w.filter(m=>m.pinned),[w]),Se=h.useMemo(()=>w.filter(m=>Z||m.visible),[w,Z]),pe=m=>F(void 0,null,function*(){if(m.preventDefault(),!!a.trim())try{yield o.mutateAsync({username:a}),r(""),A.success("Lead added successfully")}catch(C){A.error("Failed to add lead")}}),ts=h.useCallback(m=>{S===m?V(R==="asc"?"desc":"asc"):(y(m),V("asc"))},[S,R,y,V]),as=h.useCallback(()=>{c(m=>m.length===L.length?[]:L.map(C=>C.id))},[L]),rs=h.useCallback(m=>{c(C=>C.includes(m)?C.filter(K=>K!==m):[...C,m])},[]),ls=m=>{j(m)},ns=()=>{const m=i.length>0?d.filter(E=>i.includes(E.id)):L,C=[Object.keys(m[0]||{}).join(","),...m.map(E=>Object.values(E).map(B=>typeof B=="string"?`"${B.replace(/"/g,'""')}"`:B).join(","))].join(`
`),K=new Blob([C],{type:"text/csv;charset=utf-8;"}),P=document.createElement("a");P.href=URL.createObjectURL(K),P.download=`instagram_leads_${new Date().toISOString().split("T")[0]}.csv`,P.click(),A.success(`Exported ${m.length} leads to CSV`)},is=m=>{ae(m),re(!0)},cs=()=>{ae(void 0),re(!0)},os=m=>F(void 0,null,function*(){try{if(ce)yield b.mutateAsync(_({id:ce.id},m));else{const C=_({username:m.username||"",platform:m.platform||"instagram",account_type:m.account_type||"business",status:m.status||"active",daily_dm_limit:m.daily_dm_limit||30,daily_follow_limit:m.daily_follow_limit||50,daily_comment_limit:m.daily_comment_limit||40,assigned_to:m.assigned_to||null,last_action_at:null,credentials:m.credentials||{},proxy_settings:m.proxy_settings||{},platform_specific_settings:m.platform_specific_settings||{}},m);yield N.mutateAsync(C)}re(!1),ae(void 0)}catch(C){console.error("Error saving account:",C)}}),ds=m=>{switch(m){case"contacted":return e.jsx(M,{className:"bg-blue-500/20 text-blue-400",children:"Contacted"});case"converted":return e.jsx(M,{className:"bg-green-500/20 text-green-400",children:"Converted"});case"new":default:return e.jsx(M,{className:"bg-amber-500/20 text-amber-400",children:"New"})}};return e.jsxs(qs,{children:[e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(Hs,{icon:Vs,title:"Outreach Management"}),e.jsxs(Xe,{value:s,onValueChange:t,children:[e.jsxs(Ye,{className:"mb-6",children:[e.jsx(G,{value:"leads-overview",children:"Leads Overview"}),e.jsx(G,{value:"lead-management",children:"Lead Management"}),e.jsx(G,{value:"outreach-accounts",children:"Outreach Accounts"}),e.jsx(G,{value:"outreach-campaigns",children:"Campaigns & Analytics"})]}),e.jsxs(X,{value:"leads-overview",children:[e.jsx(Et,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs(O,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Lead Funnel Conversion"}),e.jsx(te,{children:"Track your lead conversion process"})]}),e.jsx(q,{children:e.jsx(Tt,{stats:Oe})})]}),e.jsxs(O,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Recent Outreach Activity"}),e.jsx(te,{children:"Latest lead interactions"})]}),e.jsx(q,{children:e.jsx(Mt,{})})]})]}),e.jsxs(O,{children:[e.jsxs(ee,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(se,{children:"Recent Leads"}),e.jsx(te,{children:"Recently added Instagram leads"})]}),e.jsx(g,{variant:"outline",onClick:()=>t("lead-management"),children:"View All Leads"})]}),e.jsx(q,{children:e.jsxs(Te,{children:[e.jsx(De,{children:e.jsxs(U,{children:[e.jsx($,{children:"Username"}),e.jsx($,{children:"Name"}),e.jsx($,{children:"Followers"}),e.jsx($,{children:"Status"}),e.jsx($,{children:"Added"})]})}),e.jsx(Pe,{children:p?e.jsx(U,{children:e.jsx(T,{colSpan:5,className:"text-center py-10",children:"Loading leads..."})}):d.length===0?e.jsx(U,{children:e.jsx(T,{colSpan:5,className:"text-center py-10",children:"No leads found. Add your first lead."})}):d.slice(0,5).map(m=>e.jsxs(U,{children:[e.jsxs(T,{children:["@",m.username]}),e.jsx(T,{children:m.full_name||"-"}),e.jsx(T,{children:m.followers_count?ge(m.followers_count):"N/A"}),e.jsx(T,{children:ds(m.status)}),e.jsx(T,{children:new Date(m.created_at).toLocaleDateString()})]},m.id))})]})})]})]}),e.jsx(X,{value:"lead-management",children:e.jsxs(O,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Lead Database"}),e.jsx(te,{children:"Manage and track your leads"})]}),e.jsx(It,{searchQuery:a,onSearchChange:r,onAddLead:pe,statusFilter:x,onStatusFilterChange:n,selectedLeads:i,onClearSelection:()=>c([]),columns:w,onColumnsChange:ye,showAllColumns:Z,onToggleShowAll:J,onExport:ns,onRefresh:()=>v(),isAddingLead:o.isPending}),e.jsx(bt,{visibleColumns:Se,pinnedColumns:k,filteredLeads:L,selectedLeads:i,sortColumn:S,sortDirection:R,onSort:ts,onSelectAll:as,onSelectLead:rs,onRowClick:ls,isLoading:p})]})}),e.jsxs(X,{value:"outreach-accounts",children:[e.jsxs(O,{children:[e.jsxs(ee,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(se,{children:"Social Media Accounts"}),e.jsx(te,{children:"Manage your outreach accounts"})]}),e.jsxs(g,{onClick:cs,children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Add Account"]})]}),e.jsx(Rt,{activePlatform:ne,onPlatformChange:xe}),e.jsx(Ut,{selectedIndustry:ie,onIndustryChange:Ce})]}),e.jsx(q,{children:e.jsx(zt,{accounts:l,onEditAccount:is,platform:ne,industryFilter:ie})})]}),e.jsx($t,{account:ce,isOpen:oe,onClose:()=>{re(!1),ae(void 0)},onSave:os})]}),e.jsx(X,{value:"outreach-campaigns",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(O,{className:"lg:col-span-2",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Outreach Funnel Performance"}),e.jsx(te,{children:"Conversion metrics across funnel stages"})]}),e.jsxs(q,{className:"h-[300px] flex items-center justify-center",children:[e.jsx(Ae,{className:"h-16 w-16 text-muted-foreground/50"}),e.jsx("p",{className:"ml-4 text-muted-foreground",children:"Campaign analytics coming soon..."})]})]}),e.jsxs(O,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Campaign Templates"}),e.jsx(te,{children:"Save and reuse outreach campaigns"})]}),e.jsxs(q,{children:[e.jsxs(g,{className:"w-full mb-4",children:[e.jsx(qe,{className:"h-4 w-4 mr-2"}),"New Campaign"]}),e.jsx("div",{className:"space-y-3",children:["Fitness App Outreach","Agency Owner Outreach","E-commerce Owners"].map((m,C)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Bs,{className:"h-4 w-4 text-amber-400 mr-2"}),e.jsx("span",{children:m})]}),e.jsx(g,{variant:"ghost",size:"sm",children:e.jsx(Ke,{className:"h-4 w-4"})})]},C))})]})]})]})})]})]}),u&&e.jsx(Ft,{leadId:u,isOpen:!!u,onClose:()=>j(null),onUpdate:v})]})};export{aa as default};
