var z=Object.defineProperty,F=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var A=(s,a,r)=>a in s?z(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,v=(s,a)=>{for(var r in a||(a={}))C.call(a,r)&&A(s,r,a[r]);if(N)for(var r of N(a))L.call(a,r)&&A(s,r,a[r]);return s},S=(s,a)=>F(s,M(a));var _=(s,a)=>{var r={};for(var t in s)C.call(s,t)&&a.indexOf(t)<0&&(r[t]=s[t]);if(s!=null&&N)for(var t of N(s))a.indexOf(t)<0&&L.call(s,t)&&(r[t]=s[t]);return r};var y=(s,a,r)=>new Promise((t,n)=>{var l=m=>{try{d(r.next(m))}catch(i){n(i)}},u=m=>{try{d(r.throw(m))}catch(i){n(i)}},d=m=>m.done?t(m.value):Promise.resolve(m.value).then(l,u);d((r=r.apply(s,a)).next())});import{r as h,j as e,m as f,bT as B,ca as K,X as Y,f as $,bw as Q,af as G,cb as J,cc as V,cd as W,ce as E,aC as X,cf as T,bs as Z,aS as ee,U as se,cg as te,bQ as D,y as ae,W as q}from"./vendor-C50ijZWh.js";import{A as re}from"./AppLayout-BhL6t15E.js";import{u as k,s as b,d as w,h as P,l as O,P as ie}from"./index-Blbobipf.js";import{u as oe}from"./usePoints-CKR6GRdc.js";import{bL as I}from"./libs-B3eAAgHd.js";import"./MainLayout-CYr31jBl.js";import"./supabase-D8k0GRjn.js";const ne=({onSearch:s})=>{const[a,r]=h.useState(!1),{toast:t}=k(),n=l=>y(void 0,null,function*(){l.preventDefault();const d=new FormData(l.currentTarget).get("search");if(d.trim()){r(!0);try{const{data:m,error:i}=yield b.functions.invoke("chat-with-assistant",{body:{message:d,systemPrompt:"You are a search assistant for SISO's point earning system. Analyze the user's query and return relevant earning opportunities and strategies."}});if(i)throw i;s(d)}catch(m){console.error("Search error:",m),t({variant:"destructive",title:"Search failed",description:"Unable to process your search. Please try again."})}finally{r(!1)}}});return e.jsx(f.form,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},onSubmit:n,className:"w-full max-w-2xl mx-auto mb-8",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"search",name:"search",placeholder:"Search earning opportunities (e.g. 'quick ways to earn points today')",className:`w-full h-12 pl-12 pr-4 bg-siso-text/5 border border-siso-text/10 rounded-lg
            text-siso-text placeholder:text-siso-text/50
            focus:outline-none focus:ring-2 focus:ring-siso-orange/50
            hover:bg-siso-text/10 transition-all`}),e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2",children:a?e.jsx("div",{className:"w-6 h-6 border-2 border-siso-orange border-t-transparent rounded-full animate-spin"}):e.jsx(B,{className:"w-6 h-6 text-siso-text/50"})})]})})},le=()=>{const[s,a]=h.useState(!1),[r,t]=h.useState([]),[n,l]=h.useState(""),[u,d]=h.useState(!1),{toast:m}=k(),i=p=>y(void 0,null,function*(){if(p.preventDefault(),!n.trim()||u)return;const c=n.trim();l(""),d(!0),t(o=>[...o,{role:"user",content:c}]);try{const{data:o,error:x}=yield b.functions.invoke("chat-with-assistant",{body:{message:c,systemPrompt:"You are a SISO Points earning expert. Help users understand how to earn points, suggest optimal strategies, and provide guidance on completing tasks effectively. Be specific and actionable in your advice."}});if(x)throw x;t(g=>[...g,{role:"assistant",content:o.response}])}catch(o){console.error("Error:",o),m({variant:"destructive",title:"Error",description:"Failed to get response. Please try again."})}finally{d(!1)}});return e.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:s?e.jsxs(f.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"w-[350px] h-[500px] bg-siso-bg border border-siso-text/10 rounded-lg shadow-lg flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-siso-text/10 flex justify-between items-center bg-gradient-to-r from-siso-red/10 to-siso-orange/10",children:[e.jsx("h3",{className:"font-semibold text-siso-text",children:"Points Earning Assistant"}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>a(!1),className:"hover:bg-siso-text/10",children:e.jsx(Y,{className:"h-4 w-4 text-siso-text"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[r.length===0&&e.jsx("div",{className:"text-center text-siso-text/70 mt-4",children:"ðŸ‘‹ Hi! I'm your Points Earning Assistant. Ask me anything about earning SISO points!"}),e.jsx($,{mode:"wait",children:r.map((p,c)=>e.jsx(f.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:`flex ${p.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] p-3 rounded-lg ${p.role==="user"?"bg-siso-orange/20 text-siso-text ml-4":"bg-siso-text/10 text-siso-text mr-4"}`,children:p.content})},c))})]}),e.jsx("form",{onSubmit:i,className:"p-4 border-t border-siso-text/10",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:p=>l(p.target.value),placeholder:"Ask about earning points...",className:"flex-1 bg-siso-text/5 border border-siso-text/10 rounded-lg px-4 py-2 text-siso-text placeholder:text-siso-text/50 focus:outline-none focus:ring-2 focus:ring-siso-orange/50",disabled:u}),e.jsx(w,{type:"submit",disabled:u,className:"bg-gradient-to-r from-siso-red to-siso-orange text-white hover:opacity-90 transition-opacity",children:u?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Q,{className:"h-5 w-5"})})]})})]}):e.jsx(w,{onClick:()=>a(!0),className:"h-14 w-14 rounded-full bg-gradient-to-r from-siso-red to-siso-orange hover:opacity-90 animate-glow",children:e.jsx(K,{className:"h-6 w-6 text-white"})})})},ce=({navigate:s})=>e.jsxs(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[e.jsxs(f.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:200,damping:15},className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx(G,{className:"w-12 h-12 text-siso-orange animate-bounce"}),e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-siso-red to-siso-orange bg-clip-text text-transparent",children:"How to Earn SISO Points"})]}),e.jsx(f.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-lg text-siso-text/80 max-w-2xl mx-auto mb-6",children:"Maximize your points by completing daily activities and contributing to the community. Every action counts towards your progress!"}),e.jsx(f.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsx(w,{onClick:()=>s("/leaderboards"),className:`bg-gradient-to-r from-siso-red to-siso-orange hover:from-siso-red/90 hover:to-siso-orange/90 
            text-white font-semibold px-6 py-2 rounded-lg transition-all duration-300 transform hover:scale-105`,children:"View Leaderboard"})})]}),de=J,R=h.forwardRef((t,r)=>{var n=t,{className:s}=n,a=_(n,["className"]);return e.jsx(V,v({ref:r,className:P("border-b",s)},a))});R.displayName="AccordionItem";const H=h.forwardRef((n,t)=>{var l=n,{className:s,children:a}=l,r=_(l,["className","children"]);return e.jsx(W,{className:"flex",children:e.jsxs(E,S(v({ref:t,className:P("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s)},r),{children:[a,e.jsx(X,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]}))})});H.displayName=E.displayName;const U=h.forwardRef((n,t)=>{var l=n,{className:s,children:a}=l,r=_(l,["className","children"]);return e.jsx(T,S(v({ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"},r),{children:e.jsx("div",{className:P("pb-4 pt-0",s),children:a})}))});U.displayName=T.displayName;const me=({skills:s,userProgress:a,skillPaths:r,onExternalLinkClick:t})=>{const{user:n}=O(),{toast:l}=k(),{awardPoints:u}=oe(n==null?void 0:n.id),d=i=>y(void 0,null,function*(){var c;if(!n){l({title:"Authentication required",description:"Please sign in to track your progress",variant:"destructive"});return}const p=(c=i.requirements)==null?void 0:c.external_url;if(p){t==null||t(p);return}try{const o=a.find(g=>g.skill_id===i.id),x=new Date().toISOString();if(o){if(i.cooldown_minutes&&o.last_completed_at){const j=new Date(o.last_completed_at);if(new Date(j.getTime()+i.cooldown_minutes*6e4)>new Date){l({title:"Cooldown active",description:"This skill can be completed again after cooldown ends",variant:"destructive"});return}}const{error:g}=yield b.from("user_skill_progress").update({times_completed:o.times_completed+1,last_completed_at:x,completed_at:x}).eq("id",o.id);if(g)throw g}else{const{error:g}=yield b.from("user_skill_progress").insert({user_id:n.id,skill_id:i.id,completed_at:x,last_completed_at:x,times_completed:1});if(g)throw g}yield u(i.name.toLowerCase().replace(/ /g,"_")),l({title:"Skill completed!",description:`You earned ${i.points} points`})}catch(o){l({title:"Error",description:o.message,variant:"destructive"})}}),m=i=>{const p=a.find(c=>c.skill_id===i.id);return p?p.completed_at?"completed":"in-progress":"locked"};return e.jsx(de,{type:"single",collapsible:!0,className:"w-full space-y-4",children:r.map(i=>{const p=s.filter(c=>c.path_id===i.id);return e.jsxs(R,{value:i.id,children:[e.jsx(H,{className:"text-lg font-semibold",children:i.name}),e.jsx(U,{children:e.jsx("div",{className:"space-y-4",children:p.map(c=>{var g;const o=m(c),x=!!((g=c.requirements)!=null&&g.external_url);return e.jsxs("div",{className:"p-4 rounded-lg border border-siso-border bg-siso-bg-alt/30",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:c.name}),e.jsx("p",{className:"text-sm text-siso-text/80",children:c.description})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-siso-orange",children:[c.points," points"]}),e.jsxs("div",{className:"text-xs text-siso-text/60",children:["Level ",c.level]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("div",{className:"text-sm text-siso-text/80",children:c.requirements.description}),e.jsxs(w,{variant:o==="completed"?"secondary":"default",size:"sm",onClick:()=>d(c),className:"flex items-center gap-2",children:[x&&e.jsx(Z,{className:"h-4 w-4"}),x?"Open Resource":o==="completed"?"Complete Again":"Complete"]})]})]},c.id)})})})]},i.id)})})},xe={"graduation-cap":D,"pen-tool":te,users:se,code:ee},pe=({path:s,skills:a,userProgress:r,isSelected:t,onClick:n})=>{const l=xe[s.icon]||D,u=a.filter(m=>r.some(i=>i.skill_id===m.id&&i.completed_at)).length,d=u/a.length*100;return e.jsxs(f.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:n,className:P("relative p-6 rounded-lg border cursor-pointer transition-colors","bg-gradient-to-br from-siso-bg-alt/50 to-siso-bg-alt/30","hover:from-siso-bg-alt/60 hover:to-siso-bg-alt/40",t?"border-siso-orange":"border-siso-border"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-siso-orange/10",children:e.jsx(l,{className:"w-6 h-6 text-siso-orange"})}),e.jsxs("div",{className:"px-2 py-1 text-xs rounded-full bg-siso-text/10",children:["Level ",s.level]})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.name}),e.jsx("p",{className:"text-sm text-siso-text/80 mb-4",children:s.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[u,"/",a.length," Complete"]})]}),e.jsx(ie,{value:d,className:"h-2"})]})]})},ue=({skillPaths:s,skills:a,userProgress:r,selectedPath:t,setSelectedPath:n,isLoading:l,onExternalLinkClick:u})=>l?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(d=>e.jsx(pe,{path:d,skills:a.filter(m=>m.path_id===d.id),userProgress:r,isSelected:t===d.id,onClick:()=>n(d.id)},d.id))}),t&&e.jsx(me,{skills:a,userProgress:r,skillPaths:s,onExternalLinkClick:u})]}),Se=()=>{const[s,a]=h.useState(null),r=ae(),{user:t}=O(),{data:n,isLoading:l}=q({queryKey:["skillPaths"],queryFn:()=>y(void 0,null,function*(){const{data:o,error:x}=yield b.from("skill_paths").select("*").order("level",{ascending:!0});if(x)throw x;return o})}),{data:u,isLoading:d}=q({queryKey:["skills",s],queryFn:()=>y(void 0,null,function*(){const o=b.from("skills").select("*").order("level",{ascending:!0});s&&o.eq("path_id",s);const{data:x,error:g}=yield o;if(g)throw g;return x.map(j=>S(v({},j),{requirements:typeof j.requirements=="string"?JSON.parse(j.requirements):j.requirements}))}),enabled:!!n}),{data:m,isLoading:i}=q({queryKey:["userSkillProgress",t==null?void 0:t.id],queryFn:()=>y(void 0,null,function*(){if(!(t!=null&&t.id))return[];const{data:o,error:x}=yield b.from("user_skill_progress").select("*").eq("user_id",t.id);if(x)throw x;return o}),enabled:!!(t!=null&&t.id)}),p=o=>{if(!o){I.error("Invalid resource link");return}try{new URL(o),window.open(o,"_blank","noopener,noreferrer")}catch(x){I.error("Invalid URL format")}},c=l||d||i;return e.jsxs(re,{children:[e.jsx("div",{className:"flex-1 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(ce,{navigate:r}),e.jsx(ne,{onSearch:o=>{}}),e.jsx(ue,{skillPaths:n||[],skills:u||[],userProgress:m||[],selectedPath:s,setSelectedPath:a,isLoading:c,onExternalLinkClick:p})]})}),e.jsx(le,{})]})};export{Se as default};
