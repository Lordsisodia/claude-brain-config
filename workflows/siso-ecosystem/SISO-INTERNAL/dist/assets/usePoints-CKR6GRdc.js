var _=(r,d,s)=>new Promise((g,n)=>{var S=e=>{try{l(s.next(e))}catch(f){n(f)}},u=e=>{try{l(s.throw(e))}catch(f){n(f)}},l=e=>e.done?g(e.value):Promise.resolve(e.value).then(S,u);l((s=s.apply(r,d)).next())});import{r as c}from"./vendor-C50ijZWh.js";import{s as E}from"./index-Blbobipf.js";const q=r=>{const[d,s]=c.useState(0),[g,n]=c.useState(""),[S,u]=c.useState(!0),[l,e]=c.useState([]),[f,b]=c.useState({totalSpent:0,tier:"Bronze",recentTransactions:[]});return c.useEffect(()=>{if(!r)return;_(void 0,null,function*(){try{u(!0);const{data:t,error:o}=yield E.from("leaderboard_entries").select("*").eq("user_id",r).single();if(o&&o.code!=="PGRST116"&&console.error("Error fetching leaderboard data:",o),t){s(t.points||0);const a=t.level||1;a>=10?n("Master"):a>=7?n("Expert"):a>=4?n("Advanced"):a>=2?n("Intermediate"):n("Beginner")}const{data:i,error:p}=yield E.from("transactions").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(10);if(p&&console.error("Error fetching transaction data:",p),i){e(i);const a=i.reduce((P,h)=>h.transaction_type==="purchase"?P+(h.amount||0):P,0);let m="Bronze";a>=1e4?m="Premium":a>=5e3?m="Gold":a>=1e3&&(m="Silver"),b({totalSpent:a,tier:m,recentTransactions:i.slice(0,5)})}}catch(t){console.error("Error in usePoints hook:",t)}finally{u(!1)}})},[r]),{points:d,rank:g,isLoading:S,transactions:l,spendingData:f,awardPoints:(y,t=10)=>_(void 0,null,function*(){if(!r)return!1;try{const{error:o}=yield E.from("transactions").insert([{user_id:r,amount:t,transaction_type:"points_earned",metadata:{action_type:y}}]);if(o)return console.error("Error recording transaction:",o),!1;const{error:i}=yield E.from("leaderboard_entries").update({points:d+t,updated_at:new Date().toISOString()}).eq("user_id",r);return i?(console.error("Error updating points:",i),!1):(s(p=>p+t),!0)}catch(o){return console.error("Error awarding points:",o),!1}})}};export{q as u};
