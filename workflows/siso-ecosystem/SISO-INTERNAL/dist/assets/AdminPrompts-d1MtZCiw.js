var S=(l,b,u)=>new Promise((A,N)=>{var y=c=>{try{i(u.next(c))}catch(m){N(m)}},D=c=>{try{i(u.throw(c))}catch(m){N(m)}},i=c=>c.done?A(c.value):Promise.resolve(c.value).then(y,D);i((u=u.apply(l,b)).next())});import{r as d,j as e,aa as U,aX as M,aY as E,cM as Z,b5 as L,bT as ee}from"./vendor-C50ijZWh.js";import{A as se}from"./AdminLayout-BZL16QJ9.js";import{A as te}from"./AdminPageTitle-BgXCcQq-.js";import{u as ae,C as p,c as j,a as B,b as I,g as R,d as k,I as re,B as q,s as P}from"./index-Blbobipf.js";import{T as le,a as ce,b as T,c as x,d as ne,e as r}from"./table-DWISvnW8.js";import{S as z,a as H,b as V,c as O,d as _}from"./select-Ba1tjTaP.js";import"./libs-B3eAAgHd.js";import"./supabase-D8k0GRjn.js";function ge(){const{toast:l}=ae(),[b,u]=d.useState([]),[A,N]=d.useState(!0),[y,D]=d.useState(""),[i,c]=d.useState("all"),[m,$]=d.useState("all"),[n,v]=d.useState([]),[g,X]=d.useState({total:0,completed:0,pending:0,totalUsage:0,maxCycle:0}),w=()=>S(this,null,function*(){N(!0);try{const{data:s,error:t}=yield P.from("project_prompts").select("*").eq("project","Ubahcrypt").order("id",{ascending:!0});if(t)throw t;u(s||[]);const a=(s==null?void 0:s.length)||0,h=(s==null?void 0:s.filter(C=>C.is_done).length)||0,o=a-h,F=(s==null?void 0:s.reduce((C,W)=>C+(W.times_used||0),0))||0,Q=Math.max(...(s==null?void 0:s.map(C=>C.prompt_cycle_number||0))||[0]);X({total:a,completed:h,pending:o,totalUsage:F,maxCycle:Q})}catch(s){console.error("Error loading prompts:",s),l({variant:"destructive",title:"Error",description:"Failed to load prompts"})}finally{N(!1)}}),Y=(s,t)=>S(this,null,function*(){try{const a={is_done:!t};if(!t){const o=b.find(F=>F.id===s);a.times_used=((o==null?void 0:o.times_used)||0)+1,a.last_used=new Date().toISOString()}const{error:h}=yield P.from("project_prompts").update(a).eq("id",s);if(h)throw h;l({title:"Success",description:`Prompt marked as ${t?"pending":"completed"}`}),w()}catch(a){l({variant:"destructive",title:"Error",description:"Failed to update prompt status"})}}),G=()=>S(this,null,function*(){if(confirm("Are you sure you want to reset ALL prompts? This will mark them as pending and reset usage stats."))try{const{error:s}=yield P.from("project_prompts").update({is_done:!1,times_used:0,last_used:null}).eq("project","Ubahcrypt");if(s)throw s;l({title:"Success",description:"All prompts have been reset"}),w()}catch(s){l({variant:"destructive",title:"Error",description:"Failed to reset prompts"})}}),J=()=>S(this,null,function*(){if(n.length!==0)try{const{error:s}=yield P.from("project_prompts").update({is_done:!0,last_used:new Date().toISOString()}).in("id",n);if(s)throw s;l({title:"Success",description:`${n.length} prompts marked as completed`}),v([]),w()}catch(s){l({variant:"destructive",title:"Error",description:"Failed to update prompts"})}}),f=b.filter(s=>{var o;const t=s.prompt.toLowerCase().includes(y.toLowerCase())||s.id.toString().includes(y),a=i==="all"||i==="completed"&&s.is_done||i==="pending"&&!s.is_done,h=m==="all"||((o=s.prompt_cycle_number)==null?void 0:o.toString())===m;return t&&a&&h}),K=[...new Set(b.map(s=>s.prompt_cycle_number).filter(Boolean))].sort();return d.useEffect(()=>{w()},[]),e.jsx(se,{children:e.jsxs("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[e.jsx(te,{icon:U,title:"Prompt Management System",subtitle:"Manage your 210+ UbahCrypt prompts with cycle tracking and execution control"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(p,{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/5 border-blue-500/20",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-300",children:"Total Prompts"}),e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:g.total})]}),e.jsx(U,{className:"h-8 w-8 text-blue-400"})]})})}),e.jsx(p,{className:"bg-gradient-to-br from-green-500/10 to-green-600/5 border-green-500/20",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-300",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:g.completed})]}),e.jsx(M,{className:"h-8 w-8 text-green-400"})]})})}),e.jsx(p,{className:"bg-gradient-to-br from-orange-500/10 to-orange-600/5 border-orange-500/20",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-300",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-orange-400",children:g.pending})]}),e.jsx(E,{className:"h-8 w-8 text-orange-400"})]})})}),e.jsx(p,{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/5 border-purple-500/20",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-300",children:"Total Usage"}),e.jsx("p",{className:"text-2xl font-bold text-purple-400",children:g.totalUsage})]}),e.jsx(Z,{className:"h-8 w-8 text-purple-400"})]})})}),e.jsx(p,{className:"bg-gradient-to-br from-cyan-500/10 to-cyan-600/5 border-cyan-500/20",children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-cyan-300",children:"Max Cycle"}),e.jsx("p",{className:"text-2xl font-bold text-cyan-400",children:g.maxCycle})]}),e.jsx(L,{className:"h-8 w-8 text-cyan-400"})]})})})]}),e.jsxs(p,{className:"bg-black/30 border-white/10",children:[e.jsx(B,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{className:"text-white",children:"Prompt Controls"}),e.jsx(R,{children:"Search, filter, and manage your prompts"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(k,{onClick:w,variant:"outline",size:"sm",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(k,{onClick:G,variant:"destructive",size:"sm",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Reset All"]}),n.length>0&&e.jsxs(k,{onClick:J,className:"bg-siso-orange hover:bg-siso-orange/80",size:"sm",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Mark ",n.length," Done"]})]})]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(re,{placeholder:"Search prompts...",value:y,onChange:s=>D(s.target.value),className:"pl-10"})]}),e.jsxs(z,{value:i,onValueChange:s=>c(s),children:[e.jsx(H,{children:e.jsx(V,{placeholder:"Filter by status"})}),e.jsxs(O,{children:[e.jsx(_,{value:"all",children:"All Status"}),e.jsx(_,{value:"pending",children:"Pending"}),e.jsx(_,{value:"completed",children:"Completed"})]})]}),e.jsxs(z,{value:m,onValueChange:$,children:[e.jsx(H,{children:e.jsx(V,{placeholder:"Filter by cycle"})}),e.jsxs(O,{children:[e.jsx(_,{value:"all",children:"All Cycles"}),K.map(s=>e.jsxs(_,{value:s.toString(),children:["Cycle ",s]},s))]})]}),e.jsxs("div",{className:"text-sm text-gray-400 flex items-center",children:["Showing ",f.length," of ",g.total," prompts"]})]})})]}),e.jsxs(p,{className:"bg-black/30 border-white/10",children:[e.jsxs(B,{children:[e.jsx(I,{className:"text-white",children:"Prompt Database"}),e.jsx(R,{children:"All prompts with execution status and usage statistics"})]}),e.jsx(j,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(ce,{children:e.jsxs(T,{children:[e.jsx(x,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:n.length===f.length&&f.length>0,onChange:s=>{s.target.checked?v(f.map(t=>t.id)):v([])}})}),e.jsx(x,{children:"ID"}),e.jsx(x,{children:"Cycle"}),e.jsx(x,{children:"Prompt Preview"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Usage"}),e.jsx(x,{children:"Last Used"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(ne,{children:A?e.jsx(T,{children:e.jsx(r,{colSpan:8,className:"text-center py-8",children:"Loading prompts..."})}):f.length===0?e.jsx(T,{children:e.jsx(r,{colSpan:8,className:"text-center py-8 text-gray-400",children:"No prompts found matching your filters"})}):f.map(s=>e.jsxs(T,{className:"hover:bg-white/5",children:[e.jsx(r,{children:e.jsx("input",{type:"checkbox",checked:n.includes(s.id),onChange:t=>{t.target.checked?v([...n,s.id]):v(n.filter(a=>a!==s.id))}})}),e.jsxs(r,{className:"font-mono text-sm",children:["#",s.id]}),e.jsx(r,{children:e.jsxs(q,{variant:"outline",className:"text-xs",children:["Cycle ",s.prompt_cycle_number||"N/A"]})}),e.jsx(r,{className:"max-w-md",children:e.jsxs("div",{className:"truncate text-sm text-gray-300",children:[s.prompt.substring(0,100),"..."]})}),e.jsx(r,{children:e.jsx(q,{variant:s.is_done?"default":"secondary",className:s.is_done?"bg-green-600":"bg-orange-600",children:s.is_done?"Completed":"Pending"})}),e.jsxs(r,{className:"text-sm",children:[s.times_used||0,"x"]}),e.jsx(r,{className:"text-sm text-gray-400",children:s.last_used?new Date(s.last_used).toLocaleDateString():"Never"}),e.jsx(r,{children:e.jsx("div",{className:"flex gap-2",children:e.jsx(k,{size:"sm",variant:"outline",onClick:()=>Y(s.id,s.is_done),children:s.is_done?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-1"}),"Mark Pending"]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Mark Done"]})})})})]},s.id))})]})})})]})]})})}export{ge as default};
